#!/bin/bash
# Full disassembly with all known labels and entry points
# Labels from pattern matching with MBASIC 5.21 sources

ud80 8kbas.bin --org 0 \
    -t 0004-0007 \
    -t 0043-0071 \
    -l 0072,STMT_DISPATCH_END \
    -t 015B-0193 \
    -d 1BC8-1FFF \
    -e 0000,Start \
    -e 0008,SyntaxCheck \
    -e 0010,NextChar \
    -e 0018,OutChar \
    -e 0020,CompareHLDE \
    -e 0028,FTestSign \
    -e 0038,RST7 \
    -l 0004,FN_PTRS \
    -l 0026,TERMINAL_Y \
    -l 0027,TERMINAL_X \
    -l 01D0,CTRL_O_FLAG \
    -l 01D1,SUPPRESS_OUTPUT \
    -l 01D2,STACK_TOP \
    -l 01D4,CURRENT_LINE \
    -l 01D6,PROGRAM_BASE \
    -l 0043,STMT_DISPATCH \
    -l 0073,KEYWORDS \
    -l 01AA,ERROR_CODES \
    -l 003B,szCRLF \
    -l 003D,szBreak \
    -l 0265,szError \
    -l 026C,szIn \
    -l 0271,szOK \
    -l 1B1B,szWantSinCosTanAtn \
    -l 1B30,szMicrosoft \
    -l 1B59,szTerminalWidth \
    -l 1B68,szMemorySize \
    -l 1B74,szBytesFree \
    -l 1B81,szVersion \
    -l 1B98,szEightK \
    -l 1BAB,szCopyright \
    -e 0276,GetFlowPtr \
    -e 029A,bltuc \
    -e 0297,CopyMemoryUp \
    -e 02A6,CheckEnoughVarSpace \
    -e 02BB,OutOfMemory \
    -e 02C6,SyntaxError \
    -e 02D1,Error \
    -e 02F7,Main \
    -e 034E,GetNonBlankLine \
    -e 0341,mloop \
    -e 036D,mloopr \
    -e 037A,chead \
    -e 0395,fndlin \
    -e 03B1,InputLineWithQ \
    -e 0444,Tokenize \
    -e 0495,sngau1 \
    -e 05B7,Print \
    -e 05FF,lexist \
    -e 0663,resfin \
    -e 0725,pophsr \
    -e 074D,StmtDATA \
    -e 079C,Gosub \
    -e 07A8,Goto \
    -e 07D5,Return \
    -e 07FA,Restore \
    -e 0800,exchqt \
    -e 0803,str1 \
    -e 085C,edent \
    -e 094D,trmnok \
    -e 0988,FMul \
    -e 09BB,autstr \
    -e 09CF,intid2 \
    -e 0A3A,FNegate \
    -e 0ACA,kloop \
    -e 0B59,retvar \
    -e 0C3F,Sqr \
    -e 0C49,ptrgt2 \
    -e 0C86,finprt \
    -e 0CA9,smkvar \
    -e 0CD9,mulret \
    -e 0D0D,cat \
    -e 0DC3,StmtINPUT \
    -e 0DF1,StmtREAD \
    -e 0E16,poke \
    -e 0E6F,StmtLIST \
    -e 0E7F,frcinc \
    -e 0E9D,putdei \
    -e 0EAA,strget \
    -e 0EE3,finex \
    -e 0EED,strpr2 \
    -e 0F33,lingt3 \
    -e 0FA4,grbpas \
    -e 0FC9,strcat \
    -e 1000,movins \
    -e 100A,movlp \
    -e 101A,fretmp \
    -e 1032,fretms \
    -e 1041,StmtNEW \
    -e 1045,len1 \
    -e 1050,StmtSTOP \
    -e 1054,asc2 \
    -e 1061,StmtOUT \
    -e 1071,StmtON \
    -e 1077,left2 \
    -e 10A1,StmtNULL \
    -e 10AB,StmtWAIT \
    -e 10D2,StmtPOKE \
    -e 10F0,pream2 \
    -e 10FA,StmtDIM \
    -e 1105,Len \
    -e 110B,Asc \
    -e 1134,clrhlp \
    -e 1159,Chr \
    -e 1185,Left \
    -e 11F9,Right \
    -e 1200,Mid \
    -e 1221,FAdd \
    -e 1261,fadd3 \
    -e 1272,normal \
    -e 1275,norm1 \
    -e 128C,norm2u \
    -e 12B9,rounda \
    -e 12C8,fadda \
    -e 12FA,shftr3 \
    -e 131D,FCompare \
    -e 137B,fmult2 \
    -e 1385,fmult4 \
    -e 1393,fmult5 \
    -e 13A6,fmult3 \
    -e 13DC,fltget \
    -e 1429,muldiv \
    -e 1452,mul10 \
    -e 1473,StmtEND \
    -e 1487,StmtNEXT \
    -e 1491,pushf \
    -e 14A1,movfr \
    -e 14AF,lopnto \
    -e 14BD,move1 \
    -e 14F3,fcomp2 \
    -e 1506,qint \
    -e 152A,qinta \
    -e 1531,StmtFOR \
    -e 1552,umult1 \
    -e 15AD,fine \
    -e 1604,PrintInt \
    -e 161B,FOut \
    -e 1647,FIn \
    -e 1683,foucs2 \
    -e 16D3,Exp \
    -e 16FF,Log \
    -e 1716,posexp \
    -e 1733,fpwr1 \
    -e 174B,StmtDEF \
    -e 17BB,poly \
    -e 17DC,StmtGOTO \
    -e 1816,rnd1 \
    -e 183B,rndstr \
    -e 1876,Sin \
    -e 18D9,Cos \
    -e 18EE,StmtLET \
    -e 193A,Tan \
    -e 1953,Atn \
    -e 1A0B,Init \
    -e 1A41,scnstr \
    -e 1A5D,FindMemTop \
    -e 1ADD,SetupTrigFns \
    -o 8kbas_labeled.mac

echo "Disassembly complete"
