=== PAGE _003 (PDF page 79) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 1
; SYSTEM INTERFACE
file    "8K Basic"
BASIC:                              ;FULL RESTART INITIALIZATION    ;
SYSINITJ:
0000 C30000     JMP     INITIALZ
REENTERBASIC:                       ;REENTER AFTER PAUSE
0003 C30000     JMP     cmndrstr
; Monitor Routines
0006 0406 co equ     406h    :¢ -> screen
0006 0409   cinb        equ     409h    ;keyboard -> ac, carry set if any
0006 0538 decir        equ     538h    :clear screen
0006 04F4 xco equ     4f4h    ;¢ -> printer (blocking)
; NON-BLOCKING INPUT
;    CHAR IN AC IF NOT ZERO
;    ZERO SET IF NONE
SYSKEYIN:
0006 C5         push    b
0007 DS         push    d
0008 £5         push    h
0009 CD0904     call    cinb    sget char
go00Cc D20000     jac     syskeynone                ;                                                ;
OOOF FEOO       cpi     0
0011 CA0000     jz      clearscreen
0014 FE1F       cpi     1fh     ;us to break to fourteen
0016 CA0000     jz      gomonitor
syskeyinret:
0019 E1         pop     h
001A D1         pop     d
001B C1         pop     b
001Cc C9         ret
syskeynone:                                                    ;
001D 97         sub     a       set zero
001E €31900     jmp     syskeyinret
clearscreen:
0021 CD3805     call    decir    ;clear screen
0024 C31D00     jmp     syskeynone
gomonitor:
0027 CF         rst     1       sabout using us (t+)
0028 00         nop
0029 00         nop
; SEND AC TO SCREEN      .
SYSDISPL:
002A F5         push    psw
002B C5         push    b
002C D5         push    d
|


=== PAGE _004 (PDF page 80) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 2
002D E56         push    h
OO2E 4F         mov     c,a
O02F CD0604     call    co      ;c to screen
0032 3A0000     Ida     p3010   sprint on the 3010 if zero
0035 A7         ana     a
0036 CCF404     cz      xco     yes print
0039 E1         pop     h
003A Di         pop     d
003B C1         pop     b
003C F1         pop     psw
003D C9         RET
; CHECK FOR BREAK REQUEST
;    SET ZERO TO BREAK
SYSBREAK:
QO3E CDO600     call    syskeyin
0041 CA0000     iz      nobreak
0044 97         sub     a
0045 C9         ret
nobreak:
0046 3E01       mvi     a,1                                                                            .
0048 B7         ora     a
0049 C9         ret
; DELAY
SYSWAIT:
004A C9         RET
; RETURN TO MONITOR
004B B400 MONITOR     EQU     0B400H
SYSQUIT:
004B C300B4     IMP     MONITOR


=== PAGE _005 (PDF page 81) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 3
OO4E 000D CR EQU     ODH

OO4E OOOA LF €EQU     OAH

004E 0007 BEL EQU     07H

OO4E 0008 BS EQU     08H

OO4E 0009 TAB EQU     09H

OO4E 0009 HT EQU     OSH

OO4E 0011 DC1 EQU     11H

QO4E OO7F DEL EQU     7FH

OO4E OOOF SI EQU     OFH

OO4E 0003 ETX EQU     03H

OO4E 000C FF EQU     OCH                                                                     ;
QO4E 001B ESC EQU     1BH       .


=== PAGE _006 (PDF page 82) ===
basIC.LST                      §-Sep-78 14:14:39                                         Page 4
OO4E 0080   KEYSTM EQU 80H             STATEMENT CODES
OO4E 0080   KEYDAT EQU KEYSTM

OO4E 0081   KEYREM EQU KEYDAT+4

QO4E 0082   KEYLSAL EQU KEYREM+1

OO4E 0082   KEYEND EQU KEYLSAL

OO4E 0083   KEYFOR EQU KEYEND+1

QO4E 0084 KEYNEX EQU KEYFOR+1                                                :
OO4E 0085   KEYINPT EQU KEYNEX+1

QO4E 0086 KEYDIM EQU KEYINPT+1

OO4E 0087   KEYREA EQU KEYDIM+1

QO4E 0088 KEYLET EQU KEYREA+1

GO4E 0089   KEYGTO EQU KEYLET+1

QO4E 008A KEYRUN EQU KEYGTO+1

OO4E 008B KEYIF   EQU KEYRUN+1

OO4E 008C   KEYELS EQU KEYIF+1

OO4E 008D KEYRES EQU KEYELS+1

OO4E OO8E   KEYGSB EQU KEYRES+1

OO4E O08F   KEYRET EQU KEYGSB+1

OO4E 0090   KEYSTOP EQU KEYRET+1

OO4E 0091   KEYON  EQU KEYSTOP+1

OO4E 0092   KEYAUT EQU KEYON+1

QO4E 0093   KEYDEL EQU KEYAUT+1

CO4E 0094 KEYPLT EQU KEYDEL+1

OO4E 0095   KEYWAI EQU KEYPLT+1

CO4E 0096   KEYPRT EQU KEYWAI+1

GO4E 0097   KEYDEF EQU KEYPRT+1

OO4E 0098   KEYCON EQU KEYDEF+1

OO4E 0099   KEYLIS EQU KEYCON+1

OO4E 009A KEYEDI EQU KEYLIS+1

OO4E 0098   KEYCLR EQU KEYEDI+i                  ;                                                 :
OO4E O09C   KEYCLD EQU KEYCLR+1

O04E 009D KEYCSV EQU KEYCLD+1 ~

OO4E OO9E   KEYNEW EQU KEYCSV+1

OO4E OO9F   KEYSET EQU KEYNEW+1                         .
OO4E OCAD   KEYSUGR EQU KEYSET+1

OO4E O0AD   KEYLSBL EQU KEYSUGR

OO4E O0A0   KEYTHEN EQU KEYSUGR

OO4E OO0A1   KEYTO EQU KEYTHEN+1

OO4E O0A2   KEYSTEP EQU KEYTO+1

O04E O0A3   KEYLSBH EQU KEYSTEP+1                                          ;
O004E 00A3   KEYPRM EQU KEYLSBH

OO4E O0A4 KEYLINE EQU KEYPRM+1

OO4E O0AS   KEYLSAH EQU KEYLINE+1

OO4E O0A5   KEYTAB EQU KEYLSAH

OO4E OOAG KEYSPC EQU KEYTAB+1

OO4E O0A7   KEYFN   EQU KEYSPC+1

OO4E OOA8 KEYNOT EQU KEYFN+1

O04E OOA9   KEYOFF EQU KEYNOT+1

CO4E OOAA KEYOPR EQU KEYOFF+1        ;OPERATOR CODES
OO4E OOAA KEYADD EQU KEYOPR        .

OO4E OOAB   KEYSUB EQU KEYADD+1

OO4E OOACT   KEYMUL EQU KEYSUB+1

OO4E OOAD KEYDIV EQU KEYMUL+1

GO4E OOAE   KEYMOD EQU KEYDIV+1

OO4E OOAF   KEYEXPT EQU KEYMOD+1


=== PAGE _007 (PDF page 83) ===
basIC.LST                       55-Sep-78 14:14:39                                            Page §
O04E 00B0   KEYAND EQU KEYEXPT+1

0O4E 00B1   KEYOR   EQU KEYAND+4

O04E 00B2   KEYMAX EQU KEYOR+1

OO4E 00B3   KEYMIN EQU KEYMAX+1

00O4E 00B4 KEYREL EQU KEYMIN+4        ;RELATION CODES
OO4E 00B4 KEYGT   EQU KEYREL

Q04E OO0BS   KEYEQ   EQU KEYGT+1

OO4E 0OB6 KEYLT   EQU KEYEQ+1

0O4E 0087   KEYFCT EQU KEYLT+1         ;FUNCTION CODES
QO4E 0087   KEYSGN EQU KEYFCT

OO4E 0088   KEYINT EQU KEYSGN+1

OO4E 0089   KEYABS EQU KEYINT+1

OO4E OOBA KEYSQR EQU KEYABS+1     ,

OO4E OOBB   KEYRND EQU KEYSQR+1                                                    :
OO4E 0OBC KEYLOG EQU KEYRND+1

OO04E O0BD   KEYEXP EQU KEYLOG+1

OO4E OOBE   KEYCOS EQU KEYEXP+1

OO4E OOBF KEYSIN EQU KEYCOS+1

OO4E O0CO   KEYTAN EQU KEYSIN+1

OO4E 00C1   KEYATA EQU KEYTAN+1                                                                       :
OO4E 00C2   KEYUSR EQU KEYATA+1

OO4E 00C3   KEYFRE EQU KEYUSR+1

004E 00C4 KEYPORT EQU KEYFRE+14

OO4E 00C5   KEYPOS EQU KEYPORT+1

O04E 00C6   KEYMEM EQU KEYPOS+1

OO4E 00C7   KEYLEN EQU KEYMEM+1

OO4E 00C8   KEYSTR EQU KEYLEN+1

QO4E 00C9   KEYVAL EQU KEYSTR+1

OO4E OOCA KEYASC EQU KEYVAL+1

OO4E O0CB   KEYCHR EQU KEYASC+1

CO4E O0CC   KEYHEX EQU KEYCHR+1

GO4E OOCD   KEYHXV EQU KEYHEX+1

OO4E OOCE   KEYUPR EQU KEYHXV+1

OO4E OOCF   KEYLFT EQU KEYUPR+1

OO4E 00D0 KEYRIG EQU KEYLFT+1

QO4E 00D1   KEYMID EQU KEYRIG+1

GO4E 00D2   KEYINS EQU KEYMID+1

OO4E 0003   KEYS    EQU KEYINS+1        ;LAST ENTRY


=== PAGE _008 (PDF page 84) ===
basIC.LST                      5-Sep-78 14:14:39                                   ;      Page 6
STMTABL:                    STATEMENT ROUTINES
0O4E 0000       DW      DATSTM
0050 0000       DW      REMSTM
;LISTED WITH BLANK AFTER
0052 0000       DW      ENDSTM
0054 0900       DW      FORSTM
0056 0000       DW      NEXSTM
0058 0000       DW      INPSTM
005A 0000       DW      DIMSTM
oos5c 0000       DW      REASTM
OO5E 0000       DW      LETSTM
0060 0000       Dw      GTOSTM    .
0062 0000       DW      RUNSTM
0064 0000       DW      IFSTM
0066 0000       Dw      ELSSTM
0068 0000       DW      RESSTM
OO6A 0000       DW      GSBSTM
on6c 0000      DW     RETSTM                       :
OOGE 0000       DW      STPSTM
0070 0000       DW      ONSTM
0072 0000       DW      AUTSTM
0074 0000      DW     DELSTM
0076 0000       DW      PLTSTM
0078 0000      DW     WAISTM
007A 0000       DW      PRTSTM
o07C 0000       DW      DEFSTM
OO7E 0000       DW      CONSTM
0080 0000      OW     LISSTM
0082 0000     DW     EDISTM
0084 0000       Dw      CLRSTM
0086 0000       DW      CLDSTM
0088 0000       Dw      CSVSTM
008A 0000       DW      NEWSTM
oo8c 0000       DW      SETSTM


=== PAGE _009 (PDF page 85) ===
basIC.LST                      5~Sep-78 14:14:39                                         Page 7
OPRTABL:                    ;OPERATORS AND PRECEDENCE

OO8E 79         DB      79H

OO8F 0000       DW      ADDOPR

0091 79         DB      79H

0092 0000       DW      SUBOPR

0094 7B         DB      7BH

0095 0000       DW      MULOPR                                                  ;

0097 7B         DB      7BH

0098 0000       DW      DIVOPR

COSA 7B         DB      7BH

009B 0000       DW      MODOPR

009D 7F         DB      7FH

OO9E 0000       DW      EXPOPR

QOA0 50         DB      50H

OOA1 0000       Dw      ANDOPR

QOA3 46         DB      46H

00A4 0000       DW      ORNOPR

QOAG 76           DB       76H

Q0A7 0000       DW      MAXOPR

QOAS 76         DB      76H

QOAA 0000       DW      MINOPR


=== PAGE _010 (PDF page 86) ===
basIC.LST                      §-Sep-78 14:14:39                                         Page 8
FCTTABL:                    ;FUNCTION ROUTINES

ooAC 0000       DW      SGNFCT

OOAE 0000       DW      INTFCT

00B0 0000       DW      ABSFCT

00B2 o000       DW      SQRFCT

00B4 0000       DW      RNDFCT

OOB6 0000       DW      LOGFCT

00B8 0000       DW      EXPFCT

OOBA 0000       DW      COSFCT

QOBC 0000       DW      SINFCT

OOBE 0000       DW      TANFCT

ooco 0000       DW      ATNFCT

ooc2 0000       OW      ERRAFC

oo0c4 0000       DW      FREFCT

ooce 0000       DW      PORFCT

oocs 0000       DW      POSFCT                                                      .

QOCA 0000       DW      MEMFCT

goce oon0       DW      LENFCT

QOCE 0000       DW      STRFCT

00DO0 0000       DW      VALFCT

0oD2 0000       DW      ASCFCT

00D4 0000      DW     CHRFCT                                                           .

00D6 0000      DW     HEXFCT

00D8 0000      DW     HXVFCT

CODA 0000       DW      UPRFCT

ooDC 0000       Dw      LFTFCT

OODE 0000       DW      RIGFCT

OOEO 0000      DW     MIDFCT

OOE2 0000      DW     INSFCT


=== PAGE _011 (PDF page 87) ===
basIC.LST                      5-Sep-78 14:14:39                                  ;      Page 9
KEYWADDS:                   ;POINTERS TO KEYWORD GROUPS
00E4 000000     DW      KEYWRDO, KEYWRD1, KEYWRD2, KEYWRD3
00E7 000000
OOEA 0000
GOEC 000000     DW      KEYWRD4, KEYWROS, KEYWROG, KEYWRD7
QOEF 000000
00F2 0000
OOF4 000000     DW      KEYWRD8, KEYWRD9, KEYWRDA, KEYWRDB
OOF? 000000
OOFA 0000
OOFC 000000     DW      KEYWRDC, KEYWRDD, KEYWRDE, KEYWRDF
OOFF 000000                       .
0102 0000
KEYWORDS;
KEYWRDO:                      .
0104 94504C     DB      KEYPLT,     "PLO", 'T+128
0107 4FD4
0109 965052     DB      KEYPRT,     "PRIN", 'T+128        .
O10C 494ED4
O10F A35052     DB      KEYPRM,     "PROMP", 'T+128
0112 4F4D50
0115 D4
0116 C4504F     DB      KEYPORT,    "POR", ‘'T+128
0119 52D4
011B 45504F     DB      KEYPOS-80H, "PO", 'S+128
011E D3
KEYWRD1:
O11F 924155     DB      KEYAUT,     "AUT", '0+128
0122 54CF
0124 B0414E     DB      KEYAND,     "AN", 'D+128
0127 C4
0128 B94142     DB      KEYABS,     "AB", 'S+128
012B D3                                                                                                   :
012C C14164     DB      KEYATA,     "AT", 'N+128
012F CE
0130 4A4153     DB      KEYASC-80H, "AS", 'C+128
0133 C3
KEYWRD2:
0134 815245     DB      KEYREM,     "RE", 'M+128
0137 CD
0138 875245     DB      KEYREA,     "REA", 'D+128
013B 41C4
013D 8A5255     DB      KEYRUN,     "RU", 'N+128
0140 CE
0141 8D5245     DB      KEYRES,     "RESTOR", 'E+128
0144 53544F
0147 52C5
0149 8F5245     DB      KEYRET,     "RETUR", ‘'N+128
014C 545552
O14F CE
0150 BBS24E     DB      KEYRND,     "RN", 'D+128
0153 C4
0154 §05249     DB      KEYRIG-80H, "RIGHT", '$+128
0157 474854
Q15A A4
KEYWRD3;
|
|


=== PAGE _012 (PDF page 88) ===
basIC.LST                      55-Sep-78 14:14:39                                         Page 10
015B 905354     DB      KEYSTOP,    "STO", 'P+128
015E 4FDO
0160 98434F     DB      KEYCON,     "CON", 'T+128
0163 4ED4
0165 9B434C     DB      KEYCLR,     "CLEA", ‘R+128
0168 454102
016B 905341     DB      KEYCSV,     "SAV", 'E+128
016E 56C5
0170 9F5345     DB      KEYSET,     "SE", 'T+128
0173 D4
0174 A26354     DB      KEYSTEP,    "STE", 'P+128
0177 45D0
0179 A65350     DB      KEYSPC,     "SP", 'C+128
017C C3
017D B75347     DB      KEYSGN,     "SG", 'N+128
0180 CE
0181 BAS351     DB      KEYSQR,     "SQ", 'R+128
0184 D2
0185 BE434F     DB      KEYCOS,     "CO", 'S+128
0188 D3
0189 BF5349     OB      KEYSIN,     "SI", 'N+128
018C CE   ;
018D C85354     DB      KEYSTR,     "STR", '$+128
0190 52A4
0192 4B4348     DB      KEYCHR-80H, "CHR", '$+128
0195 52A4

KEYWRD4:
0197 804441     DB      KEYDAT,     "DAT", 'At+128
019A 54C1
019C 864449     DB      KEYDIM,     "DI", 'M+128 |
019F CD
O1A0 934445     OB      KEYDEL,     "DELET", 'E+128
01A3 4C4554
01A6 C5                                                  ;
Q1A7 974445     DB      KEYDEF,     "DE", ‘F+128
Q1AA C6
01AB A05448     DB      KEYTHEN,    "THE", 'N+128
Q1AE 45CE
01B0 A1S4CF     DB      KEYTO,      "T", 'O+128
01B3 A55441     DB      KEYTAB,     "TA", ‘B+128
01B6 C2
01B7 405441     DB      KEYTAN-80H, "TA", 'N+128
O1BA CE

KEYWRDS:
01BB 82454E     DB      KEYEND,     "EN", 'D+128
O1BE C4
O1BF 8C454C     DB      KEYELS,     "ELS", 'E+128
01C2 53C5
01C4 9A4544     DB      KEYEDI,     "EDI", 'T+128
01C7 49D4
0109 BD4558     DB      KEYEXP,     "EX", 'P+128
01CC DO
01CD C25553     DB      KEYUSR,     "US", 'R+128
01D0 D2
0101 4£&5550     DB      KEYUPR-80H, "UPPER", '$+128
01D4 504552


=== PAGE _013 (PDF page 89) ===
basIC.tST                      5-Sep-78 14:14:39                                         Page 11
0107 A4
KEYWRD6:
0108 83464F     DB      KEYFOR,     "FO", 'R+128
010B D2
GiOC A746CE     OB      KEYFN,      “FY, IN+128
O1DF C34652     DB      KEYFRE,     "FR", 'E+128
O1£2 C5
Q1E3 495641     BB      KEYVAL-80H, "VA", 'L+128
O1E6 CC
KEYWRD7:
Q1E7 89474F     DB      KEYGTO,     "GOT", '0+128
O1EA 54CF
O1EC 8E474F     DB      KEYGSB,     "GOSU", 'B+128
O1EF 5355C2
O1F2 155741     DB      KEYWAI-80H, "WAI", 'T+128
O1F5 49D4
KEYWRD8:
O1F7 CC4845     DB      KEYHEX,     "HEX", '$4+128
O1FA 58A4
Q1FC 404845     DB      KEYHXV-80H, "HEX", 'V+128
O1FF 5806
KEYWRDS:                                                                                        :
0201 85494E     DB      KEYINPT,    "INPU", ‘T+128
0204 5055D4
0207 8B49C6     DB      KEYIF,      "I", 'F+128
O20A B8494E     OB      KEYINT,     "IN", 'T+128
020D D4
O20E 52494E     DB      KEYINS~80H, "INST", ‘R+128
0211 5354D2
KEYWRDA:
0214 2CAA       DB      KEYMUL-80H, '*+128
KEYWRDB:
0216 2AAB       DB      KEYADD-80H, '++128
KEYWRDC:
0218 884C45     DB      KEYLET,     "LE", 'T+128
021B 04
021C 994C49     DB      KEYLIS,     "LIS", 'T+128
O21F 53D4
0221 9C4C4F     DB      KEYCLD,     "LOA", 'D+128
0224 4104
0226 A44C49     DB      KEYLINE,    "LIN", 'E+128
0229 4EC5
022B B6BC       OB      KEYLT,      '<+128
022D BC4C4F     DB      KEYLOG,     "LO", 'G+128
0230 C7
0231 C74C45     DB      KEYLEN,     "LE", 'N+128               .
0234 CE
0235 4F4C45     DB      KEYLFT-80H, "LEFT", ‘'$+128
0238 4654A4
KEYWRDD:
023B ABAD       DB      KEYSUB,     '-+128
023D AE4D4F     DB      KEYMOD,     "MO", 'D+128
0240 C4
0241 B24D41     DB      KEYMAX,     "MA", 'X+128
0244 D8
0245 B34D49     DB      KEYMIN,     "MI", 'N+128


=== PAGE _014 (PDF page 90) ===
basIC.LST                      5-Sep-78 14:14:39                                  ;      Page 12
0248 CE
0249 B5BD       DB      KEYEQ,      'm+128
024B C64D45     OB      KEYMEM,     "ME", 'M+128
Q24E CD
O24F 614049     DB      KEYMID~80H, "MID", ‘$+128
0252 44A4
KEYWRDE:
0254 844645     DB      KEYNEX,     "NEX", 'T+128
0257 58D4
0259 QE4E45     DB      KEYNEW,     "NE", 'W+128
025C D7
025D A84E4F     DB      KEYNOT,   _ "NO", 'T+128
0260 D4
0261 AFDE       DB      KEYEXPT,    "44128
0263 34BE       DB      KEYGT-80H, '>+128
KEYWRDF:
0265 96BF       DB      KEYPRT,     '?4+128
0267 914FCE     DB      KEYON,      "O", 'N+128           .
026A AQ4F46     DB      KEYOFF,     "OF", 'F+128
026D C6
Q26E ADAF       DB      KEYDIV,     '/+128
0270 314FD2     DB      KEYOR-80H, "“O", 'R+128


=== PAGE _015 (PDF page 91) ===
basIc.LST                      5-Sep-78 14:14:39                                         Page 13
ERRN:                               ;ERROR CODES
ERRNCN:
0273 434F4E     DB      "CONTINUE" ,0            ;CONTINUE ERROR
0276 54494E
627 554508
ERRNSL:
O027C 444556     DB      "DEVICE" ,0O              ;SAVE/LOAD DEVICE ERROR         :
027F 494345
0282 00
ERRNDO:
0283 44494D     DB      "DIMENSION" ,0           ;DOUBLE DIMENSION
0286 454653
0289 494F4E
028C 00
ERRNID:
028D 444952     DB      "DIRECT",0              ; ILLEGAL DIRECT
0290 454354
0293 00
ERRNDO:
0294 444956     DB      "DIVIDE BY 0",0         ;DIVISION BY ZERO
0297 494445
029A 204259
029D 203000
ERRNFC:
02A0 46554E     DB      "FUNCTION CALL",0       ;FUNCTION CALL
02A3 435449
O2A6 4F4E20
O2A9 43414C€
O2AC 4C00
ERRNLS:
O2AE 4C4F4E     DB      "LONG STRING",O         ;LONG STRING
02B1 472053
0284 545249
02B7 4£4700
ERRNOM:
O2BA 4D4540     DB      "MEMORY SPACE",0        ;OUT OF MEMORY
O02BD 4F5259
02C0 205350
02C3 414345
02C6 00                                                                    .
ERRNNF:
02C7 464558     DB      "NEXT W/O FOR",O        ;NEXT WITHOUT FOR
O2CA 542057
02CD 2F4F20
02D0 464F52
02D3 00
ERRNOD:
02D4 4F5554     DB      "OUT OF DATA",0         ;OUT OF DATA
O2D7 204F46
O2DA 204441
02DD 544100                           :
ERRNOV:
O2E0 4F5645     DB      "OVERFLOW" ,0            ; OVERFLOW
02E3 52464C
O2E6 4F5700
ERRNRG:


=== PAGE _016 (PDF page 92) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 14
O2E9 524654     DB      "RETN W/O GOSUB",0      ;RETURN WITHOUT GOSUB
O2EC 462057
O2ZEF 2F4F20
O2F2 474F53
O2F5 554200
ERRNOS:
O2F8 535452     DB      "STRING SPACE",0        ;OUT OF STRING SPACE                                        ;
O2FB 494647
O2FE 205350
0301 414345
0304 00
ERRNST:
0305 535452     DB      "STRING TEMPS",0        ;STRING TEMPORARIES
0308 494647
030B 205445
030E 405053                                                                         .
0311 00
ERRNBS:
0312 535542     DB      "SUBSCRIPT",0           ;BAD SUBSCRIPT
0315 534352
0318 495054
031B 00                                                                                                      :     .
ERRNSN:
031C 53594E     DB      "SYNTAX" ,0              ;SYNTAX ERROR
O31F 544158
0322 00
ERRNTM:
0323 545950     DB      "TYPE",0O                ; TYPE MISMATCH
0326 4500
ERRNUF :
0328 554644     DB      "UNDFND FUNCTION" ,O     ;UNDEFINED FUNCTION
032B 464644
032E 204655
0331 464354
0334 494F4E
0337 00
ERRNUS:
0338 554644     DB      "UNDFND LINE",0         ;UNDEFINED STATEMENT                                   ;
033B 464644
033E 204C49
0341 464500
ERRNUV:
0344 554644     DB      “UNDFND VARIABLE", 0     ; UNDEFINED VARIABLE
0347 4645644
034A 205641
034D 524941                                                     .
0350 424C45
0353 00
ERRNFI:
0354 46696C     DB      "File not Saved",0      s;unknown file name
0357 65206E
035A 6F7420
035D 536176
0360 656400


=== PAGE _017 (PDF page 93) ===
basIC,.LST                      5-Sep-78 14:14:39                                         Page 15
; INTERPRETER VARIABLES
;            VARIABLES MARKED WITH SAME CHARACTER IN COLUMN 71
;               ARE FIXED IN THAT ORDER.
0363 01    p3010:     db     1            ;0 to print on 3010
0364 00     REAINPFL:   DB      0               ;READ/INPUT FLAG
0365 00     PRINTFLG:   DB      0               ;PRINT/NO PRINT FLAG
0366 01     TRACEFLG:   DB      1.             ;TRACE/NO TRACE FLAG
0367 00     SCANPFLG:   DB      0               ;SCAN/NOSCAN PARENTHESIS FLAG
0368 01     SCANPFLE:   DB      1               ;ARRAY NAME FOR ERASE
0369 OOAB   SCANPFLD    EQU     KEYS-'( ;NO ARRAY ELEMENTS WANTED
0369 00     MATSCCNT:   DB      0               ; SUBSCRIPT COUNT
036A 00     MATDMFLG:   DB      0               ; SCANNING FOR VAR/DIMENSION V
036B 00     TYPEFLG:    DB      0               ‘TYPE FLAG ~                  Vv
036C 0002   TYPEINTG    EQU     2               ;TYPE OF INTEGER
036C 0003   TYPESTRG    EQU     3               ;TYPE OF STRING
036C 0004   TYPESING    EQU     4               ;TYPE OF SINGLE FLOATING POINT
036C 0008   TYPEDUBL    EQU     8               ;TYPE OF DOUBLE FLOATING POINT
036C 0020   TYPEDEF     EQU     O80H/4          ;sMARKING BIT FOR USER-FUNCTION
036C 00     STRGTMPL:   DB      0               :TEMP STRING DESCRPTR, LEN   s
036D 0000   STRGTMPA:   DW      0               ;TEMP STRING DESCRPTR, ADDR S
O36F 0000   SCANPTR1:   DW      0               ;SCAN POINTER
0371 0000   SCANPTR2:   DW      0               ; SCAN POINTER
0373 FFFF   CURLINE:    DW      -1              ;CURRENT LINE NUMBER
0375 0000   CURLINES:   DW      0               ; SAVED CURRENT LINE NUMBER
0377 0000   PROGCNTR:   DW      ENDINTRP+12     ;CURRENT PROGRAM LOCATION
0379 0377   VARINDEX    EQU     PROGCNTR        : INDEX VARIABLE OF FOR                                   :
0379 0000   PROGCNTS:   DW      0               ;SAVED CURRENT PROGRAMLOCATION
037B 0000   CURLDATA:   DW      0               ;CURRENT DATA LINE NUMBER
037D 0000   CURDATAP:   DW      ENDINTRP        :CURRENT DATA POINTER
037F 0000   INPTBUFR:   DW      INITSTSP        ; INPUT BUFFER ADDRESS
0381 0064   PREDREL     EQU     064H            ;PRECEDENCE OF RELATION
0381 0070   PREDNUM     EQU     070H            ;LOWER BNDRY OF NUM OP PREC.
0381 OO5A   PREDNOT     EQU     O5AH            ;PRECEDENCE OF NOT OPERATOR
0381 007D   PREDUMIN    EQU     070DH            ;PRECEDENCE OF UNARY MINUS
0381 009D   LINESYZE    EQU     79+78           ;DEFAULT LINESYZE
0381 OOO0E   ITEMSIZE    EQU     14              ;DEFAULT WIDTH OF PRINT ITEM


=== PAGE _018 (PDF page 94) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 16

  MEMORY ALLOCATION POINTERS                                              ,
0381 8000 LIMLOWER    EQU     08000H
0381 AFOO LIMUPPER    EQU     OAFOQOH

;  MEMORY LAYOUT

  ENCODE BUFFER

; PROGRAM

; VARIABLES

; ARRAYS

; FREE SPACE / STACK (INCLUDING BUFFERS)

; FREE STRING SPACE

; STRINGS

; STRING TEMPORARIES

; FREE STRING TEMPORARIES
0381 0000   PROGBASE:   DW      ENDINTRP+13     ;BASE OF PROGRAM SPACE
0383 0000 VARTABLE: OW      ENDINTRP+15     ;BASE OF VARIABLE TABLE
0385 0000   MATTABLE:   OW      ENDINTRP+15     ;BASE OF ARRAY TABLE
0387 0000   FREELIMT:   DW      ENDINTRP+15     ;LOWER LIMIT OF FREE SPACE
0389 0000 STCKBASE: DW      INITSTCK        ;BASE OF STACK
038B 0000   STRGFREE:   DW      INITSTCK+10     FIRST FREE STRING SPACE
038D 0000   STRGBASE:   DW      INITSTCK+10     ;BASE OF STRING SPACE
038F 0000 STRGTMPP: OW      INITSTCK+11     ;STRING TEMPORARY ALLOC PTR
0391 0000 STRGTLIM: OW      INITSTCK+10+2*3 ;STRING TEMPORARY LIMIT                            ;
0393 0000   ACCUMLTR:   DB      0,0     ; ACCUMULATOR                     A
0395 00     FLACCMSB: DB      0       ;SIGN-BIT/HIGH-ORDER MANTISSA    A
0396 00     FLACCEXP:   DB      0       ; EXPONENT                        A
0397 00     FLACCSSV: DB      0       ;SAVED SIGN                      A
0398 01     NULLCNT:    DB      1       :# OF NULLS TO INSERT AFTER (CR)
0399 01     CURSPOS:    DB      1       ;CHARACTER CURSOR POSITION       Cc
039A 63     CURSLIM:    DB      -LINESYZE       ;OUTPUT CURSOR LIMIT      Cc
039B 00     FLSCRO:     DB      0       ;FLOATING POINT SCRATCH AREA
039C 01     FLSCR1:     DB      1
039D 02     FLSCR2:     DB      2
O39E 03     FLSCR3:     DB      3
O39F 0398   INOTINS     EQU     FLSCRO = ;INPUT/OUTPUT INSTRUCTIONS
O39F OODB   OPCINP      EQU     ODBH    ; INPUT INSTRUCTION
Q39F 00D3   OPCOUT      EQU     OD3H    ;OUTPUT INSTRUCTION
O39F 00C9 OPCRET      EQU     OcSH    RETURN INSTRUCTION
O39F 52C74F RNDFCTSD:   DB      052h, Oc7h, O4fh, O080h ;RANDOM SEED
03A2 80


=== PAGE _019 (PDF page 95) ===
basIC.LST                       5-Sep-78 14:14:39                                            Page 17
; GENERAL USE SUBROUTINES
; SCAN ONE CHARACTER AND CLASSIFY
SCANNXTV:

03A3 7E         MOV     A.M     ;SCAN CURRENT BYTE,

03A4 E3         XTHL

03A5 BE         CMP     M       ;VERIFY MATCH,

O3AG 23         INX     H

03A7 E3         XTHL

03A8 C20000     JNZ     ERRASN = ;SQUAWK ABOUT SYNTAX ERROR                          ;
SCANNXT:

O3AB 23         TNX     H       ;SCAN FOR NEXT NON-BLANK CHAR

O3AC 7E         MOV     A.M     ;C=NUMERIC CHARACTER

O3AD FE3A       CPI     my"     ;Z=END OF STATEMENT

O3AF DO         RNC

03B0 FE20       CPI     e                                                                            .

03B2 CAABO3     Jz      SCANNXT

03B5 FE30       CPI     "o"

0387 3F         CMC

03B8 3C         INR     A

0389 3D         DCR     A

03BA C9         RET


=== PAGE _020 (PDF page 96) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 18
; TEST FOR ALPHABETIC CHARACTER
ALPHACHK:

03BB 7E         MOV     A.M     ;TEST FOR ALPHABETIC CHARACTER
ALPHACHA:

03BC FE7B       cPI     ‘z+    ;LOWER CASE

O3BE DO         RNC

O3BF FE61       CPI     "a"     ;LOWER CASE

03Cc1 020000     JNC     ALPHACHL

03C4 FESB       CPI     'Z+1    ;C=ALPHABETIC

03C6 DO         RNC

03C7 FE41       CPI     "A"     ;UPPER CASE

03C9 3F         CMC

03CA C9         RET                                        :
ALPHACHL:

03CB C6E0       ADI     "A-'a — ; CONVERT LOWER TO UPPER

03CD C9         RET
; MATCH CHARACTER OF BUFFER AGAINST CHARACTER IN A
CHARMTCH:

O3CE AE         XRA     M       :MAKE MATCH TEST

O3CF C8         RZ              :Z=SUCCESS]

03D0 FE20       CPI     ‘a-'A =; LOWER CASE - UPPER CASE

03D2 CO         RNZ             ;NOT LOWER-UPPER DIFFERENCE

0303 CDBBO3     CALL    ALPHACHK        ; ALPHABETIC?

03D6 OF         SBB     A

03D7 3C         INR     A       :Z"C,S=0

03D8 C9         RET
; CHECK TYPE OF EXPRESSION                LEN CHAR
;            RETURNS: S => INTEGER         2    4%
;                      Z => STRING          3    $
;                     PQ => SINGLE          4    @
;                     NC => DOUBLE          8    #
TYPECHK:

03D9 3A6B03     LDA     TYPEFLG
TYPECHKA:

O3DC FE05       cPI     TYPESING+1

O3DE 3D         DCR     A

O3DF 3D         DCR     A

03E0 3D         DCR     A

03£1 B7         ORA     A

O3E2 37         STC

03E3 C9         RET


=== PAGE _021 (PDF page 97) ===
basIC.LST                      5~Sep-78 14:14:39                                          Page 19
; SCAN A PAIR OF LINE NUMBER PARAMETERS
SCANLPRZ:

03E4 010000     LXI     B,0     ;DEFAULT SECOND IS FIRST
SCANLPRM:                                                            ;                         .

03E7 C40000     CNZ     SCANLINN        ;DEFAULT FIRST IS IN DE

O3EA FS         PUSH    PSW

O3EB 78         MOV     A,B

O3EC Bi         ORA     Cc       ;ZERO DEFAULT IS FIRST PARAMETER

O3ED C20000     JNZ     SCANLPR1

O3F0 42         MOV     B,D

03F1 48         MOV     C,E
SCANLPR1:

O3F2 Fi         POP     PSW

03F3 EB         XCHG

03F4 £3         XTHL            ;PUT FIRST ONTO STACK

O3F5 E5         PUSH    H

O3F6 EB         XCHG

03F7 50         MOV     D,B

O3F8 59         MOV     E,Cc

03F9 C8         RZ

O3FA FEAD       CPI     KEYDIV ;SEPARATOR MUST BE "/",

O3FC CAQO00     JZ      SCANLPR2

O3FF COA303     CALL    SCANNXTV        ;bscan (val)

0402 2c         DB      "”     > OR ","

0403 2B         DCX     H
SCANLPR2:

0404 11FFFF     LXI     D,OFFFFH        ;EMPTY SECOND OPERAND = END

0407 CDABO3     CALL    SCANNXT ;bscan ,

040A C8         RZ
; SCAN A LINE NUMBER
SCANLINN:

040B 28         DCX     H       ;SCAN LINE # IN COMMAND/STATEMENT
SCANLINR:

040C 110000     LXI     D,0     ;DEFAULT LINE IS 0, INITIALIZE
SCANLINL:

O40F CDABO3     CALL    SCANNXT ;bscan ,

0412 DO         RNC

0413 E5         PUSH    H

0414 F5         PUSH    PSW

0415 219819     LXI     H, OFFFFH/10-1

0418 CD0000     CALL    CMHLLTDE

041B DA0000     JC      ERRASN

O41E 62         MOV     H,D

041F 6B         MOV     L,E     ;HL=10*DE

0420 19         DAD     D             .

0421 29         DAD     H

0422 19         DAD     D

0423 29         DAD     H

0424 Fl         POP     PSW

0425 0630       SUI     "og"     ;GET VALUE OF NEXT DIGIT


=== PAGE _022 (PDF page 98) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 20
0427 SF         MOV     E,A

0428 1600       MVI     D,000H

042A 19         DAD     D       ;AND ADD IT ON

042B EB         XCHG

042C Et         POP     H

042D C30F04     JMP     SCANLINL


=== PAGE _023 (PDF page 99) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 21
; SEARCH FOR A GIVEN LINE NUMBER
LINESRCH:
0430 2A8103     LHLD    PROGBASE        ;LOOK FOR LINE NUMBER IN DE
LINESRCL:
0433 £5         PUSH    H       ;C=LINE FOUND
0434 CD0000     CALL    LINELINK        ;BC=LINE LOCATION, IF FOUND
0437 CA0000     Jz      POPHLRET        s=NEXT LINE, IF NOT FOUND
043A C5         PUSH    B       ;ADDRESS OF NEXT LINE
043B 7E         MOV     A.M     ;GET NUMBER OF CURRENT LINE
043C 23         INX     H
043D 66         MOV     H,M     :(from HL,MA)
O43E 6F         MOV     L,A
043F CD0000     CALL    CMHLLTDE
0442 £1         POP     H       ;HL=NEXT LINE
0443 Ci         POP     B                                 .
0444 3F         CMC
0445 C8         RZ
0446 D23304     JNC     LINESRCL
0449 60         MOV     H,B
044A 69         MOV     L,C
044B 3F         CMC
044C C9         RET
; LINK TO NEXT LINE
LINELINK:
044D E5         PUSH    H       ;FIND ADDRESS OF NEXT LINE
O44E 4E         MOV     C.M     ;Z=END OF PROGRAM
O44F 23         INX     H                                                                                 ;
0450 46         MOV     BM
0451 23         INX     H
0452 E3         XTHL
0453 09         DAD     B       ;ADD LENGTH TO ADDRESS
0454 £3         XTHL
0455 78         MOV     A,B
0456 B1         ORA     Cc
0457 C1         POP     B
0458 C9         RET


=== PAGE _024 (PDF page 100) ===
basIC.LST                       5-Sep-78 14:14:39                                            Page 22
; INSERT/REPLACE LINE OF PROGRAM
LINEINS:
0459 D5         PUSH    D       ;DE=LINE NUMBER
045A D40000     CNC     KEYSCAN ;C#ALREADY KEY-SCANNED                          :
045D CDABD3     CALL    SCANNXT ;bscan ,        ;NC=MUST BE KEY-SCANNED
0460 Di         POP     D
0461 £5         PUSH    H       ;HL= TEXT TO INSERT
0462 DS         PUSH    D
0463 C5         PUSH    B       ;BC=LENGTH OF TEXT
0464 FS         PUSH    PSW     ;Z=DELETE, NO REPLACE
0465 CD3004     CALL    LINESRCH        ;LOOK FOR LINE
0468 C5         PUSH    B       ;SAVE LOCATION
0469 DC0000     cc      LINEDEL ;DELETE IF PRESENT
O46C D1         POP     D
0460 Fi         POP     PSW
O46E CA0000     Jz      POPHL3RT        sEXIT IF NOTHING MORE
0471 2A8703     LHLD    FREELIMT        ;PULL APART FOR NEW LINE
0474 £3         XTHL
0475 C1         POP     B
0476 E5         PUSH    H
0477 09         DAD     B
0478 CD0000     CALL    COPYCHK
047B EB         XCHG
047C C1         POP     B
047D 71         MOV     M,C     ;BEGINNING OF NEW LINE
O47E 23         INX     H
047F 70         MOV     MB
0480 23         INX     H
0481 D1         POP     D
0482 73         MOV     M,E     ; INSERT LINE NUMBER
0483 23         INX     H
0484 72         MOV     M,O
0485 23         INX     H
0486 EB         XCHG
0487 £1         POP     H       ;RECOVER TEXT POINTER
LINEINSL:
0488 7E         MOV     AM     INSERT TEXT OF NEW LINE
0489 12         STAX    D
048A 23         INX     H
048B 13         INX     D
048C B7         ORA     A
048D C28804     JNZ     LINEINSL
0490 C30000     JMP     LINEDELU


=== PAGE _025 (PDF page 101) ===
basIC.LST                       5-Sep-78 14:14:39                                            Page 23
; DELETE TEXT FROM PROGRAM
LINEDEL:

0493 EB         XCHG            ;BC=BEGINNING OF TEXT TO REMOVE

0494 79         MOV     A,C

0495 93         SUB     E       ;COMPUTE NEGATIVE OF

0496 6F         MOV     L,A     ;NUMBER OF BYTES DELETED

0497 78         MOV     A,B

0498 9A         SBB     D

0499 67         MOV     H,A

049A E5         PUSH    H

049B 2A8703     LHLD    FREELIMT        ;HL=BEGINNING OF TEXT SURVIVING
LINEDELL:

O49E 1A         LDAX    D                                                           .

O49F 02         STAX    B

O4A0 03         INX     B

04A1 13         INX     D

04A2 Cpo000     CALL    CMHLLTDE

04A5 D29E04     ONC     LINEDELL

04A8 C1         POP     B                                                                              .
LINEDELU:

04A9 2A8703     LHLD    FREELIMT        ;UPDATE DATA POINTERS

O4AC 09         DAD     B       ;BC=INCREMENT

O4AD 228703     SHLD    FREELIMT

0480 2A8503     LHLD    MATTABLE

0483 09         DAD     B

04B4 228503     SHLD    MATTABLE

04B7 2A8303     LHLD    VARTABLE

O4BA 09         DAD     B

O4BB 228303     SHLD    VARTABLE

04BE C30000     JMP     CLEARPCN
; MAKE SIXTEEN BIT COMPARISON
CMHLLTDE:

04C1 7C         MOV     A,H     ;COMPARE DE VS HL

04C2 92         SUB     )       + C=HL<DE

04C3 CO         RNZ

04C4 70         MOV     A,L

04C5 93         SUB     E

o4c6 C9         RET


=== PAGE _026 (PDF page 102) ===
basIC.usT            5-Sep-78 14:14:39                       Page 24
; MOVE LONG TO HIGHER ADDRESS
COPYCHK:
04c7 cbp0000     CALL    SPACECHK
COPYTEXT:
O4CA C5         PUSH    B       ;COPY SECTION DE-BC TO AREA
O4CB E3         XTHL            ;ENDING AT HL
04cCc C1        POP    B
COPYTXTL:
o4cp cO0C104    CALL   CMHLLTDE |
04D0 7E         MOV     A.M
04D1 02         STAX    B
04D2 C8         RZ
0403 OB         DCX     B
0404 2B         DCX     H
04D5 Cc3cD04     JMP     COPYTXTL                          .
; CHECK SPACE FOR STACK ALLOCATION
SPACESTK:
04D8 E5         PUSH    H       ;VERIFY STACK HAS ROOM ENOUGH
0409 2A8703     LHLD    FREELIMT        ;C=NUMBER OF WORDS NEEDED
O4DC 0600       MVI     B,0O00H
O4DE 09         DAD     B
O4DF 09         DAD     B
04E0 CD0000     CALL    SPACECHK
04E3 E1         POP     H
O4E4 C9         RET
; CHECK SPACE FOR PROGRAM OR VARIABLE ALLOCATION
SPACECHK:
O4E5 D5         PUSH    D       ;CHECK THAT ENOUGH SPACE IS LEFT
O4E6 EB         XCHG            ;ON STACK ABOVE HL
O4E7 21DAFF     LXI     H,-38
O4EA 39         DAD     SP
O4EB CDC104     CALL    CMHLLTOE
O4EE EB         XCHG
O4EF D1         Pop     D
O4FO0 DO          RNC        :
ERRAOM:
O4F1 1647       MVT     E, ERRNOM-ERRN
O4F3 C30000     JMP     ERRMSG


=== PAGE _027 (PDF page 103) ===
basIC.LST                      5-Sep-78 14:14:39                                          Page 25
; RE-INITIALIZATION ROUTINES
NEWSTM:
O4F6 CO         RNZ             ;NEW COMMAND
CLEARPGM:                                                           :
O4F7 2A8103     LHLD    PROGBASE        ;CLEAR PROGRAM
O4FA AF         XRA     A
O4FB 77         MOV     M,A
O4FC 23         INX     H
O4FD 77         MOV     MA
O4FE 23         INX     H
NEWLOAD:
O4FF 228303     SHLD    VARTABLE
CLEARSET:
0502 cD0000     CALL    CLEARPCN        ;CLEAR PROGRAM POINTERS
CLEARVST:
0505 227703     SHLD    PROGCNTR        ;UPDATE PROGRAM COUNTER
0508 CD0000     CALL    CLEARVAR        ;CLEAR VARIABLES
CLEARSTK:
050B C1         POP     B       ;RESET STACK,
050C 2A8903     LHLD    STCKBASE
O50F F9         SPHL
0510 2160FF     LXI     H,O-LINESYZE-3
0513 39         DAD     SP
0514 FO         SPHL            ;CREATE INPUT BUFFER
0515 227F03     SHLD    INPTBUFR
0518 2A8D03     LHLD    STRGBASE        ;CLEAR STRING TEMPORARIES,
051B 23         INX     H                         ;                                                ;
051C 228F03     SHLD    STRGTMPP
051F 210000     LXI     H,0
0522 £5         PUSH    H
0523 227903     SHLD    PROGCNTS        ;SET NO CONTINUE.
0526 2A7703     LHLD    PROGCNTR
0529 C5         PUSH    B
052A CQ         RET
CLEARVAR:
052B 2A8303     LHLD    VARTABLE        ;CLEAR ALL VARIABLES
052E 228503     SHLD    MATTABLE
0531 228703     SHLD    FREELIMT
0534 2A8D03     LHLD    STRGBASE
0537 228803     SHLD    STRGFREE
053A C9         RET
CLEARPCN:
053B 210000     LXI     H,0     ;CLEAR PROGRAM POINTERS
053E 227903     SHLD    PROGCNTS
0541 2A8103     LHLD    PROGBASE
0544 2B         DCX     H            :
0545 3600       MVI     M,O     ;END OF LINE -1
0547 227703     SHLD    PROGCNTR
O54A AF         XRA     A


=== PAGE _028 (PDF page 104) ===
basIC.LST                      §-Sep-78 14:14:39                                          Page 26
; RESTORE: REWIND DATA STATEMENTS
RESSTM:

054B CA0000     JZ      RESSTMDF        ;RESTORE STATEMENT

054E CDOB04     CALL    SCANLINN

0551 £5         PUSH    H

0552 CD3004     CALL    LINESRCH

0555 D20000     JNC     ERRAUS

0558 £1         POP     H

0559 EB        XCHG

055A C30000     JMP     RESSTMBU
RESSTMDF:

055D EB         XCHG            ;DEFAULT IS RESTORE TO BEGINNING

055E 2A8103     LHLD    PROGBASE
RESSTMBU:

0561 2B         DCX     H       :BACK UP BEFORE LINE
RESDTPTR:

0562 227003     SHLD    CURDATAP        ;SET DATA POINTER

0565 EB         XCHG

0566 C9          RET                                                                                        .
; CLEAR: CLEAR VARIABLES, REALLOCATE STRING SPACE
CLRSTM;:

0567 CA0505     Jz      CLEARVST        ;CLEAR STATEMENT

056A CDO000     CALL    VALINTDE

056D 2B         DCX     H       ;bscan -

O56E CDABO3    CALL   SCANNXT ;bscan ,

0571 CO         RNZ

0572 £5         PUSH    H

0573 2A8D03     LHLD    STRGBASE

0576 7D         MOV     A,L

0577 93         SUB     E

0578 5F         MOV     E,A                                                                        :

0579 7C         MOV     A,H

057A 9A        SBB    D

057B 57         MOV     DA

057C DADO     Jc      ERRASN

O57F 2A8303     LHLD    VARTABLE

0582 012800     LXI     B,40

0585 09         DAD     B

0586 CDC104     CALL    CMHLLTDE                             .

0589 D2F104    JNC    ERRAOM

058C EB         XCHG

058D 228903    SHLD    STCKBASE

0590 E1         POP     H

0591 C30505     JMP     CLEARVST


=== PAGE _029 (PDF page 105) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 27
; LOW-LEVEL CHARACTER 1/0 ROUTINES
PRNTCHRI:
0594 £3         XTHL
0595 7E         MOV     A.M
0596 23         INX     H
0597 £3         XTHL
PRNTCHRA:
0598 F5         PUSH    PSW     ; TRANSMIT CHARACTER
0599 3A6503     LDA     PRINTFLG
059C B7         ORA     A
059D C20000     JNZ     POPAFRET
O5A0 F1         POP     PSW
O5A1 FS         PUSH    PSW
O5A2 FE20       CPI     "                                                         ;
05A4 DA0000     Jc      PRNTCHRW
O5A7 E56         PUSH    H
O5A8 2A9903     LHLD    CURSPOS ;LINE TOO LONG?
O5AB 7C         MOV     A,H
OSAC 85         ADD     L
O5AD 7D         MOV     A,L                                                                            :
OSAE E1         POP     H
GO5AF DCO000     cc      PRNTCRLF
Q5B2 3C         INR     A
05B3 329903     STA     CURSPOS
PRNTCHRW:
O5B6 F1         POP     PSW     ;SEND CHARACTER
05B7 CD2A00     CALL    SYSDISPL
OSBA C9         RET
INPTCHAR:
O5BB CDO600     CALL    SYSKEYIN        ;RECEIVE A CHARACTER
OS5BE CABBOS     JZ      INPTCHAR        ;WAIT FOR ONE
05C1 FEOF       CPI     SI
05C3 CO         RNZ
05C4 3A6503     LDA     PRINTFLG                                                                       :
O5C7 2F         CMA
05C8 326503     STA     PRINTFLG
O5CB C3BB05     JMP     INPTCHAR


=== PAGE _030 (PDF page 106) ===
basIC.LST                      5-Sep-78 14:14:39                                          Page 28
; ERROR PROCESSING
MSGERROR:
O5CE 204552     DB      " ERROR", 6
05D1 524F52
0504 00
MSGIN:
05D5 20494E     DB      "IN ",0
05D8 2000
MSGOK:
O5DA ODOA4F     DB      CR,LF,"OK",CR,LF,0
05DD 4BOD0A
O5E0 00
MSGBREAK:
O5E1 ODOA42     DB      CR,LF,"BREAK",0
05E4 624541
05E7 4800                                                  .
ERRDATA:
O5E9 2A7B03     LHLD    CURLDATA
O5EC 227303     SHLD    CURLINE
ERRASN:
OSEF 1£A9       MVI     E, ERRNSN-ERRN
ERRMSG:
O5F1 CD0B05     CALL    CLEARSTK
O5F4 AF         XRA     A
O5F5 326503     STA     PRINTFLG        ;TURN ON PRINTING
O5F8 326703     STA     SCANPFLG        ;ALLOW SUBSCRIPTING
O5FB CD0000     CALL    PRNTCRLF
O5FE 217302     LXI     H, ERRN
0601 57         MOV     DLA
0602 CD9405      CALL     PRNTCHRI         sprint (val)
0605 3F         DB      "?™
0606 19         DAD     D       ;PRINT ERROR CODE
0607 CDO000     CALL    PRNTMSG
O60A 21CE05     LXI     H, MSGERROR
ERRMSGPR:
060D cDa000     CALL    PRNTMSG
0610 2A7303     LHLD    CURLINE
0613 7C         MOV     A,H
0614 AS         ANA     L
0615 3C         INR     A
0616 C40000     CNZ     ERRMSGIN


=== PAGE _031 (PDF page 107) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 29
>; COMMAND/LINE INPUT
CMNDSTRT:
0619 AF         XRA     A       ;TOP LEVEL EXECUTIVE
O61A 326503     STA     PRINTFLG        ;TURN ON PRINTING                       :
061D 326703     STA     SCANPFLG        s;ALLOW SUBSCRIPTING
0620 21FFFF     LXI     H,-1
0623 227303     SHLD    CURLINE
0626 21DA05     LXI     H,MSGOK
0629 cD0000     CALL    PRNTMSG ;REQUEST COMMAND
CMNDINPT:
o62C 110000     LXI     D,MSGSTARS+2    ; INPUT COMMAND
o62F CD0000     CALL    INPTRQST
0632 DA2CO6     Jc      CMNDINPT
0635 CDABO3     CALL    SCANNXT ;bscan ,
0638 F5         PUSH    PSW
0639 CDOB04     CALL    SCANLINN        ;SCAN OFF LINE NUMBER
063C D5         PUSH    D
063D CD0000     CALL    KEYSCAN ;SCAN STATEMENT
0640 D1         POP     D
0641 Fi         POP     PSW
0642 D20000     JNC     EXECUTE ;DIRECT IF NO LINE NUMBER
0645 CD5904     CALL    LINEINS ; INSERT LINE AS REQUESTED
0648 C32C06     JMP     CMNDINPT
CMNDRSTR:
064B CDOB05     CALL    CLEARSTK        ENTRY FOR RESTARTING
064E CD0000     CALL    PRNTCRLF                  ;                                                 ;
0651 210000     LXI     H,MSGREDO+11    ;TELL HIM WE"RE STARTING
0654 C30D06     JMP     ERRMSGPR


=== PAGE _032 (PDF page 108) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 30
; AUTOMATIC LINE~NUMBERED INPUT
AUTSTMIN:
0657 D5         PUSH    D       ; SAVE LINE NUMBER
0658 CD5904     CALL    LINEINS ; INSERT LINE
065B E1         POP     H       ;RECOVER LINE NUMBER,
065C D1         POP     D       ; INCREMENT
065D 19         DAD     D
O65E DA0000     Jc      ERRAOV
0661 C30000     JMP     AUTSTNN
AUTSTM:
0664 C1         POP     B       ;REMOVE CALLER
AUTSTMS:
0665 11€803     LXI     D,1000 ;DEFAULT STARTING LINE NUMBER
0668 016400     LXI     B,100   :DEFAULT INCREMENT VALUE
O66B CDE703     CALL    SCANLPRM        ;SCAN PARAMETERS
O66E C2EF05     JNZ     ERRASN
0671 £1         POP     H
0672 CD0000     CALL    PRNTCRLF
AUTSTMN:
0675 D5         PUSH    D       +SAVE INCREMENT
0676 E5         PUSH    H       ;AND NEXT LINE NUMBER
0677 CD0000     CALL    ENCODEHL        ;PROMPT WITH LINE NUMBER
067A EB         XCHG
067B 13         INX     D
067C CD0000     CALL    INPTRQST
O67F D1         POP     D
0680 DA0000     Jc      AUTSTMBR
0683 CDABO3     CALL    SCANNXT ;bscan ,
0686 D25706     JNC     AUTSTMIN
0689 3F         CMC
AUTSTMBR:
068A D1         POP     D       ; TAKE A BREAK
068B DA1906     Jc      CMNDSTRT        ;END OF AUTO
O68E C36506     JUMP     AUTSTMS ;GET NEW LINE NUMBER, INCREMENT                                        ;


=== PAGE _033 (PDF page 109) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 31
; LEXICAL SCANNER / KEYWORD RECOGNITION
KEYSCAN;
0691 OE05       MVI     C,5     ;SCAN INPUT LINE FOR KEYWORDS,
0693 54         MOV     DH     ;CONDENSE LINE ON TOP OF SELF
0694 5D         MOV     E,L
0695 2B          DCX      H        ;bscan -
0696 E5         PUSH    H
0697 CDABO3     CALL    SCANNXT ;bscan +
KEYSCANL:             .
O69A 7E         MOV     A.M
069B FE20       CPI     “oe
069D CA0000     Jz      KEYSCANH        ;DELETE BLANKS
O6A0 47         MOV     B,A
O6A1 FE22       CPI     a
06A3 CAN000     JZ      KEYSCANT        ;SWALLOW WHOLE STRING
O6A6 B7         ORA     A
O6A7 CA0000     JZ      KEYSCANX
O6AA FE30       CPI     "o"     ;NON-KEYWORD
O6AC DAQ000     Jc      KEYSCANK
O6AF FE3C       CPI     nen     ;   SO WE DON"T SCAN
06B1 DA0000     Jc      KEYSCANP
KEYSCANK:
06B4 C5         PUSH    B       ;SCAN FOR MATCHING KEYWORD
O6B5 D5         PUSH    D
O6B6 E5         PUSH    H
O6B7 E60F       ANI     OOFH    ;HASH CHARACTER
O6B9 5F         MOV     E,A
O6BA 1600       MVI     0,0
QO6BC 21E400     LXI     H, KEYWADDS      ;ADDRESS C"SPONDING KEYWORDS
O6BF 19         DAD     D                                                                                 :
o6co0 19         DAD     D
06C1 5E         MOV     EM
06C2 23         INX     H
06C3 56         MOV     DM
06C4 EB         XCHG
06C5 €C30000     JMP     KEYSCANB
KEYSCANZ:
O6C8 1A         LDAX    D
06C9 B7         ORA     A
QO6CA F20000     JP      KEYSCANN
KEYSCANM:
O6CD 78         MOV     A,B     ;MATCH, GET SYMBOL NUMBER
O6CE F680       ORI     080H
06D0 C30000     JMP     KEYSCANF
KEYSCANN:
06D3 23         INX     H       sADDRESS NEXT CHAR IN LINE
06D4 13         INX     D
06D5 OC         INR     Cc
KEYSCANC:
O6D6 1A         LDAX    D       ;COMPARE LINE WITH KEYWORD
06D7 E67F       ANI     O7FH
06D9 CDCE03     CALL    CHARMTCH        ;COMPARE CHARACTERS


=== PAGE _034 (PDF page 110) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 32
O6DC CAC806     Jz      KEYSCANZ
O6DF 79         MOV     A,C     ;MATCH ENOUGH YET?
O6EO FEO3       CPI     3
O6E2 DA0000     Jc      KEYSCANA
O6E5 CDBBO3     CALL    ALPHACHK        ;STOP ON BREAK CHAR OK
OGE8 2B         DCX     H
06E9 D2CD06     JNC     KEYSCANM
KEYSCANA:
O6EC EB         XCHG
KEYSCANW:
O6ED B6         ORA     M       ;SKIP OVER REST OF KEYWORD
OGEE 23         INX     H
O6GEF F2ED06     JP      KEYSCANW
O6F2 A&         XRA     B
KEYSCANB;
OGF3 46         MOV     B,M     ;GET CODE FOR KEYWORD
O6F4 23         INX     H
O6F5 EB         XCHG
O6F6 E1         POP     H       s;RESTORE STARTING POSITION
OGF7 E56         PUSH    H
O6F8 OE00       MVI     c,0
OGFA F2D606     oP      KEYSCANC
OGFD 7E         MOV     A.M     ;NO MATCH, GET CHARACTER
KEYSCANF:
OGFE D1         POP     D       ;RECOVER OUTPUT POINTER
OGFF D1         POP     D
0700 C1         POP     B
0701 063A       MVI     B,":"   ;CHECK FOR SPECIAL PROCESSING
0703 FEBC       CPI     KEYELS                    ;                                                 ;
0705 €20000     JINZ     KEYSCAND
0708 EB         XCHG
0709 70         MOV     M,B     ; INSERT COLON BEFORE ELSE
070A EB         XCHG                                     .
070B 13         INX     D
070C oc         INR     C
KEYSCAND:
070D FE80       CPI     KEYDAT
070F CA0000     uZ      KEYSCANI
0712 0600       MVI     B,0                                                ;
0714 FE81       CPI     KEYREM
0716 CA0000     jz      keyscani
0719 FE9C       cpi     keycid ;pass file name in load and save
071B CA0000     jz      keyscani
O71E FE9D       cpi     keycsv
KEYSCANI:
0720 CC0000     CZ      KEYSCANV
0723 B7         ORA     A
0724 CA0000     Jz      KEYSCANX
KEYSCANP:
0727 12         STAX    D       ; INSERT SYMBOL IN MEMORY
0728 13         INX     D
0729 OC         INR     Cc
KEYSCANH:
072A 23         INX     H
072B C39A06     JMP     KEYSCANL


=== PAGE _035 (PDF page 111) ===
basIc.LST                      5-Sep-78 14:14:39                                         Page 33
KEYSCANX:
072E E1         POP     H       ;EXIT KEYWORD TRANSLATION
O72F 12         STAX    D       ;END OF STATEMENT
6736 13         INX     D
0731 12         STAX    D       ;END OF "PROGRAM"
0732 13         INX     D
0733 12         STAX    D
0734 47         MOV     B,A     ;LENGTH IN BC
0735 C9         RET
; COPY BUFFER TEXT WITHOUT PROCESSING
KEYSCANV:                ,
0736 12         STAX    D       ;COPY TEXT VERBATIM TO STOPPER
0737 OC         INR     Cc
0738 13         INX     D
0739 23         INX     H
073A 7E         MOV     A.M
073B B7         ORA     A
073C C8          RZ                                                                                          :
073D B8&         CMP     B
073E C8         RZ
O73F FE22       CPI     a      iSTRING WITHIN TEXT?
0741 €23607     JNZ     KEYSCANV
0744 C5         PUSH    B
0745 47       MOV    B,A
0746 CD3607    CALL   KEYSCANV
0749 F1       POP    PSW
O74A 47       MOV    B,A
074B 7E       MOV    AM
074C B7         ORA     A       ;STRING TERMINATE ON END OF LINE?
074D C8         RZ
074E C33607     JMP     KEYSCANV


=== PAGE _036 (PDF page 112) ===
basIC.LST                      5~Sep-78 14:14:39                                  :      Page 34
; LINE INPUT ROUTINE
INPTLNBS:
0751 2B         DCX     H       ;DELETE A CHARACTER FROM INPUT
0752 05         OCR     B
0753 CA0000     Jz      INPTLNRD
0756 CD9405     CALL    PRNTCHRI        sprint (val)
0759 5C         DB      '\
075A OC         inr     Cc               ;char count
075B C30000     JMP     INPTLINL
INPTLNRD:
O75E 210000     LXI     H,MSGSTARS      ;BREAK ENTERED
0761 CDO0000     CALL    PRNTMSG ;TELL HIM WE GOT IT
0764 05         DCR     B       ;BREAK AT BEGINNING MEANS BREAK
0765 CA0000     Jz      INPTEXIT
INPTCRLF:
0768 CDO000     CALL    PRNTCRLF        3;ON THE NEXT LINE
INPTRQST:
076B 62         MOV     H,D
076C 6B         MOV     L,E     ;PRINT USER"S PROMPT MESSAGE
076D cDO000     CALL    PRNTMSG
0770 2A7F03     LHLD    INPTBUFR        ; INPUT A LINE FROM RECEIVER
0773 010001     LXI     B,1*256
0776 CD9405     CALL    PRNTCHRI        sprint (val)
0779 20         DB      ve             30K, WE"RE READY FOR INPUT
INPTLINL:
077A 3600       MVI     M,0     sMAINTAIN ENDING ZERO
077C CDBB05     CALL    INPTCHAR
INPTLINC:
O77F FEO7       CPI     BEL                                                                               :
0781 CA0000     Jz      INPTLNST        ;BELL"S OK
0784 FEOD       CPI     CR
0786 CA0000     Jz      INPTCRIN        ;CARRIAGE RTN IS END OF LINE
0789 FE08       CPI     BS
078B CA5107     Jz      INPTLNBS        ;BACKSPACE IS DELETE
078E FE03       CPI     ETX     sCONTROL C IS ABORT
0790 CA5E07     JZ      INPTLNRD        sFORGET THIS LINE, START OVER
0793 FEOC       CPI     FF      ;FORM FEEDS ARE ECHOED                                                .
0795 CA0000     JdZ      INPTLNEC
0798 FE20       CPI     vo
079A DA7A07     Jc      INPTLINL        ; IGNORE OTHER CONTROL CHARS


=== PAGE _037 (PDF page 113) ===
basIC.LST                      §-Sep-78 14:14:39                                         Page 35
INPTLNST:
079D 77         MOV     M,A     :STORE THE CHARACTER
O79E 78         MOV     A,B
O79F FESD       cPI     LINESYZE
07A1 3E07       MVI     A, BEL
07A3 D20000     JNC     INPTLNEC                                                :
O7A6 04         INR     B
O07A7 B1         ORA     c
O7A8 4E         MOV     CM
07A9 23         INX     H
O7AA 3E0A       MVI     A,LF
O7AC FC9805     CM      PRNTCHRA
O7AF 79         MOV     A,c
INPTLNEC:
07B0 CD9805     CALL    PRNTCHRA        ;ac -> screen   ;ECHO CHARACTER
07B3 C37A07     JMP     INPTLINL
INPTCRTN:
07B6 05         DCR     B       ;CARRIAGE RETURN AT BEGINNING
07B7 CA6807     Jz      INPTCRLF        :GETS ANOTHER TURN
INPTEXIT:
O7BA 2A7F03    LHLD   INPTBUFR
07BD 2B       DCX    H
07BE CD0000    CALL    PRNTCRLF
07C1 90         SUB     B       ;SET CONDITION CODES
07C2 3F         CMC                     :S=C=NZ = BREAK
07C3 OF       SBB    A      sNS=NC=Z = NON-EMPTY LINE
07C4 C9         RET
MSGSTARS:                                                                               ,
07C5 2A2A2A    DB     veeer 9   ;
07C8 00


=== PAGE _038 (PDF page 114) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 36
; SET OPTIONS COMMAND
SETSTM:
07C9 CAEFOS     Jz      ERRASN ;TURN OPTION ON OR OFF
07CC FE99       CPI     KEYLIS
07CE CAG000     Jz      SETSTMLS
0701 FS         PUSH    PSW     ;SAVE OPTION
07D2 CDABO3     CALL    SCANNXT ;bscan ,
07D5 CAEFOS     JZ      ERRASN
0708 D691       SUI     KEYON
O7DA 47         MOV     B,A     ;SAVE FLAG
07DB CDAB03     CALL    SCANNXT ;bscan +
O7DE Fi         POP     PSW     ;WHICH OPTION
O7DF FE89       CPI     KEYGTO
07E1 CA0000     Jz      SETSTMGT        :GOTO
O7E4 FE96       CPI     KEYPRT
O7E6 C2EF05     JNZ     ERRASN
SETSTMPR:
O7E9 78         MOV     A,B
O7EA 326303     sta     p3010           sused to be printfig **                                        .
O7ED C9         RET
SETSTMGT:
O7EE 78         MOV     A,B
O7EF 326603     STA     TRACEFLG
O7F2 C9         RET
SETSTMLS:
O7F3 23         INX     H
O7F4 CD0000     CALL    VALBYTE
O7F7 2F         CMA                     ;FIND NEGATIVE OF BYTE
O7F8 3C         INR     A
O7F9 329A03     STA     CURSLIM
O7FC C9         RET
; DELETE COMMAND PROCESSOR
DELSTM:
O7FD 11FFFF     LXI     D,OFFFFH        ;DELETE COMMAND
0800 CDE403     CALL    SCANLPRZ
0803 E3         XTHL            ;SAVE SCAN POINTER
0804 EB         XCHG
0805 CDC104     CALL    CMHLLTDE        sVERIFY FIRST<=LAST
0808 DAEFO5     Jc      ERRASN
O80B E&         PUSH    H                                       .
o80C CD3004     CALL    LINESRCH        ;LOOK FOR FIRST LINE
O80F D1         POP     D
0810 C&         PUSH    B
0811 CD3004     CALL    LINESRCH        ;LOOK FOR LAST LINE
0814 C1         POP     B
0815 CD9304     CALL    LINEDEL
0818 E1         POP     H
0819 C9         RET


=== PAGE _039 (PDF page 115) ===
basIC.LST            5-Sep-78 14:14:39                       Page 37
; LIST COMMAND PROCESSOR
LISSTM:
081A 110000     LXI     D,0     ;LIST COMMAND
0810 O1FFFF     LXI     B,OFFFFH        ;TOTAL DEFAULT IS ENTIRE FILE
0820 CA0000    JZ     LISSTMSC
0823 010000     LXI     B,0     ;ELSE DEFAULT IS ONLY ONE LINE
LISSTMSC:
0826 CDE703     CALL    SCANLPRM        ;SCAN LINE PARAMETERS
0829 C2EFO5     JNZ     ERRASN    ;
082C E3         XTHL
082D EB         XCHG
O82E E5       PUSH   H
082F CD3004     CALL    LINESRCH
0832 C5         PUSH    B
LISSTMLP:                                      °
0833 C1         POP     B       ;MOVE ON TO NEXT LINE
0834 D1         POP     D
0835 £1         POP     H
0836 CD3E00     CALL    SYSBREAK        ;ALLOW BREAK
0839 CA0000     Jz      EXECUTEB
083C C5         PUSH    B
083D E3         XTHL
083E CD4D04     CALL    LINELINK
0841 CA0000     Jz      POPHLRET        ;END OF PROGRAM, QUIT
0844 D5         PUSH    D
0845 C5         PUSH    B
0846 £5         PUSH    H       ;SAVE TEXT FOR LATER
0847 4E         MOV     c,M     ;FETCH LINE NUMBER
0848 23         INX     H
0849 46         MOV     B,M                                                                               :
084A 60         MOV     H,B
084B 69         MOV     L,c
084C EB         XCHG
084D CDC104     CALL    CMHLLTDE
0850 DA0D00     Jc      LISSTMXT        ;LAST LINE REACHED?
0853 Cp0000     CALL    PRNTCRLF        ;LIST CURRENT LINE
0856 EB         XCHG
0857 CD0000     CALL    PRINTINT        ;PRINT LINE NUMBER
085A CD9405     CALL    PRNTCHRI        sprint (val)
85D 20         DB      "e     ;FOLLOWED BY BLANK
OB85E Et         POP     HO
085F CD0000     CALL    LISEDIXP        sEXPAND TEXT
0862 CD0000     CALL    PRNTMSG ;AND PRINT IT
0865 21A000     LXI     H,O+LINESYZE+3
0868 39         DAD     SP
0869 F9         SPHL            ;DEALLOCATE EXPANDED TEXT
Q86A C33308     JMP     LISSTMLP


=== PAGE _040 (PDF page 116) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 38
LISSTMXT:
086D E1         POP     H
POPHLSRT:
O8GE Et         POP     H
O86F Et         POP     H
POPHLRET:
0870 E14         POP     H
0871 C9         RET
; EXPAND KEYWORDS IN LINE / INVERSE OF KEYSCAN
LISEDIXP:
0872 OE4E       MVI     C,LINESYZE/2 | ;SPACE ENOUGH TO EXPAND LINE?
0874 CDD804     CALL — SPACESTK
0877 EB         XCHG            ;SAVE POINTER TO LINE TO EXPAND
0878 C1         POP     B       ;AND CALLER
0879 2160FF     LXI     H, O-LINESYZE-3
087C 39         DAD     SP
087D F9         SPHL            ;CREATE TEXT BUFFER ON STACK
O87E C5         PUSH —B       ;PUT BACK CALLER
087F EB         XCHG
0880 23         INX     H
0881 23         INX     H       ;plus 2
0882 ES         PUSH «4H       ;SAVE TEXT POINTER
0883 210400     LXI     H,4     ;CREATE POINTER TO EXPAND TEXT
0886 39         DAD     SP
0887 EB         XCHG
0888 069D       MVI     B, LINESYZE      ; INITIALIZE LENGTH COUNTER
088A C30000     JMP     LISEDIKD
LISEDISC:
088D CD0000     CALL —_ LISEDIST        ;STUFF ONE CHARACTER OF LINE
LISEDIKD:
0890 E1         POP     H       ;DO0 REST OF LINE
0891 7E         MOV     A.M
LISEDINC;
0892 23         INX     H
0893 FE3A       cPI     me
0895 C20000     JNZ     LISEDIKT
0898 7E         MOV     A.M
0899 FE8C       cPI     KEYELS ;:ELSE BECOMES ELSE
089B CAQ208     Jz      LISEDINC
O89E 3E3A       MVI     A,":"
LISEDIKT:
O8A0 A7         ANA     A       ;MOVE HIGH ORDER INTO S-FLAG
08A1 CA0000     Jz      LISEDIXT
OBA4 ES         PUSH =H
08A5 F28008     JP      LISEDISC
08A8 4F         MOV     CA


=== PAGE _041 (PDF page 117) ===
basIC.LST            5-Sep-78 14:14:39                      Page 39
O8A9 21A0A3     LXI     H, KEYLSBH*256+KEYLSBL
O8Ac CD0000     CALL    LISEDISB        ;OPTIONAL BLANK BEFORE KEYWORD
O8AF 210401     LXI     H, KEYWORDS      ;SEARCH FOR KEYWORD
o8B2 C3000     JMP     LISEDIKS
LISEDIKL:
08B5 86       ORA    M
08B6 23        INX    H
08B7 F2B508     JP      LISEDIKL
LISEDIKS:
O8BA 7E         MOV     A,M     ;FETCH KEYWORD NUMBER
O8BB F680      ORI    080H
08BD 23         INX     H
O8BE AQ         XRA     Cc
O8BF C2B508     JNZ     LISEDIKL
LISEDIKY:                                                               :
08C2 7E         MOV     A,M     sEXPAND KEYWORD
08C3 07         RLC
08C4 A7         ANA     A       ;HIGH-ORDER TO CARRY
08C5 1F         RAR
o0scé CcD0000     CALL    LISEDIST        sSTUFF THIS CHARACTER
08scg 23         INX     H                                                                              :
08CA D2C208     JNC     LISEDIKY        300 THEM ALL
0acod 79         MOV     A,C
O8CE 2182A5     LXI     H, KEYLSAH*256+KEYLSAL
08D1 CDO000     CALL    LISEDISB        sOPTIONAL BLANK AFTER KEYWORD
08D4 C39008     JMP     LISEDIKD
LISEDISB:
08D7 BD         CMP     L       ; INSERT BLANK IN LINE IF
08D8 D8         RC              3b <= A <H
08D9 BC         CMP     H
O8DA DO         RNC
O8DB 3620       MVI     A," "   ;GENERATE BLANK                                                       .
LISEDIST:
OBDD 12         STAX    D
O8DE 13         INX     D
O8DF 05       DCR    B
O8EO CO         RNZ             ; TRUNCATE TOO LONG A LINE
OBE1 04         INR     B
OBE2 2B         DCX     H
O8E3 C9         RET
LISEDIXT:
O8E4 12         STAX    D
O8E5 3E9E       MVI     A,LINESYZE+1    ;COMPUTE LENGTH OF OUTPUT
Q8E7 90         SUB     B
O8E8 47         MOV     B,A
O8ES 210200     LXI     H,2     ;CREATE POINTER TO EXPAND TEXT
OBEC 39         DAD     SP
O8ED C9         RET             ;AND RETURN


=== PAGE _042 (PDF page 118) ===
basiC.LST                      5-Sep-78 14:14:39                                         Page 40
; EDIT COMMAND PROCESSOR
EDISTM:
OBEE 110000     LXI     D,0     ;SCAN PARAMETERS
O8F1 CDE403     CALL    SCANLPRZ
O8F4 £3         XTHL            ;SAVE SCAN,
O8F5 226F03     SHLD    SCANPTR1        ;AND OUTPUT LINE NUMBER
08F8 CD3004     CALL    LINESRCH        ;LOOK UP LINE
O8FB D20000     INC     ERRAUS ;NOT FOUND...                                                   .
O8FE 60         MOV     H,B       .
OSFF 69         MOV     L,C
0900 23         INX     H
0901 23         INX     H       splus 2
0902 CD7208     CALL    LISEDIXP        ;EXPAND LINE
0905 2A6F03     LHLD    SCANPTR1        ;RECOVER LINE NUMBER
0908 E5         PUSH    H
EDISTMLS:
0909 CD0000     CALL    EDISTMCR        ;GIVE HIM A LOOK AT IT
o90c CD0000     CALL    PRNTMSG ;PRINT COPY OF TEXT
OSOF CD0000     CALL    EDISTMCR        ;A NEW EDIT LINE
0912 OEF01       MVI     C,1     ;POSITION COUNTER
EDISTMNX:
0914 CD0000     CALL    EDISTMCH        ;OK MASTER, TELL ME WHAT TO DO
0917 FE20       CPI     ee     MOVE ALONG
0919 CAG000     JZ      EDISTMAD
091C CDBCO3     CALL    ALPHACHA        ;CONVERT LOWER TO UPPER
O91F FE44       CPI     "p"     ; DELETE
0921 CA0000     JZ      EDISTMDL
0924 FE49       CPI     "i"     s INSERT
0926 CA0000     Jz      EDISTMIN
0929 FE52       CPI     "RY     ; REPLACE
092B CA0000     JZ      EDISTMRP
EDISTMER:
O92E 3E07       MVI     A, BEL   ;SQUAWK ABOUT ERROR
EDISTMEC:
0930 CD9805     CALL    PRNTCHRA        ;ac “> screen
0933 €31409     JMP     EDISTMNX
; ADVANCE
EDISTMAD:
0936 79         MOV     A,C
0937 B8&         CMP     B       ;CAN WE STILL ADVANCE?
0938 D22E09     JNC     EDISTMER
093B 0C         INR     Cc       ;ADVANCE POSITION COUNTER
093C 7E         MOV     A.M
093D 23         INX     H       ;PRINT CHARACTER PASSED OVER
O93E C33009     JMP     EDISTMEC                                                                          ;


=== PAGE _043 (PDF page 119) ===
basIC.LST                      5-Sep-78 14:14:39                                         Page 41
; DELETE
EDISTMDL:
0941 79         MOV     A,C
0942 B8         CMP     B       sANYTHING TO DELETE?
0943 D22E09     JNC     EDISTMER
0946 05         DCR     B       ;DECREASE CHARACTER COUNT
0947 E&         PUSH    H       ;SAVE CURRENT POSITION
0948 7E         MOV     A.M
0949 CD9805     CALL    PRNTCHRA        ;LIST CHARACTER DELETED
094C 64         MOV     D,H
094D 5D         MOV     E,L
EDISTMDM:
O94E 23         INX     H
OO4F 7E         MOV     A.M     ;MOVE THIS CHARACTER DOWNWARD
0950 12         STAX    D
0951 13         INX     D
0952 B7         ORA     A
0953 C24E09     JNZ     EDISTMDM
0956 Ei         POP     H
0957 €31409     JMP     EDISTMNX
: INSERT
EDISTMIN:
095A CD0000     CALL    EDISTMCH        ;GET SOMETHING TO PUT IN
095D 57         MOV     DA     ;SAVE COPY OF CHARACTER
EDISTMRI:
O95E 78         MOV     A,B                       ;                                                 ;
O95F FE9D       cPI     LINESYZE        ;ROOM AT THE INNPUT BUFFER?
0961 D22E09     JNC     EDISTMER
0964 04         INR     B       ;COUNT NEWCOMER
0965 OC         INR     Cc       NEXT ONE GOES AFTER HIM
0966 7A         MOV     A,D
0967 CD9805     CALL    PRNTCHRA        ac -> screen   ;PRINT NEWCOMER
O96A E5         PUSH    H       ;SAVE CURRENT POSITION
EDISTMIM:
O96B 5E         MOV     E,M
-096C 77         MOV     M,A     ;MOVE CHARACTERS UP ONE BYTE
096D B7         ORA     A
Q96E 7B         MOV     A,E
O96F 23         INX     H
0970 C26B09     JNZ     EDISTMIM
0973 E1         POP     H
0974 23         INX     H
0975 C35A09     JMP     EDISTMIN


=== PAGE _044 (PDF page 120) ===
basIC.LST            5-Sep-78 14:14:39                       Page 42
; REPLACE
EDISTMRP:
0378 Cd000d     CALL    EDISTMCH        ;GET UPDATE CHARACTER
097B 57         MOV     D,A
097C 79         MOV     A,C
097D B8&         CMP     B       REPLACING END OF LINE?
Q97E D25E09     JNC     EDISTMRI        ;1F SO, GO TO INSERT
0981 72         MOV     M,D     ;UPDATE THE CHARACTER
0982 0C        INR    C
0983 23         INX     H
0984 7A         MOV     A,D
0985 CD9805     CALL    PRNTCHRA        ;ac -> screen   PRINT NEWCOMER
0988 C37809     MP     EDISTMRP     ,
; SEARCH
EDISTMSR:
098B CD0000     CALL    EDISTMCH        FIND CHARACTER TO SEARCH FOR
O98E CDBC03     CALL    ALPHACHA        ;CONVERT TO STANDARD CASE
0991 57         MOV     D,A                                                                            :
0992 1E00       MVI     E,0
EDISTMSL:
0994 79         MOV     A,C
0995 BS         CMP     B
0996 D22E09     JNC     EDISTMER        ;NO MORE, TERMINATE SEARCH
0999 CDBBO03     CALL    ALPHACHK        ;FETCH CHARACTER IN STANDARD CASE
099C BB         CMP     E
099D CA1409     Jz      EDISTMNX        :;GOTTA MATCH?
O9A0 CD9805     CALL    PRNTCHRA        ;ac -> screen   ;LIST FAILURES
O9A3 OC         INR     Cc
Q9A4 23         INX     H
O9A5 5A         MOV     E,D
O9A6 C39409     JMP     EDISTMSL        ;AND KEEP LOOKING


=== PAGE _045 (PDF page 121) ===
basIC.LST            5-Sep-78 14:14:39                       Page 43
EDISTMXT:
O9A9 OD         DCR     Cc       ;BEGINNING CR MEANS DONE, UPDATE
O9AA C20909     JNZ     EDISTMLS        OTHERWISE, LIST, MORE EDITS
O9AD D1         POP     D       ;RETRIEVE LINE NUMBER
O9AE 210000     LXI     H,0
09B1 39         DAD     SP      ;POINT TO TEXT
09B2 CD5904     CALL    LINEINS ;AND REINSERT
EDISTMQT:
09B5 21A000     LXI     H, O+LINESYZE+3
O09B8 39         DAD     SP
O9B9 FQ       SPHL         ;DEALLOCATE TEXT BUFFER
O9BA E1         POP     H       ;RECOVER SCAN POINTER
O9BB C9         RET             ;AND RETURN
; LIST LINE, PREPARE FOR UPDATES
EDISTMCR:                                    .
OSBC D1         POP     D
O9BD E1         POP     H       ;RETRIEVE COPY OF LINE NUMBER
OOBE E5         PUSH    H       ;SAVE IT,
OSBF D5         PUSH    D
o9gco C5         PUSH    B       ;AND LINE LENGTH
09ci cD0000     CALL    PRNTCRLF
osc4 cp0000     CALL    PRINTINT        ;PRINT LINE NUMBER
09c7 CD9405     CALL    PRNTCHRI        sprint (val)
O9CA 20       DB     "
09CB 210600     LXI     H,6
OSCE 39         DAD     SP      :CREATE POINTER TO TEXT BUFFER
QOCF C1         POP     B
o9D0 C9         RET
; GET OPTION CHARACTER                                                                       ;
EDISTMCH:
09D1 CDBB05     CALL    INPTCHAR        ;GET CHARACTER ROUTINE
09D4 FE20       CPI     se
09D6 DO         RNC             ;NOT CONTROL, RETURN
O9D7 FEO7       CPI     BEL
09D9 C8         RZ
O9DA Di         POP     D       ;REMOVE CALLER
OSDB FEDS     CPI    HT     ;SEARCH (TAB)
O9DD CA8B09     Jz      EDISTMSR
O9E0 FEOD       CPI     CR -   ;LIST, OR UPDATE
Q9E2 CAAQO9     JZ      EDISTMXT
OSES FE1B       CPI     ESC     ; TERMINATE OPTION
O9E7 CA1409     JZ      EDISTMNX
O9EA FEO3       CPI     ETX     ;ABORT, NO UPDATE
OQ9EC C22E09     JNZ     EDISTMER
O9EF 21C€507     LXI     H,MSGSTARS      ; TYPE BREAK MESSAGE
OSF2 CbDO000     CALL    PRNTMSG
O9F5 D1         POP     D
O9F6 C3B509     JMP     EDISTMQT


=== PAGE _046 (PDF page 122) ===
basIC.LST            5-Sep-78 14:14:39                       Page 44
; SCAN STACK FOR "FOR" LOOP
O9F9 0010 FORBLCK    EQU    16     ;SIZE OF "FOR" STACK ENTRY
FORCHK:
Q9F9 210400     LXT     H,4     ;LOOK FOR MARK ON STACK                         :
O9FC 39         DAD     SP
FORCHKL:
O9FD 7E         MOV     A,M
OSFE 23         INX     H
OOFF FE83       CPI     KEYFOR
OA01 CO         RNZ
OAN2 3604       MVI     A, TYPESING
OA04 326803     STA     TYPEFLG ;SET CORRECT TYPE FLAG
OAO7 4E         MOV     C,M     ;MARK IS PRESENT
GA08 23         INX     H
QA09 46       MOV    B,M
OAODA 23         INX     H
QAOB E5       PUSH   H
OAOC 60         MOV     H,B
OA0D 69        MOV    L,Cc
QADE 7A         MOV     A,D     ;LOOKING FOR PARTICULAR VARIABLE?
OAOF B3         ORA     E
0A10 EB         XCHG
0A11 CA0000     JZ      FORCHKXT
0A14 EB         XCHG            31S THIS IT?
0A15 CDC104     CALL    CMHLLTDE
FORCHKXT:
0A18 010D00     LXI     B, FORBLCK-3               :                                                 ;
OA1B E1         POP     H
OAIC C8         RZ
OA1D 09         DAD —   B
OA1E C3FD09     JMP     FORCHKL                          .
; FOR STATEMENT PROCESSOR
FORSTM:
OA21 3EAB       MVI     A, SCANPFLD      ;FOR STATEMENT
0A23 326703     STA     SCANPFLG
0A26 CDO000     CALL    LETSTM
0A29 CDD903     CALL    TYPECHK
OA2C EA0000     JPE     ERRATM ;MUST BE SINGLE INDEX
OA2F £3         XTHL            ;SAVE SCANPTR, REMOVE CALLER
O0A30 EB         XCHG
0A31 227703     SHLD    VARINDEX
0A34 EB         XCHG
0A35 CDF909     CALL    FORCHK
OA38 D1         POP     D
OA39 C20000     JNZ     FORSTMNF      .
QA3C 09         DAD     B
OA3D F9         SPHL
FORSTMNF :
OA3E EB         XCHG
OA3F OE08       MVI     C, FORBLCK+1/2


=== PAGE _047 (PDF page 123) ===
basIC.LST                      §-Sep-78 14:14:39                                         Page 45
0A41 CDD804     CALL    SPACESTK
0A44 £6         PUSH    H
0A45 CD0000     CALL    DATSTM ;FIND FIRST STATEMENT IN FOR LOOP
GA48 £3         XTHL            ;AND SAVE
0A49 £5         PUSH    H
OA4A 2A7303     LHLD    CURLINE ;SAVE CURRENT LINE NUMBER
OA4D £3         XTHL
OA4E CDA303     CALL    SCANNXTV        :;bscan (val)
QOA51 Al         DB      KEYTO   ;SCAN LIMIT VALUE,
OA52 CD0000     CALL    VALNUMBR        ;bscan numbr
QA55 £5         PUSH    H
0A56 CDO0000     CALL    LDRGAC
OA59 E1         POP     H
QASA C5         PUSH    B       :;SAVE ON STACK
OA5B D5         PUSH    D
OA5C 010081     LXI     B,08100H        ;LOAD DEFAULT STEP#=1.0
OASF 61         MOV     D.C
OAG0 5A         MOV     E,D
OAG1 7E         MOV     A.M
OA62 FEA2       CPI     KEYSTEP ;CHECK FOR EXPLICIT STEP SIZE
OA64 3£01       MVI     A,001H                                                                         .
OAG6 C20000     JNZ     FORSTMST
OA69 CDABO3     CALL    SCANNXT ;bscan +
OA6C CDO000     CALL    VALNUMBR        ;bscan numbr
OAGF ES         PUSH    H
0A70 CDO0000     CALL    LDRGAC
0A73 £1         POP     H
0A74 CDO000     CALL    SIGNACC
FORSTMST:
OA77 C5         PUSH    B       ;SAVE STEP SIZE ON STACK
0A78 D5         PUSH    D
OA79 F5         PUSH    PSW     ;SAVE DIRECTION
OA7A 33         INX     SP
OA7B ES         PUSH    H
OA7C 2A7703     LHLD    VARINDEX        ;SAVE INDEX VARIABLE
OA7F E3         XTHL
FORMARK:                                                                               ;
0A80 0683       MVI     B,KEYFOR        ;MARK STACK WITH "FOR"
OA82 C5         PUSH    B
0A83 33         INX     SP


=== PAGE _048 (PDF page 124) ===
basIC.LST                      5-Sep-78 14:14:39                                  ;      Page 46
; INTERPRETER EXECUTIVE
EXECUTEL;
0A84 CD0000     CALL    BREAKCHK        ;USER HAVE ANY COMMENTS?
0A87 227703     SHLD    PROGCNTR
OA8A 7E         MOV     A.M
OA8B FEA       CPI     "3
OA8D CA0000     JZ      EXECUTE ;MULTIPLE STATEMENTS ON LINE?
OA90 B7         ORA     A
0A91 C2EF05     JNZ     ERRASN    .
OA94 23         INX     H       ;ENO OF LINE,
OAQ95 7E         MOV     A.M
OA9G6 23         INX     H
OA9S7 BE         ORA     M
0A98 23         INX     H
0A99 CA0000     JZ      ENDPROGM        ;END OF PROGRAM? -
OASC 5E         MOV     E,M
OASD 23         INX     H
OASE 56         MOV     DM
OAQF EB         XCHG
OAAD 227303     SHLD    CURLINE ;MOVE TO NEXT LINE
OAA3 EB         XCHG
EXECUTE:
OAA4 CDABO3     CALL    SCANNXT ;bscan ,        sEXECUTE STATEMENT
QAA7 11840A     LXI     D,EXECUTEL
OAAA DS         PUSH    D
EXECUTEC:
OAAB C8         RZ
EXECUTES:
OAAC FE80       CPI     KEYSTM ;WHAT KIND OF STATEMENT?
QAAE DA0000     Jc      LETSTM                                                                            ;
OAB1 FEAO       CPI     KEYSUGR
QAB3 020000     JNC     EXECUTE2
OABG 87         ADD     A
OAB7 4F         MOV     C,A
GAB8 0600       MVI     B,000H
OABA EB         XCHG
OABB 214E00     LXI     H,STMTABL
OABE 09         DAD     B
OABF 4E         MOV     c,M
GACO 23         INX     H
OAC1 46         MOV     BLM -
OAC2 C5         PUSH    B
OAC3 EB         XCHG
OAC4 C3AB03     JUMP     SCANNXT


=== PAGE _049 (PDF page 125) ===
basIC.LST                      5~Sep-78 14:14:39                                          Page 47
BREAKCHK:
QAC7 CD3E00     CALL    SYSBREAK        ;TIME TO TAKE A BREAK?
STPSTM:
GACA CO         RNZ             ;STOP STATEMENT
QACB 3C         INR     A
EXECUTEB:
QACC 227703     SHLD    PROGCNTR
INPSTMBR:
OACF C1         POP     B       ; THROW AWAY CALLER
ENDPROGM:
OADO F5         PUSH    PSW
QAD1 2A7303     LHLD    CURLINE
OAD4 7D         MOV     A,L
QOAD5 A4         ANA     H
QAD6 3C         INR     A
OAD7 CA0000     Jz      ENDSTMC
OADA 227503     SHLD    CURLINES        :SAVE INFORMATION FOR CONTINUE
OADD 2A7703     LHLD    PROGCNTR
OAEO 227903     SHLD    PROGCNTS
ENDSTMC:
OAE3 AF         XRA     A
OAE4 326503     STA     PRINTFLG
OAE7 Fi         POP     PSW
OAES 216105     LXI     H, MSGBREAK
OAEB C20D06     JNZ     ERRMSGPR
OAEE C31906     JMP     CMNDSTRT
CONSTM:
OAF1 CO         RNZ             ;CONT COMMAND     ;                                                .
OAF2 1£00       MVI     E, ERRNCN-ERRN
OAF4 2A7903     LHLD    PROGCNTS ~
OAF7 7C         MOV     A,H
OAF8 BS         ORA     L                               .
OAF9O CAF105     Jz      ERRMSG
OAFC EB         XCHG
OAFD 2A7503     LHLD    CURLINES
0B00 227303     SHLD    CURLINE
0803 EB         XCHG
0B04 C9         RET                                                        ;
RUNSTM:
OB05 CA0205     Jz      CLEARSET        ;RUN COMMAND
OBO08 CD0505     CALL    CLEARVST
OBOB 01840A     LXI     B,EXECUTEL
OBOE C30000     JMP     RUNS TMC
ENDSTM:
0B11 CACCOA     Jz      EXECUTEB        ;END STATEMENT
0B14 CDA303     CALL    SCANNXTV        ;bscan (val)
0B17 8A         DB      KEYRUN        .
0B18 C34B00     JMP     SYSQUIT


=== PAGE _050 (PDF page 126) ===
basIC.LST                      65-Sep-78 14:14:39                                          Page 48
; GOSUB/GOTO STATEMENTS
GSBSTM:
0B1B 0E03       MVI     C,3     ;GOSUB STATEMENT
0B1D CDD804     CALL    SPACESTK
0820 Ci         POP     B
0821 £5         PUSH    H
OB22 E56         PUSH    H
0B23 2A7303     LHLD    CURLINE
0B26 £3         XTHL
0B27 168E       MVI     D,KEYGSB        ;MARK STACK WITH GOSUB
0B29 D5         PUSH    D
OB2A 33         INX     SP
RUNSTMC:                                                                   :
OB2B C5         PUSH    B
GTOSTM:
OB2C CDOBO4     CALL    SCANLINN        ;GOTO STATEMENT
OB2F D5         PUSH    D
0B30 CD0000     CALL    REMSTM
0B33 Di         POP     D                                                                          .
0834 E5         PUSH    H
0835 Cp0000     CALL    TRACE
0B38 2A7303     LHLD    CURLINE
0B3B CDC104     CALL    CMHLLTDE
OB3E E1         POP     H
OB3F 23         INX     H
0B40 DC3304     cc      LINESRCL
0B43 D43004     CNC     LINESRCH
OB46 60         MOV     H,B
0B47 69         MOV     L,Cc
OB48 2B         DCX     H
0B49 D8         RC
ERRAUS:
OB4A 1EC5       MVI     E,ERRNUS~ERRN
OB4C C3F105     JMP     ERRMSG
; RETURN STATEMENT
RETSTM:
OB4F CO         RNZ             ;RETURN STATEMENT
OBSO 16FF       MVI     O,OFFH
O0B52 CDF909     CALL    FORCHK ;KILL ACTIVE FOR LOOPS
0B55 FO         SPHL            ; INSIDE SUBROUTINE
0B56 FE8E       CPI     KEYGSB
OB58 1£76       MVI     E,ERRNRG-ERRN
OB5A C2F105     JNZ     ERRMSG
OB5D D1         POP     D
OB5E CDO000     CALL    TRACE
0B61 EB         XCHG
OB62 227303     SHLD    CURLINE
OB65 21840A     LXI     H, EXECUTEL
OB68 E3         XTHL
i   JMP     DATSTM


=== PAGE _051 (PDF page 127) ===
basIC.LST                      65-Sep-78 14:14:39                                  ;       Page 49
; DATA/ELSE/REM STATEMENTS
DATSTM:
OB69 OE3A       MVI     C,":" ; DATA STATEMENT
OB6B C30000     JMP     SCAN2KEY
ELSSTM:
REMSTM:
OB6E OE£00       MVI     C,000H ;REM STATEMENT
SCAN2KEY:            .
6B70 0600       MVI     B,OOOH ;SKIP TO KEYWORD IN C
DATRSKST;
0B72 79         MOV     A,C     ;SET UP TERMINATING BYTE
0B73 48         MOV     C,8
0B74 47         MOV     B,A
DATRSKIP:                                     :
OB75 7E         MOV     A.M     ;SKIP TO TERMINATING BYTE
0B76 87         ORA     A
0B77 C8         RZ
0B78 B8         CMP     B
0879 C8         RZ
OB7A 23         INX     H
OB7B FE22       CPI     a      ;STRING TO SKIP?
0B7D CA720B     JZ      DATRSKST
0880 FE8B       CPI     KEYIF
0B82 C2750B     JNZ     DATRSKIP
OB85 14         INR     D       ;COUNT NUMBER OF IFS WE SKIP
0886 C3750B     JMP     DATRSKIP
; PROGRAM BRANCH TRACING                                                                    :
TRACE:
0B89 3A6603     LDA     TRACEFLG        ; TRACING?
OB8C B7         ORA     A
0B8D CO         RNZ
OBBE C5         PUSH    B
OB8F D5         PUSH    D       ;SAVE DESTINATION LINE NUMBER
0B90 CD9405     CALL    PRNTCHRI        sprint (val)
0B93 5B         DB      "c"     ;LEFT BRACKET
0B94 2A7303     LHLD    CURLINE
0897 Cp0000     CALL    PRINTINT        ;PRINT CURRENT LINE NUMBER
OB9A CD9405     CALL    PRNTCHRI        sprint (val)
OB9D 2c         DB      ""
OBSE E1         POP     H
OBOF ES         PUSH    H
OBAO CD0000     CALL    PRINTINT        :PRINT DESTINATION LINE NUMBER
OBA3 CD9405     CALL    PRNTCHRI        sprint (val)
OBAG6 5D         DB      "y"     ;RIGHT BRACKET
POPDEBCR:
OBA7 D1         POP     D
OBA8 C1         POP     B
OBAQ C9         RET


=== PAGE _052 (PDF page 128) ===
basIC.LST                      6-Sep-78 14:14:39                                          Page 50
; ASSIGNMENT STATEMENT PROCESSOR
LETSTM:
OBAA CD0000     CALL = VARSCAN ;LET STATEMENT
OBAD CDA303     CALL — SCANNXTV        ;bscan (val)
OBBO BS         DB      KEYEQ
ASSTGNVL:
OBB1 3A6B03     LDA     TYPEFLG
OBB4 F5         PUSH — PSW
OBB5 D5         PUSH =D
OBB6 CD0000     CALL VALEXPR ;bscan expr
OBB9 D1         POP     D
OBBA F1         POP     PSW
ASSIGN:
OBBB EB         XCHG            ;MAKE THE ASSIGNMENT
OBBC D5         PUSH =D       ;SAVE SCAN
OBBD E5         PUSH =H       ;SAVE VARIABLE
OBBE CD0000     CALL —- COERCE
0BC1 C20000     INZ     LETSTMNM
0BC4 CD0000     CALL  STRGUNIQ        ;REMOVE CONFLICT PROBLEMS
0BC7 CD0000     CALL — STRGRELT        ;RELEASE STRING TEMPORARY
OBCA E1         POP     H       ;COPY DESCRIPTOR TO DESTINATION
oBCB CD0000     CALL —- COPYVAL
OBCE £1         POP     H
OBCF C9         RET
LETSTMNM:
oBDo cpoc00     CALL LDMMAC ;MAKE NUMERIC ASSIGNMENT
OBD3 D1         POP     D
OBD4 £1         POP sod
OBDS C9         RET
STRGUNIQ:
OBD6 2A9303     LHLD = ACCUMLTR        ;GET STRING DESCRIPTOR
OBD9 EB         XCHG            ;IS STRING IN STRING SPACE?
OBDA CD0000     CALL = STRGTEST
OBDD DO         RNC
OBDE CDC104     CALL — CMHLLTDE        ;VARIABLE REFERENCE?
OBE1 D40000     CNC     STRGSTOR        ;IF SO, MAKE NEW COPY
OBE4 C9         RET


=== PAGE _053 (PDF page 129) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 51
; COERCE ACCUMULATOR TO TYPE IN A
COERCE :
OBES CDDCO3     CALL    TYPECHKA
COERCEF:
OBE8 E20000     JPO     CSINGLE
OBEB CAC000     JZ      CSTRING
OBEE C30000     JMP     ERRATM
VALNUMBR:             :
OBF1 Co0000     CALL    VALEXPR ;bscan expr
CSINGLE:
OBF4 COD903     CALL    TYPECHK
OBF7 E0         RPO
OBF8 C30000     JMP     ERRATM
CSTRING:
OBFB CDD903     CALL    TYPECHK
OBFE C8         RZ
OBFF C30000     JMP     ERRATM
ERRATM:
0cO2 1EB0       MVI     E,ERRNTM-ERRN
0C04 C3F105     JMP     ERRMSG
VALINTDE:
0CO7 CDF10B     CALL    VALNUMBR        ;bscan number EVAL POSITIVE INTEGER EXPR
CINTPOS:
OCOA CD000N     CALL    SIGNACC ;CONVERT TO INTEGER
OCOD FAC00O     JM      ERRAFC
CINTEGER:                                                                                     :
0C10 3A9603     LDA     FLACCEXP
0C13 FESO       CPI     O90H
0C15 DA0000     JC      FIXAC
0C18 018090     LXI     B,09080H
0C1B 110000     LXI     D,00000H
OC1£ CD0000     CALL    FLCMP
0c21 51         MOV     D.C
0c22 C8         RZ
ERRAFC:
o0c23 1&2D       MVI     E,ERRNFC-ERRN
0C25 C3F105     JMP     ERRMSG
VALBYTE2:
0C28 CDA303     CALL    SCANNXTV        ;bscan (val)
0C2B 2C         DB      wn     ;EVAL LATER BYTE ARGUMENTS
VALBYTE:                                                                                      :
0C2C CDF10B     CALL    VALNUMBR        :bscan numbr EVAL BYTE EXPRESSION
CBYTE:
OC2F CDOAOC     CALL    CINTPOS ;CONVERT ACC TO BYTE
0C32 7A         MOV     A,D
0C33 B7         ORA     A
0C34 C€2230C     JNZ     ERRAFC


=== PAGE _054 (PDF page 130) ===
basIC.LST                      §-Sep-78 14:29:54                                         Page 62
0C37 2B         DCX     H
0C38 CDABO3     CALL    SCANNXT ;bscan ,
0C3B 7B         MOV     A,E
oc3c C9         RET
EXECUTE2:
0C3D FEC4       CPI     KEYPORT ;PORT OUTPUT?
OC3F CA0000     JZ      PORSTM
0C42 FEC6       CPI     KEYMEM ;MEMORY ALTERATION?
0c44 CA0000     JZ      MEMSTM
; MID-STRING ASSIGNMENT STATEMENT
MIDSTM:
0C47 CDA303     CALL    SCANNXTV        ;bscan (val)
OC4A D1         DB      KEYMID ;ENTER POINTING TO “MID$"
0C4B CDA303     CALL    SCANNXTV        :oscan (val)
OC4E 28         DB      ncn
Oc4F cD0000     CALL    VARSCAN ;SCAN VARIABLE TO UPDATE
0C52 CDFBOB     CALL    CSTRING ;MAKE SURE IT"S A STRING
0c55 D5         PUSH    D       ;SAVE REFERENCE
OC56 E5         PUSH    H
0c57 CD0000     CALL    STRGTEST        ;WHERE IS STRING NOW?
OC5A DS         PUSH    D       ;SHOULDN"T BE IN PROGRAM
0C5B 040000     CNC     STRGSTOR        ;OR ELSE WE MODIFY OURSELF
OCSE E1         POP     H
OCS5F CD0000     CALL    COPYVAL
océ2 E1         POP     H       ;CONTINUE SCAN
0c63 CD280C     CALL    VALBYTE2        ;SCAN STARTING POSITION
OC66 B7         ORA     A
0C67 CA230C     JZ      ERRAFC ;MUST BE NON-ZERO
OC6A DS         PUSH    D
OC6B 1EFF       MVI     E,OFFH
OC6D 7E         MOV     A.M
OC6E FE29       CPI     "y"     ;DEFAULT LENGTH?
0c70 C4280C     CNZ     VALBYTE2        ;SCAN LENGTH, IF GIVEN
0C73 CDA303     CALL    SCANNXTV        ;bscan (val)
0C76 29         DB      "yn
0c77 C1         POP     B       ;CONDENSE STACK
0c78 51         MOV     d,c
0C79 D5         PUSH    D
OC7A CDA303     CALL    SCANNXTV        ;bscan (val)
0C7D BS         DB      KEYEQ
OC7E cD0000     CALL    VALEXPR ;bscan expr     ;EVALUATE RIGHT HAND SIDE
0C81 226F03     SHLD    SCANPTR1
0C84 CN0000     CALL    LENFCTC ;RELEASE STRING RESOURCE
OC87 4E         MOV     C,M     ;AND LOAD DESCRIPTOR
0C88 23         INX     H
0c89 46         MOV     B,M
OCB8A D1         POP     D       ;GET BACK LENGTH, START
OC8B BB         CMP     E
ocsac p20000     JNC     MIDSTMLN        ;LENMOV = MIN(LENI, LENS)
OC8F 5F         MOV     E,A
MIDSTMLN:
ocgo E1         POP     H       ;RECOVER DESTINATION DESCRIPTOR


=== PAGE _055 (PDF page 131) ===
basIC.LST            5-Sep-78 14:29:54                      Page 53

0c91 7E       MOV    A,M    ;GET ITS LENGTH

ocg2 15       DCR    D

0C93 92       SUB    D      SUBTRACT STARTING POSITION

0c94 DA0000    Jc     MIDSTMXT       ;NOTHING TO DO IF BEYOND
|
|


=== PAGE _056 (PDF page 132) ===
basIC.LST                      5-Sep-78 14:29:54                                          Page 54
0C97 8B         CMP     E
0c98s 020000     ONC     MIDSTMLM
OC9B SF         MOV     E,A
MIDSTMLM:
ocec Cs         PUSH    B       ;SAVE SOURCE ADDRESS
ocgD CD0000     CALL    LDICBMM ;COMPUTE DESTINATION ADDRESS
OCAO 6A         MOV     L,D
OCA1 2600       MVI     H,0
OCA3 09         DAD     B
OCA4 EB         XCHG
OCA5 C1         POP     B         ;
ocaé cp0000     CALL    COPYSTRG        ;COPY STRING
MIDSTMXT:
OCAQ 2A6FO03     LHLD    SCANPTR1
OcAC C9         RET
; LOCATE STRING REFERENCED BY DE
STRGTEST:
OCAD D5         PUSH    D       ;DE=STRING REFERENCE
OCAE EB         XCHG
OCAF 23         INX     H       ;GET ADDRESS OF STRING
OCcBO SE         MOV     E,M
OCB1 23         INX     H
OCB2 56         MOV     D,M
OCB3 2A8703     LHLD    FREELIMT        ; BOUNDARY
ocB6 CDC104     CALL    CMHLLTDE        ;NC = STRING IN PROGRAM
OCB9 D1         POP     D       ;C = STRING IN BUFFER
OCBA C9         RET             ;OR STRING SPACE


=== PAGE _057 (PDF page 133) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 55
; CASE/CONDITIONAL STATEMENT PROCESSORS
ONSTM:
OCBB CD2COC     CALL    VALBYTE ;ON STATEMENT
OCBE 7E         MOV     A.M
OCBF 47         MOV     B,A
OCCO FE8E       CPI     KEYGSB ;GOSUB RATHER THAN GOTO?
occ2 CA0000     JZ      ONNSTMC
OcC5 CDA303     CALL    SCANNXTV        ;bscan (val)
occa 89         DB      KEYGTO ;MUST BE GOTO...
OCC9 2B         DCX     H
ONNSTNC:
OCCA 4B         MOV     C,E
ONNSTMSL:
OCCB OD         DCR     C       ;LOOK FOR RIGHT LINE NUMBER
Occc 78         MOV     A.B
OCCD CAACOA     JZ      EXECUTES        ;THEN EXECUTE STATEMENT
ocDO CcDO0CO4     CALL    SCANLINR
OCD3 FE2C       CPI     "wn
ocDS co         RNZ
OCD6 C3CBOC     JMP     ONNSTMSL
IFSTM:
OCDS CDF10B     CALL    VALNUMBR        ;bscan numbr    ; IF STATEMENT
OCDC 7E         MOV     A,M
OcDD FE89       CPI     KEYGTO                    ;
OCDF CA0000     JZ      IFNSTMC
OCE2 CDA303     CALL    SCANNXTV        ;bscan (val)
OCES AQ         OB      KEYTHEN
IFNSTMC:                                     .
OCE6 CD0000     CALL    SIGNACC ;TEST CONDITION
OCES C20000     JNZ     IFNSTMCH
OCEC 1601       MVI     0,1
IFNSTMSK:
OCEE GE8C       MVI     C,KEYELS
OCFO CD700B     CALL    SCAN2KEY        ; SKIP TO CORRESPONDING ELSE
OCF3 B7         ORA     A
OCF4 C8         RZ              ;OR END OF LINE
OCF5 CDABO3     CALL    SCANNXT ;bscan +
OCF8 15         DCR     D
OCF9 C2EEOC     JNZ     IFNSTMSK
IFNSTMCH:
OCFC 2B         DCX     H       ;bscan ~
OCFD CDABO3     CALL    SCANNXT ;bscan ,        ;CHOICE MADE
0D00 DA2ZCOB     Jc      GTOSTM ;GOTO A LABEL,
0D03 C3ABOA     JMP     EXECUTEC        ;OR EXECUTE A STATEMENT


=== PAGE _058 (PDF page 134) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 56
; PRINT STATEMENT PROCESSOR
PRTISTMN:
0D06 FEAS       CPI     KEYTAB ;TAB OPTION?
0008 CA0000     JZ      PRNTOPTN
ODOB FEA6       cPI     KEYSPC ;SPACE OPTION?
ODOD CA0000     JZ      PRNTOPTN
0D10 E5         PUSH    H
0D11 FE2C       cPI     wn
0D13 CA0000     JZ      PRNTCOMA
0D16 FE3B       CPI     nye
0018 CA0000     JZ      PRNTSEMI
OD1B C1         POP     B
oD1ic CD0000     CALL    VALEXPR ;bscan expr                                         :
OD1F 2B         DCX     H       s;bscan -
on20 £5         PUSH    H
0D21 CDD903     CALL    TYPECHK
0024 CA0000     JZ      PRTSTRNG
0D27 CD0000     CALL    VALSTRGN        ;CREATE STRING FROM NUMBER
OD2A 2A9303     LHLD    ACCUMLTR        ;VERIFY ROOM ENOUGH ON LINE                                    .
OD2D 7E         MOV     A,M
OD2E 219903     LXI     H, CURSPOS
0D31 86         ADO     M
0D32 23           INX      H
0033 86         ADD     M
0034 DCN000     cc      PRNTCRLF        ;NO ROOM, FIND ANOTHER LINE
0037 CD0000     CALL    PRNTSTRT
OD3A CD9405     CALL    PRNTCHRI        sprint (val)
0D3D 20         DB      noe
OD3E 3C         INR     A
PRTSTRNG:
OD3F CC0000     Cz      PRNTSTRT        ;SEND OUTPUT STRING
0042 £1         POP     H
0043 CDABO3     CALL    SCANNXT ;bscan ,
PRTSTM:
0046 C2060D     JNZ     PRTSTMN ;PRINT STATEMENT
PRNTCRLF:
0D49 CD9405     CALL    PRNTCHRI        sprint (val)
0D4C OD         DB      CR      ;PRINT A CR, LF
0D4D CD9405     CALL    PRNTCHRI        sprint (val)
OD50 OA         DB      LF
PRNTNULS:
0D51 3A9803     LDA     NULLCNT ;PRINT NULLS AFTER CR
PRNTNULL:                                             .
0054 3D         DCR     A
0D55 329903     STA     CURSPOS
0058 C8         RZ
0D59 F5         PUSH    PSW
OD5A AF         XRA     A
OD5B CD9805     CALL    PRNFICHRA        ;ac -> screen
ODS5E Fi         POP     PSW
ODSF C3540D     JMP     PRNTNULL


=== PAGE _059 (PDF page 135) ===
basIC.LST                      5-Sep-78 14:29:64                                         Page 57
PRNTCOMA:
OD62 3A9903     LDA     CURSPOS ;COMMA SEPARATOR
OD65 FE8C       cPI     LINESYZE/ITEMSIZE-1*ITEMSIZE
0D67 044900     CNC     PRNTCRLF
OD6A D20000     JNC     PRNTSEMI
PRNTCOML:
OD6D D60E       SUI     ITEMSIZE
OD6F D26D0D     JNC     PRNTCOML
0D72 2F         CMA
0D73 C30000     JMP     PRNTCOMC
PRNTOPTN:
0D76 F5         PUSH    PSW
0D77 CDABO3     CALL    SCANNXT ;bscan +
OD7A CD0000     CALL    VALPARNS        ;GET OPTION PARAMETER
O0D7D COF408B     CALL    CSINGLE
0D80 CD2FOC     CALL    CBYTE                              .
0D83 28         DCX     H
0D84 F1         POP     PSW
O0D85 FEAG       CPI     KEYSPC
0D87 E5         PUSH    H
0D88 78         MOV     A,E
0D89 CAG00D     Jz      PRNTBLNK
OD8C 3A9903     LDA     CURSPOS
ODBF 2F         CMA
0D90 83         ADD     E
0D91 D20000     INC     PRNTSEMI
PRNTCOMC:
0D94 3C         INR     A
PRNTBLNK:
0D95 47         MOV     BA     ;PAD OUTPUT WITH A BLANKS
OD96 B87         ORA     A                                                                                 :
0D97 CA0000     Jz      PRNTSEMI
QD9A 3620       MVI     A," "
PRNTBLNL:
oDgCc CD9805     CALL    PRNTCHRA        ;ac -> screen
OD9F 05         DCR     B
ODAO C29C00     JNZ     PRNTBLNL
PRNTSEMI:
ODA3 E1         POP     H
ODA4 CDAB03     CALL    SCANNXT ;bscan ,
ODA7 C8&         RZ
ODA8 C3060D     JMP     PRTSTMN


=== PAGE _060 (PDF page 136) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 58
PRNTNUMS:
ODAB 23         INX     H       ;SEND STRING TO TRANSMITTER
PRNTMSG:
ODAC C5         PUSH    B
ODAD D5         PUSH    0
ODAE 01A70B     LXI     B,POPDEBCR
ODB1 C5         PUSH    B
0DB2 CD0000     CALL    VALSTRGZ        ;STRING ENDS ON ZERO
PRNTSTRT:
ODBS5 CD0000     CALL    STRGRELA
ODB8 CD0C00     CALL    LDDCBMM
ODBB 14         INR     D
PRNTSTRL:
ODBC 15         DCR     D
ODBD C8         RZ
ODBE CA         LOAX    B
ODBF CDQ805     CALL    PRNTCHRA        ;ac -> screen
obC2 FEOD       cPI     CR
opc4 CC510D     CZ      PRNTNULS
ODC7 03         INX     B
0DC8 C3BCOD     JMP     PRNTSTRL
; RETURN CURRENT POSITION ON OUTPUT LINE
POSFCT:
ODCB 3A9903     LDA     CURSPOS ;POS FUNCTION
FLOATA:
ODCE 47         MOV     B,A     ;RETURN BYTE ANSWER
ODCF AF         XRA     A
oDDO C30000     UMP     FLOATAB
; PLOT STATEMENT
PLTSTM:
0DD3 CDF10B     CALL    VALNUMBR        ;bscan number    ;GET X-COORDINATE
ODD6 CD100C     CALL    CINTEGER
ODDS D5         PUSH    D
ODDA CDA303     CALL    SCANNXTV        ;bscan (val)
ODDD 2c         DB      wn
ODDE CDF10B     CALL    VALNUMBR        ;Oscan numbr    ;GET Y-COORDINATE
ODE1 CD1i00C     CALL    CINTEGER
ODE4 D5         PUSH    D
ODES CDA303     CALL    SCANNXTV        ;bscan (val)
ODEB 2C         DB      wn
ODE9 CDF10B     CALL    VALNUMBR        ;bscan numbr    ;GET OPERATION
ODEC CD100C     CALL    CINTEGER
ODEF 7B         MOV     A,E
ODFO D1         POP     D             :
ODF1 C1         POP     B
ODF2 E5         PUSH    H
;   CALL    SYSPLOT
ODF3 E1         POP     H
ODF4 C9         RET


=== PAGE _061 (PDF page 137) ===
basIC,LST                      S-Sep-78 14:29:54                                         Page 59
; INPUT/READ STATEMENT PROCESSORS
MSGQUES:
OOFS 3F3FOG     DB      "tT" o
MSGREDO:
ODF8 3F5245     DB      "?REDO FROM START" ,CR,LF,O
ODFB 444F20
ODFE 46524F
OE01 402053
OE04 544152
OEO7 540D0A
OEOA 00
MSGEXTRA:
OEO0B 3F4558     DB      "PEXTRA IGNORED",CR,LF,0
OEOE 545241
OE11 204947
OF14 4E4F52
OE17 45440D
QE1A OA00
; INPUT
INPSTM:
O£1C AF         XRA     A       ; INPUT STATEMENT
O0E1D 326503     STA     PRINTFLG        ; TURN ON PRINTING
INPSTMRD:
OE20 E5         PUSH    H       ;SAVE SCAN IN CASE OF ERROR
O£21 OE4E       MVI     C,LINESYZE/2
0E23 CDD804     CALL    SPACESTK
OE26 EB         XCHG
OE27 2A7F03     LHLD    INPTBUFR        ; SAVE ADDRESS OF CURRENT BUFFER
OE2A E5         PUSH    H
OE2B 2160FF     LXI     H, O-LINESYZE-3
OE2E 39         DAD     SP
OE2F FQ         SPHL            ;AND CREATE A NEW BUFFER
OE30 227F03     SHLD    INPTBUFR
0E33 EB         XCHG
OE34 7E         MOV     A,M
OE35 FE22       CPI     i
OE37 CA0000     JZ      INPSTMPR
OE3A FEA3       CPI     KEYPRM
OE3C 11F600     LXI     D,MSGQUES+1
OE3F C20000     JNZ     INPSTMIN
0E42 CDABO3     CALL    SCANNXT ;bscan +
INPSTMPR:
0£E45 cp0000     CALL    VALEXPR ;bscan expr     ;OPTIONAL PROMPT. STRING
0E48 CDFBOB     CALL    CSTRING
OE4B CDA303     CALL    SCANNXTV        ;bscan (val)
OE4E 3B         DB      "vt
OE4F £5         PUSH    H
0£50 CDB50D     CALL    PRNTSTRT
0£53 £1         POP     H
0E54 11F70D     LXI     D,MSGQUES+2
INPSTMIN:
QE57 ES         PUSH    H
OE58 CD0000     CALL    DATAINPT


=== PAGE _062 (PDF page 138) ===
basIC.LST                      56-Sep-78 14:29:54                                         Page 60
OE5B C30000     JMP     REAINPFS
; READ
REASTM:
OE5SE E5         PUSH    H       ;READ STATEMENT
OESF 2A7D03     LHLO    CURDATAP
O0E62 7E         MOV     A.M
0E63 B7         ORA     A
0664 CC0000     CZ      DATASRCH        ;GET DATA IF NECESSARY
REAINPFS:             :
OE67 326403     STA     REAINPFL
OE6A C30000     JMP     REAINPLQ
REAINPLP:
OE6D CDA303     CALL    SCANNXTV        ;bscan (val)
0£70 2C         DB      "wn
0E71 £3         XTHL                                       .
0£72 7E         MOV     A,M
0£73 FE2C       CPI     me
0E75 C40000     CNZ     DATAGET
REAINPLQ:
0E78 £3         XTHL
OE79 7E         MOV     A.M
OE7A FEA4       CPI     KEYLINE ;LINE OPTION?
OE7C CA0000     JZ      INPSTMLN
OE7F CD0000     CALL    VARSCAN ;FIND NEXT VARIABLE TO BE INPUT
OE82 E3         XTHL            ;SAVE INPUT LIST POINTER
0E83 D5         PUSH    D       ;SAVE VARIABLE POINTER,
0&84 3A6B03     LDA     TYPEFLG ;AND TYPE
OE87 F5         PUSH    PSW
0E—88 CD0000     CALL    REAINPDC        ;DECODE INPUT
REAINPLA:                                                                                           :
OE8B Fi         POP     PSW     ;ASSIGN VALUE
OE8C Di         POP     D
OE8D CDBBOB     CALL    ASSIGN
OE90 2B         DCX     H       s;bscan -
0E91 CDABO3     CALL    SCANNXT ;bscan ,
0E94 CA0000     JZ      REAINPCM
OE97 FE2C       CPI     oe     ;DATA ITEMS SEPARTED BY COMMAS
OE99 C20000     INZ     REAINPER
REAINPCM:
OE9C E3         XTHL
OE9D 2B         DCX     H       ;bscan -        ;MORE VARIABLES?
QEQE CDABN3     CALL    SCANNXT ;bscan ,
OEA1 C26D0E     JNZ     REAINPLP
OEA4 D1         POP     D       sEND OF VARLIST
OEAS 3A6403     LDA     REAINPFL
QEA8 B7         ORA     A
OEAQ EB         XCHG
QEAA €C26205     JNZ     RESDTPTR
QEAD D5         PUSH    D
OEAE F5         PUSH    PSW
OEAF B6         ORA     M
OEBO 210B0E     LXI     H,MSGEXTRA
INPSTMER:


=== PAGE _063 (PDF page 139) ===
basiC.LST            5-Sep-78 14:29:54                       Page 61
0EB3 C4ACOD    CNZ    PRNTMSG
OEBG F1       POP    PSW


=== PAGE _064 (PDF page 140) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 62
INPSTMXT:
OEB7 D1         POP     D       ;RECOVER SCAN POINTER
QEB8 21A000     LXI     H, O+LINESYZE+3
OEBB 39         DAD     SP
OEBC F9         SPHL            ;DEALLOCATE BUFFER
OEBD E1         POP     H
OEBE 227F03     SHLD ——-INPTBUFR        ;AND RESTORE ADORESS OF OLD
OEC1 EB         XCHG
OEC2 D1         POP     )
OEC3 C8         RZ
OEC4 FACFOA     JM      INPSTMBR        ;BREAK TIME...
OEC7 EB         XCHG
OEC8 C3200E     JMP     INPSTMRD        ;OR REDO THE INPUT
REAINPER:
OECB 3A6403     LDA     REAINPFL
QECE B7         ORA     A
OECF C2E905     NZ     ERRDATA
OED2 21F80D     LXI     H ,MSGREDO
OEDS 3C         INR     A
OED6 F5         PUSH — PSW                                                                            ;
OED? C3B30E     JMP     INPSTMER
; SEARCH FOR DATA STATEMENT
DATAGET:
OEDA 3A6403     LDA     REAINPFL
OEDD B7         ORA     A       ;READ OR INPUT?
OEDE 11F50D     LXI     D,MSGQUES
OEE1 CA000     Jz      DATAINPT        ; INPUT
DATASRCH:
OEE4 CD690B     CALL DATSTM ;LOOK FOR NEXT DATA STATEMENT
OEE7 B7         ORA     A
OEE8 C20000     JNZ     DATASRCK
OEEB 23         INX     H
OQEEC 7E         MOV     A.M
OEED 23         INX     H
OEEE B6         ORA     M
OEEF 23         INX     H
OEFO 1£61       MvI     E , ERRNOD-ERRN
OEF2 CAF105     dz      ERRMSG
OEFS 5E         MOV     E,M
OEF6 23         INX     H
OEF7 56         MOV     D,M
OEF8 EB         XCHG
OEF9 227B03     SHLD —- CURLDATA
OEFC EB         XCHG
DATASRCK:
OEFD CDABO3     CALL  SCANNXT ;bscan ,
OFOO FE8O       CPI     KEYDAT
OFO2 C2E40E     JNZ     DATASRCH
OF05 C9         RET
DATAINPT:


=== PAGE _065 (PDF page 141) ===
basIC.LST                      §-Sep-78 14:29:54                                  :      Page 63

OFO06 CD6B07     CALL    INPTRQST

oFog C8         RZ              INPUT OK, RETURN

OFOA C1         POP     B       ;BREAK ***

OFOB C3B70E     JMP     INPSTMXT
REAINPDC:

OFOE CDABO3     CALL    SCANNXT ;bscan ,

OF11 CDD903     CALL    TYPECHK

OF14 7E         MOV     AM

OF15 C20000     JNZ     DECODE ;READ/INPUT A NUMBER

OF18 FE22       CPI     a

OF1A CA0000     Jz      VALSTRGC

OF1D 163A       MVI     o,":"

OF1F 062C       MVI     B,","

OF21 2B         DCX     H

OF22 C30000     JMP     VALSTRGS        ;READ/INPUT A STRING
INPSTMLN:                                      :

OF25 3A6403     LDA     REAINPFL        ;LINE OPTION VALID ONLY

OF28 B7         ORA     A       ;FOR INPUT STATEMENT

OF29 C2EFO5     INZ     ERRASN

OF2C CDABO3     CALL    SCANNXT ;bscan +

OF2F CD0000     CALL    VARSCAN

OF32 E3         XTHL

OF33 DS         PUSH    D

OF34 3A6B03     LDA     TYPEFLG

OF37 F5         PUSH    PSW

OF38 0600       MVI     B,0

OF3A CDO000     CALL    VALSTRGY        ;SWALLOW REST OF INPUT LINE

OF3D C38B0E     JMP     REAINPLA        ;AND ASSIGN TO STRING VARIABLE


=== PAGE _066 (PDF page 142) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 64
; NEXT STATEMENT PROCESSOR
NEXSTM:
OF40 110000     LXI     D,0     ;NEXT STATEMENT
NEXSTML:                                                                :
OF43 C40000     CNZ     VARSCAN
OF46 227703     SHLD    PROGCNTR
OF49 CDF909     CALL    FORCHK ;VERIFY WE"RE IN FOR LOOP
OF4C C20000     INZ     ERRANF
OF4F F9         SPHL            ;BACK UP STACK
OF50 D5         PUSH    D
OF51 7E         MOV     A.M     ;RECOVER SIGN OF STEPSIZE
OF52 23         INX     H
OF53 F5         PUSH    PSW
OF54 D5         PUSH    D
OF55 Con000     CALL    LDRGACMM        ;RECOVER STEP SIZE
OF58 E3         XTHL
OF59 ES         PUSH    H
OF5A CD0000     CALL    FLADDM ;INCREMENT CONTROL VARIABLE
OF5D E1         POP     H
OFSE CDO000     CALL    LOMMAC
OF61 E1         POP     H
OF62 CD0000     CALL    LDRGMM
OF65 ES         PUSH    H
OF66 CD0000     CALL    FLCMP
OF69 E1         POP     H
OFGA C1         POP     B
OF6B 90         SUB     B                         ;
OF6C Cp0000     CALL    LDRGMM ;RECOVER LINE NUMBR, PROGRAM CNTR
OF6F CA0000     JZ      NEXSTMC ;CHECK LIMIT
OF72 CO890B     CALL    TRACE
OF75 EB         XCHG
OF76 227303     SHLD    CURLINE
OF79 60         MOV     H,B
OF7A 69         MOV     L,C
OF7B C3800A     JMP     FORMARK
ERRANF :
OF7E 1664       MVI     E,ERRNNF-ERRN
OF80 C3F105     JMP     ERRMSG
NEXSTMC:
OF83 F9         SPHL            sEND OF LOOP...
OF84 2A7703     LHLD    PROGCNTR
OF87 7E         MOV     A,M
OF88 FE2C       CPI     wn
OF8A C2840A     JNZ     EXECUTEL        ;MORE INDICES?
OF8D CDABD3     CALL    SCANNXT ;bscan ,
OF90 CD430F     CALL    NEXSTML       .


=== PAGE _067 (PDF page 143) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 65
; EVALUATE AN EXPRESSION
VALEXPR:

OF93 2B         DCX     H       ;SCAN & EVALUATE AN EXPRESSION

OF94 1600       MVI     D,0     ; INITIAL PRECEDENCE#0
VALEXPRL:

OF96 DS         PUSH    D

OF97 OE01       MVI     C,1

OF9S CDD804     CALL    SPACESTK

OF9C CD0000     CALL    VALPRMRY        ;bscan prmry

OFOF 227103     SHLD    SCANPTR2
VALEXPRC:

OFA2 2A7103     LHLD    SCANPTR2
VALEXPRD:                                                            ;

OFAS C1         POP     B       ;PREVIOUS PRECEDENCE

OFA6 78         MOV     A,B

OFA7 FE70       CPI     PREONUM

OFAQ D4F40B     CNC     CSINGLE

OFAC 7E         MOV     AM

OFAD 1600       MVI     D,000H                                                                         :
VALEXPRR:

OFAF D6B4       SUI     KEYREL ;RELATION?

OFB1 DA0O000     Je      VALEXPRO

OFB4 FEO3       CPI     KEYFCT-KEYREL

OFB6 020000     JNC     VALEXPRO

OFBO FEO1       CPI     1       ;YES

OFBB 17         RAL

OFBC AA         XRA     D       ;CONVERT 0,1,2 TO 1,2,4

OFBD BA         CMP     D

OFBE 57         MOV     D,A

OFBF DAEFO5S     JC      ERRASN

OFC2 226F03     SHLD    SCANPTR1

OFC5 CDABO3     CALL    SCANNXT ;bscan ,

OFCS8 C3AFOF     JMP     VALEXPRR
VALEXPRO:                                                                                       :

OFCB 7A         MOV     A,D

OFCC B7         ORA     A

OFCD C20000     JNZ     VALREL

OFDO 7E         MOV     A,M

OFD1 226F03     SHLD    SCANPTR1

OFD4 D6AA       SUI     KEYOPR ;OPERATOR?

OFD6 D8         RC

OFD? FEOA       CPI     KEYREL-KEYOPR                           .

OFD9 DO         RNC

OFDA 5F         MOV     E,A     :YES

OFDB CDD903     CALL    TYPECHK ;STRING OPERANDS?

OFDE B3         ORA     E       ;AND CATENATION OPERATOR?

OFDF 7B         MOV     A,E

OFEO CA0000     JZ      VALCONCT        ;YES

OFE3 83         ADD     E

OFE4 83         ADD     E

OFES 5F         MOV     E,A

OFE6 218E00     LXI     H, OPRTABL


=== PAGE _068 (PDF page 144) ===
basIC.LST                      5-Sep-78 14:29:54      Page 66
OFE9 19         DAD     D
OFEA 78         MOV     A,B
OFEB 56         MOV     D.M
OFEC BA         CMP     D
OFED DO         RNC
OFEE 23         INX     H
OFEF CDF40B     CALL  CSINGLE
VALEXPR2:
OFF2 C5         PUSH —B       :STACK OPERATION,
OFF3 01A20F     LXI     B, VALEXPRC      ;EVALUATE SECOND OPERAND
OFF6 C5         PUSH —-=B
OFF7 42         MOV     B,D       ;
OFF8 48         MOV     C,E
OFF9 CD0000     CALL PUSHAC
OFFC 50         MOV     D,B
OFFD 59         MOV     E,C
OFFE 4         MOV     C\M
OFFF 23        INX     H
1000 46         MOV     B,M
1001 C5         PUSH -B
1002 2AGFO3     LHLD —- SCANPTR4
1005 C3960F     JMP     VALEXPRL
; EVALUATE A RELATION
VALREL:
1008 210000     LXI     H,RELOPR        ;SCAN & EVALUATE RELATION
100B 3A6B03     LDA     TYPEFLG
100E 07         RLC
100F 07         RLC
1010 07         RLC
1011 B2         ORA     D
1012 5F         MOV     E,A
1013 1664       MVI     D, PREDREL
1015 78         MOV     A,B
1016 BA         CMP     D
1017 DO         RNC
1018 C3F20F     MP     VALEXPR2
RELOPRXT:
101B 3C         INR     A       ;MATCH RESULT OF COMPARISON
101C 8F         ADC     A       -1,0,1 TO 1,2,4
101D C1         POP     B -—soSWERSUS RELATION TO BE TESTED
101E AQ         ANA     B
101F C6FF       ADI     -4
1021 9F         SBB     A
1022 €30000     JMP     FLOATBYT


=== PAGE _069 (PDF page 145) ===
basIC.LST                      5~Sep-78 14:29:54                                         Page 67
RELOPR:

1025 0000       DW      RELOPRC ;COMPUTE RELATION
RELOPRC:

1027 79         MOV     A,C

1028 C1         POP     B

1029 Dt         POP     D

102A FS         PUSH    PSW

102B OF         RRC

102C OF         RRC

102D OF         RRC

102E E60F       ANI     OOFH

1030 CDE50B     CALL    COERCE

1033 211B10     LXI     H, RELOPRXT

1036 E5         PUSH    H

1037 €20000     JNZ     FLCMP   ;NUMERIC COMPARISON?

103A 3604       MVI     A, TYPESING      ;NO, STRING

103C 326803     STA     TYPEFLG

103F D5         PUSH    D

1040 CD0000     CALL    STRGRELA        ;RELEASE TEMP OF SECOND OPERAND

1043 01         POP     D

1044 4E         MOV     C.M

1045 23         INX     H

1046 C5         PUSH    B       ;SAVE LENGTH

1047 4€         MOV     cM

1048 23         INX     H

1049 46         MOV     B,M                            .

104A C5         PUSH    B       ;AND ADDRESS

104B CD0000     CALL    STRGRELD        ;RELEASE TEMP OF FIRST OPERAND

104E CDO000     CALL    LDDCBMM                   ;                                                 ;

1051 Et         POP     H

1052 £3         XTHL

1053 5D         MOV     E,L

1054 E1         POP     H                                ;
RELOPRSL:

1055 7B         MOV     A,E     ;COMPARE CHARACTER BY CHARACTER

1056 B2         ORA     D

1057 C8         RZ

1058 7B         MOV     A,E

1059 D601       SUI     1

105B D8         RC

105C AF         XRA     A

105D BA         CMP     D

105E 3C         INR     A

105F 00         RNC

1060 15         DCR     D

1061 1D         DCR     E

1062 OA         LDAX    B

1063 BE         CMP     M

1064 23         INX     H

1065 03         INX     B             .

1066 CA5510     JZ      RELOPRSL

1069 3F         CMC

106A C30000     JMP     CMPXT


=== PAGE _070 (PDF page 146) ===
basIC.LST            5-Sep-78 14:29:54                      Page 68
; EVALUATE A PRIMARY
VALPRMRY:
106D 3604       MVI     A,TYPESING      ;SCAN & EVALUATE A PRIMARY
106F 326803     STA     TYPEFLG
1072 CDAB03     CALL    SCANNXT ;bscan ,
1075 DA0000     Jc      DECODE ;NUMERIC CONSTANT?
1078 CDBBO3     CALL    ALPHACHK
107B DA00CO     JC      VALVAR ; VARIABLE?
107E FEAA       CPI     KEYADD
1080 CA6D10     Jz      VALPRMRY
1083 FE2E       CPI     ""
1086 CA0000     JZ      DECODE
1088 FEAB       CPI     KEYSUB                                                      .
108A CA0000     JZ      VALUMINS
108D FE22       CPI     me      :STRING CONSTANT?
108F CA0000     JZ      VALSTRGC
1092 FEA8&       CPI     KEYNOT
1094 CA0000     JZ      VALUNOT
1097 FEA7       CPI     KEYFN   ;DEFINED FUNCTION?                                                     .
1099 CA0000     JZ      VALFCTD
109C FE8B       CPI     KEYIF   ;CONDITIONAL EXPRESSION?
109E CA0000     Jz      VALCOND
10A1 D6B7       SUI     KEYFCT ;INTRINSIC FUNCTION?
10A3 020000     JNC     VALFCIN
VALPARNS:
10A6 CDA303     CALL    SCANNXTV        ;bscan (vat)
10A9 28         DB      "("
VALPARN2:
10AA CD930F     CALL    VALEXPR ;bscan expr
10AD CDA303    CALL   SCANNXTV       ;bscan (val)
10B0 29         DB      "yn
1081 C9         RET
VALUMINS:
10B2 1670       MVI     D,PREDUMIN      ; EVALUATE UNARY MINUS                                          :
10B4 CDS60F     CALL    VALEXPRL
10B7 2A7103     LHLD    SCANPTR2
10BA E5         PUSH    H
10BB CDC000     CALL    CMACCS
VALRETNM:
10BE CDF40B     CALL    CSINGLE
10C1 Et         POP     H
10C2 C9         RET                                             .


=== PAGE _071 (PDF page 147) ===
basIC.LST                      §-Sep-78 14:29:54                                         Page 69
; EVALUATE A VARIABLE
VALVAR:
10C3 cD0000     CALL    VARSCAN ;SCAN & EVALUATE VARIABLE
10C6 E5         PUSH    H
10C7 DS         PUSH    D
10C8 EB         XCHG
10C9 1€D1       MVI     E,ERRNUV-ERRN
10CB C2F105     JNZ     ERRMSG
10CE 229303     SHLD    ACCUMLTR
10D1 CDD903     CALL    TYPECHK
10D4 EB         XCHG
10D5 219303     LXI     H,ACCUMLTR
10D8 C40000     CNZ     COPYVAL
10DB Dt         POP     D
10DC E14         Pop     H
10DD C9         RET
; EVALUATE CONDITIONAL EXPRESSION
VALCOND:
10DE CDABO3     CALL    SCANNXT ;bscan , EVAL CONDITIONAL EXPRESSION
10E1 CDF10B     CALL    VALNUMBR        ;bscan number
10E4 CDA303     CALL    SCANNXTV        :bscan (val)
10&7 AO         DB      KEYTHEN
10E8 CD0000     CALL    SIGNACC
10EB CA0000     Jz      VALCONDF
10EE CD930F     CALL    VALEXPR ;bscan expr     ; TRUE, EVALUATE THEN PORTION
10F1 1601       MVI     D1
VALCNDTL:                                                                                     :
10F3 OE82       MVI     C,KEYEND
10F5 CD700B     CALL    SCAN2KEY        ;SKIP ELSE PORTION
10F8 CDA303     CALL    SCANNXTV        ;bscan (val)
10FB 82         DB      KEYEND
10FC 15         DCR     D
10FD C2F310     JNZ     VALCNDTL
1100 C9         RET
VALCONDF :
1101 1601       MVI     D,1
VALCNDFL:      ;
1103 OE8C       MVI     C,KEYELS        ;FALSE, SKIP THEN PORTION
1105 CD700B     CALL    SCANZKEY
1108 CDA303     CALL    SCANNXTV        ;bscan (val)
110B 8C         DB      KEYELS
110C 15         DCR     D
110D C20311     JNZ     VALCNDFL
1110 CO930F     CALL    VALEXPR ;bscan expr     :; EVALUATE ELSE PORTION
1113 CDA303     CALL    SCANNXTV        ;bscan (val)
1116 82         DB      KEYEND
1117 C9         RET


=== PAGE _072 (PDF page 148) ===
basIC.LsT                      5-Sep-78 14:29:54                                         Page 70
; EVALUATE INTRINSIC FUNCTION
VALFCTN:
1118 0600       MVI     B,000H       ;Scan & EVALUATE INTRINSIC FUNCTION CALL
111A 07          RLC
111B 4F         MOV     C,A
111C C5         PUSH    B
111D CDABO3     CALL    SCANNXT ;bscan ,
1120 79         MOV     A,C
1121 FE2F       CPI     KEYLFT-KEYFCT*2-1       ;LEFT$, MID$, or RIGHT$
1123 DA0000     Jc      VALFCTAR
1126 CDA303     CALL    SCANNXTV        ;bscan (val)
1129 28         DB      ner
112A CD930F     CALL    VALEXPR ;bscan expr
112D CDFBOB     CALL    CSTRING
1130 EB         XCHG
1131 2A9303     LHLD    ACCUMLTR
1134 £3         XTHL            ;PUSH STRING ONTO STACK
1135 €30000     JMP     VALFCTLK
VALFCTAR:
1138 CDA610     CALL    VALPARNS        ;EVALUATE ARGUMENT TO FUNCTION
113B £3         XTHL
113C 11BE10     LXI     D,VALRETNM
113F D5         PUSH    D
VALFCTLK:
1140 01AC00     LXI     B,FCTTABL       ;BRANCH TO APPROPRIATE ROUTINE
1143 09         DAD     B                                                 ;
1144 4E         MOV     cM
1146 23         INX     H
1146 66         MOV     H,M
1147 69         MOV     L,Cc
1148 £9         PCHL            ;CALL FUNCTION


=== PAGE _073 (PDF page 149) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 71
+; PROCESS STRING CONSTANT
VALSTRGN:

1149 CDO0000     CALL    ENCODE ;CREATE STRING FROM NUMBER
VALSTRGZ:

114C 0680       MVI     B,080H

114E 2B         DCX     H

114F C30000     JMP     VALSTRGY
VALSTRGC:

1152 0622       MVI     B,'"    ;SCAN & DECODE A STRING CONSTANT
VALSTRGY:

1154 50         MOV     0,8
VALSTRGS:;

1155 £5         PUSH    H

1156 OEFF       MVI     C,-1
VALSTRGL:

1158 23         INX     H       FIND STRING LENGTH

1159 7E         MOV     A.M

115A OC         INR     Cc

115B B7         ORA     A

115C CA0000     JZ      VALSTRGE

115F BA         CMP     D

1160 CA0000     JZ      VALSTRGE

1163 B8         CMP     B

1164 C25811     JNZ     VALSTRGL
VALSTRGE:

1167 FE22       CPI     aa

1169 CCABO3     Cz      SCANNXT

116C £3         XTHL

116D 23         INX     H

116€ EB         XCHG

116F 79         MOV     A,C

1170 CbDo000     CALL    STRSTCDS

1173 EB         XCHG

1174 CDADOC     CALL    STRGTEST        ;LOCATE STRING

1177 3F         CMC

1178 1F         RAR

1179 BO         ORA     B

117A F40000     cP      STRGSTOR        ;MAKE A COPY OF CERTAIN BUFFERS

|


=== PAGE _074 (PDF page 150) ===
basIC.LSTt                      5-Sep-78 14:29:54                                         Page 72
; ALLOCATE STRING TEMPORARY
STRGALOT:
117D 116C03     LXI     D,STRGTMPL      ;USE CURRENT DESCRIPTOR
STRGALOU:
1180 D5         PUSH    D
1181 3603       MVI     A, TYPESTRG      ;RETURN STRING RESULT
1183 326803     STA     TYPEFLG
1186 2A8F03     LHLD    STRGTMPP        ;IN A NEW STRING TEMPORARY
1189 229303     SHLD    ACCUMLTR
118C EB         XCHG
118D 2A9103     LHLD    STRGTLIM        ;ANY MORE TEMPORARIES?
1190 CDCc104     CALL    CMHLLTDE
1193 DAGOGO     Jc      ERRAST
1196 EB         XCHG
1197 D1         POP     D       ;GET DESCRIPTOR           :
1198 CDO0000     CALL    COPYVAL ;COPY IT
119B 228F03     SHLD    STRGTMPP
119E E1         POP     H
119F C9         RET
STRGALOV:
11A0 E5         PUSH    H
11A1 C38011     JMP     STRGALOU
ERRAST:
11A4 1£92       MVI     E,ERRNST-ERRN
11A6 C3F105     JMP     ERRMSG


=== PAGE _075 (PDF page 151) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 73
; RELEASE STRING RESOURCES
STRGRELA:
11A9 2A9303     LHLD    ACCUMLTR
STRGRELH:
11AC EB         XCHG
STRGRELD:
11AD CD0000     CALL    STRGRELT        ;RELEASE TEMPORARY
11B0 EB         XCHG
11B1 CO         RNZ             ;NOT OUR BOY
11B2 D5         PUSH    D
11B3 50         MOV     D,B
11B4 59         MOV     E,C
11B5 1B         DCX     D
11B6 4E         MOV     C,M
11B7 2A8B03     LHLD    STRGFREE
11BA CDC104     CALL    CMHLLTDE
11BD C27008     JNZ     POPHLRET
11C0 47         MOV     B,A     ;RELEASE STRING SPACE
11€1 09         DAD     B
11C2 228B03     SHLD    STRGFREE
11C5 E14         POP     H
11€6 C9         RET
; RELEASE STRING TEMPORARY
STRGRELT:                             ;                                                 .
11C7 2A8FO3     LHLD    STRGTMPP        ;RELEASE STRING TEMPORARY
11CA 2B         DCX     H
11CB 46         MOV     BLM
11CC 2B         DCX     H                                .
11CD 4E         MOV     C,M
11CE 2B         DCX     H
11CF CDC104     CALL    CMHLLTDE
11D2 CO         RNZ
11D3 228F03     SHLD    STRGTMPP        ;RELEASE STRING TEMPORARY
11D6 C9         RET


=== PAGE _076 (PDF page 152) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 74
; EVALUATE A CATENATION
VALCONCT;:
1107 C5         PUSH    B       s;EVALUATE A CONCATENATION
11D8 E5         PUSH    H
11D9 2A9303     LHLD    ACCUMLTR        ;SAVE FIRST OPERAND,
11DC E3         XTHL
11DD CD6D10     CALL    VALPRMRY        ;bscan prmry    ;EVALUATE SECOND
11E0 E3         XTHL
11E1 CDFBOB     CALL    CSTRING
11E4 7E         MOV     A,M     ;ADD LENGTHS,
11E5 £5         PUSH    H
11E6 2A9303     LHLD    ACCUMLTR
141E9 ES         PUSH    H
11EA 86         ADD     M
11EB 1£3B       MVI     E,ERRNLS-ERRN
11ED DAF105     Jc      ERRMSG
11F0 CD0000     CALL    STRNGEN ;AND ALLOCATE OUTPUT STRING
11F3 D1         POP     D
11F4 CDAD11     CALL    STRGRELD        ;RELEASE STRING TEMPORARIES                                    :
11F7 E3         XTHL
11F8 CDAC11     CALL    STRGRELH
11FB E5         PUSH    H
11FC 2A6D03     LHLD    STRGTMPA        ;COPY STRINGS TO OUTPUT STRING
11FF EB         XCHG
1200 CD0000     CALL    VALCONCP
1203 CDp0000     CALL    VALCONCP
1206 21A50F     LXI     H, VALEXPRD
1209 £3         XTHL
120A E5         PUSH    H
120B C37D11     JMP     STRGALOT
VALCONCP:
120E £1         POP     H       ;COPY STRING FOR CATENATION
120F £3         XTHL
1210 7E         MOV     A.M     ;GET LENGTH,                                                           :
1211 23         INX     H
1212 4E         MOV     CM     ;ADDRESS OF STRING
1213 23         INX     H
1214 46         MOV     B,M
1215 6F         MOV     L,A
COPYSTRG:
1216 2C         INR     L       ;COPY A STRING OF LENGTH L
COPYSTRL:
1217 2D         DCR     L       ;FROM BC TO DE
1218 C8         RZ
1219 OA         LDAX    B
121A 12         STAX    D
121B 03         INX     B
121C 13         INX     D
121D C31712     JMP     COPYSTRL


=== PAGE _077 (PDF page 153) ===
basIC.LST                      5~Sep-78 14:29:54                                  ;      Page 75
; DIMENSION STATEMENT PROCESSING
DIMSTML:
1220 2B         DCX     H
1221 CDABO3     CALL    SCANNXT ;bscan ,
1224 C8         RZ
1225 CDA303     CALL    SCANNXTV        ;bscan (val)
1228 2C         OB      "i"
DIMSTM:                                                                             .
1229 012012     LXI     B,DIMSTML |     ;DIM STATEMENT
122C C5         PUSH    B
122D 3E80       MVI     A,080H
122F C30000     JMP     VARSCANI
; SCAN A VARTABLE NAME
VARSCAN:
1232 AF         XRA     A       ;SCAN FOR VARIABLE
VARSCANI:
1233 326A03     STA     MATDMFLG
1236 0600       MVI     B, O* TYPEDEF
VARSCNDF:
1238 CDBBO3     CALL    ALPHACHK        ;ENTRY TO SCAN FOR DEFINED FCT
123B D2EF05     JNC     ERRASN
123£ BO         ORA     B
123F 47         MOV     B,A
1240 OESF       MVI     c,"?"
1242 1604       MVI     D,TYPESING      ;ASSUME NUMERIC VARIABLE
1244 CDAB03     CALL    SCANNXT ;bscan ,
1247 DA0000     JC      VARSCAND
124A CDBB03     CALL    ALPHACHK
124D D20000     JNC     VARSCANS
VARSCAND:
1250 4F         MOV     C,A
VARSKIPL:
1251 CDABO3     CALL    SCANNXT ;bscan ,        SKIP EXTRA ALPHANUMERIC
1254 DAS112     JC      VARSKIPL        ;CHARACTERS IN NAME
1257 CDBBO3     CALL    ALPHACHK
125A DAS112     JC      VARSKIPL
VARSCANS:
125D D624       SUI     "$"     ;STRING VARIABLE?
125F C€20000     JNZ     VARNAME
1262 1603       MVI     D,TYPESTRG      sYES
1264 CDABO3     CALL    SCANNXT ;bscan ,
VARNAME :
1267 78         MOV     A,B     ; TRANSLATE IDENT TO INTERNAL FORM
1268 D640       SUI     "@"     ;DEF/VARIABLE IS FIRST BIT
126A 07         RLC             ;FIRST CHAR IS NEXT FIVE BITS
126B 07         RLC
126C 47         MOV     B,A
126D 79         MOV     A,C     ;SECOND CHAR IS NEXT SIX BITS
126E D630       SUI     "a"


=== PAGE _078 (PDF page 154) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 76
1270 OF         RRC
1271 OF         RRC
1272 OF         RRC
1273 OF         RRC
1274 4F         MOV     CA
1275 A&B         XRA     B       ;PACK THREE BYTES INTO TWO
1276 E603       ANI     003H
1278 A8&         XRA     B
1279 47         MOV     B,A
127A 7A         MOV     A,D
127B 326B03     STA     TYPEFLG
127E AQ         XRA     Cc       ;TYPE IS LAST FOUR BITS
127F E60F       ANI     OOFH
1281 AQ         XRA     Cc
1282 4F         MOV     C,A
1283 3A6703     LDA     SCANPFLG
1286 86         ADD     M
1287 FE28       cPI     "“"     ; SUBSCRIPTED?
1289 CA0000     JZ      MATSCANP
128C FE5B       CPI     "["     ;BY LEFT BRACKET?
128E CA0000     Jz      MATSCANB
1291 AF         XRA     A
1292 326703     STA     SCANPFLG
1295 £5         PUSH    H
; LOOK UP VARIABLE IN TABLE
1296 2A8303     LHLD    VARTABLE                  ;                                                 ;
VARSCANT:
1299 EB         XCHG
129A 2A8503     LHLD    MATTABLE
129D CDC104     CALL    CMHLLTDE        ;LOOK THROUGH VARIABLE TABLE
12A0 CA0000     JZ      VARSCANF
12A3 1A         LDAX    D
12A4 6F         MOV     L,A
12A5 89         CMP     C
12A6 13         INX     D
12A7 C20000     ONZ     VARSCANM
12AA 1A         LDAX    D
12AB B8         CMP     B
VARSCANM:
12AC 13         INX     D
12AD CA0000     JZ      VARSCANX
1280 7D         MOV     A,L
12B1 E60F       ANI     OOFH    ;ADDRESS NEXT ENTRY
12B3 6F         MOV     L,A
12B4 2600       MVI     H,0
12B6 19         DAD     D
12B7 C39912     JMP     VARSCANT      .
VARSCANF:
12BA C5         PUSH    B       ;NOT FOUND, CREATE ENTRY
12BB 79         MOV     A,C
12BC E60F       ANI     OOFH


=== PAGE _079 (PDF page 155) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 77
12BE C602       ADI     2
12CO 4F         MOV     C,A
12C1 0600       MVI     B,0
12C3 EB         XCHG
1204 2A8763     LHLD    FREELIMT
12C7 ES         PUSH    H
12C8 09         DAD     B
12C9 C1         PoP     B
12CA ES         PUSH    H
12CB CDC704     CALL    COPYCHK ;MOVE ARRAYS FOR SPACE
12CE E1         POP     H
12CF 228703     SHLD    FREELIMT
12D2 60         MOV     H,B
12D3 69         MOV     L,C
12D4 228503     SHLD    MATTABLE     ' ALLOCATE, ZERO ENTRY
VARALLOC:
12D7 2B         DCX     H
12D8 3600       MVT     M,000H
12DA CDC104     CALL    CMHLLTDE
12DD €2D712     JNZ     VARALLOC
12E0 D1         POP     D
12E1 73         MOV     M,E                                                                            .
12E2 23         INX     H
12E3 72         MOV     M,D
12E4 23         INX     H
12E5 EB         XCHG            ;EXIT VARIABLE SCAN
12E6 B3         ORA     E       i;NZ=VAR NOT FOUND, CREATED
VARSCANX:
12E7 £1         POP     H       ;HL=SCAN POINTER
12E8 C9         RET             ;BE=VARIABLE REFERENCE
; LOOK UP ARRAY IN TABLE
MATSCANB:
12E9 C601      ADI     J-'Le(-')     ;(got me?)
MATSCANP:
12EB C601      ADI     'y-"(
12ED E5         PUSH    H       ;SCAN SUBSCRIPT OF VARIABLE
12EE 2A6A03     LHLD    MATDMFLG
12F1 BS         ORA     L
12F2 6F         MOV     L,A
12F3 £3         XTHL            ;SAVE DIMFLAG, CLOSE CHAR, TYPE
12F4 1600       MVI     D,000H
MATSCANL:
12F6 DS         PUSH    D       ;SCAN SUBSCRIPT LIST           .
12F7 C5         PUSH    B
12F8 CDABO3     CALL    SCANNXT ;bscan ,
12FB CDO70C     CALL    VALINTDE        ;EVALUATE SUBSCRIPT
12FE Ci         POP     B
12FF Ft         POP     PSW
1300 EB         XCHG
1301 £3         XTHL
1302 £5         PUSH    H
1303 EB         XCHG
1304 3C         INR     A       ;COUNT NUMBER OF SUBSCRIPTS


=== PAGE _080 (PDF page 156) ===
basIC.LST                      55-Sep-78 14:29:54                                         Page 78
1305 57         MOV     DLA
1306 7E         MOV     A.M
1307 FE2Cc       CPI     oa
1309 CAF612     JZ      MATSCANL
i30C £3         XTHL
130D 226A03     SHLD    MATDMFLG        ;RESTORE DIMFLAG, TYPE
1310 7D         MOV     A,L
1311 E1         POP     H
1312 AE         XRA     M
1313 87         ADD     A       ;CHECK FOR CORRECT CLOSER
1314 C2EF05     JNZ     ERRASN
1317 227103     SHLD    SCANPTR2
131A D5         PUSH    D
131B 2A8503     LHLD    MATTABLE        ;LOOK FOR NAME IN
131E£ C30000     JMP     MATSCANO        ;MAT VARIABLE TABLE
MATSCANN:
1321 19         DAD     D
MATSCANO:                                     :
1322 EB         XCHG
1323 2A8703     LHLD    FREELIMT
1326 EB         XCHG
1327 CDC104     CALL    CMHLLTDE
132A CA0000     dz      MATSCANC
132D 7E         MOV     A.M
132E Bg         CMP     Cc
132F 23         INX     H
1330 C20000     JNZ     MATSCANM
1333 7E         MOV     A.M
1334 B8         CMP     B
MATSCANM:
1335 23         INX     H
1336 5E         MOV     EM
1337 23         INX     H
1338 56         MOV     D,M
1339 23         INX     H
133A C22113     JNZ     MATSCANN
133D 3A6A03     LDA     MATDMFLG        ;NAME FOUND
1340 B7         ORA     A
1341 1610       MVI     E,ERRNOD-ERRN
1343 FAF105     JM      ERRMSG
1346 Fi         POP     PSW     ;RIGHT NUMBER OF SUBSCRIPTS?
1347 BE         CMP     M
1348 CA0000     dz      MATSCANI
ERRABS:
134B 1E9F       MVI     E,ERRNBS-ERRN
134D C3F105     JMP     ERRMSG
MATSCANC:
1350 79         MOV     A,C     ;NAME NOT FOUND, CREATE NEW ENTRY
1351 E60F       ANI     OOFH
1353 5F         MOV     E,A
1354 1600       MVI     D,0
1356 71         MOV     M,C
1357 23         INX     H
1358 70         MOV     M,B
1359 23         INX     H


=== PAGE _081 (PDF page 157) ===
basIC.LST            §-Sep-78 14:29:54                       Page 79
135A Fi         POP     PSW
135B 326903     STA     MATSCCNT
135E 4F         MOV     C,A
135F CDD804     CALL    SPACESTK
1362 226F03     SHLD    SCANPTRi
1365 23         INX     H
1366 23         INX     H       ;plus 2
1367 41         MOV     B,C
1368 70       MOV    M,B
1369 23         INX     H
MATSCNSB:
136A 3A6A03     LDA     MATDMFLG        ;SET SUBSCRIPT RANGES
136D B7         ORA     A
136E 78         MOV     A,B
136F 010800     LXI     B,11    ;DEFAULT RANGE=0-10
1372 F20000     JP      MATSCNSD
1375 C1         POP     B
1376 03         INX     B
MATSCNSD:
1377 71         MOV     M,C
1378 23         INX     H
1379 70         MOV     M,B
137A 23         INX     H
137B F5         PUSH    PSW
137C E5       PUSH   H
137D cDO0000     CALL    MUL16   ;UPDATE ARRAY SIZE
1380 EB         XCHG
1381 E1         POP     H
1382 C1         POP     B
    1383 05         DCR     B                                                 ;
1384 C26A13     JNZ     MATSCNSB
1387 42         MOV     B,D
1388 4B         MOV     C,E
1389 EB         XCHG            ;ALLOCATE ARRAY,        .
138A 19         DAD     D
138B DA4B13     Jc      ERRABS
138E CDE504     CALL    SPACECHK
1391 228703     SHLD    FREELIMT
MATSCANZ:
1394 2B         DCX     H       ;AND ZERO                                  .
1395 3600       MVI     M,O00H
1397 CDC104     CALL    CMHLLTDE
139A €29413     JNZ     MATSCANZ
139D 03         INX     B       ;SAVE ENTRY SIZE
139E 67         MOV     H,A
139F 3A6A03     LDA     MATDMFLG
13A2 B7         ORA     A
13A3 3A6903     LDA     MATSCCNT
13A6 6F         MOV     L,A
13A7 29         DAD     H
13A8 09         DAD     B             :
13A9 EB         XCHG
13AA 2A6F03     LHLD    SCANPTR1        ;AT BEGINNING OF ENTRY
13AD 73         MOV     M,E
13AE 23         INX     H
13AF 72         MOV     M,D


=== PAGE _082 (PDF page 158) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 80
13B0 23         INX     H
13B1 FAQO00     JM      MATSCANX        ;DIM ONLY?

MATSCANI:
13B4 23         INX     H       INITIALIZE SUBSCRIPT COMPUTATION
13B5 010000     LXI     B,O
13B8 C30000     JMP     MATSCANS

MATSCANR:
13BB £1         POP     H       ;COMPUTE SPECIFIC REFERENCE

MATSCANS:
13BC 5E         MOV     E,M
13BD 23         INX     H
13BE 56         MOV     D,M
13BF 23         INX     H
13C0 £3         XTHL
13C1 FS         PUSH — PSW
13C2 CDC104     CALL — CMHLLTDE
13C5 024813     JNC     ERRABS
13C8 £5         PUSH =H
13C9 CD0000     CALL —- MUL16
13CC D1         POP     D
13CD 19         DAD     D
13CE F4         POP     PSW                                                                            ;
13CF 3D         DCR     A
13D0 44         MOV     BH
13D1 4D         MOV     CL
13D2 C2BB13     NZ     MATSCANR
13D5 3A6B03     LDA     TYPEFLG
13D8 5F         MOV     E,A
13D9 1600       MVI     D,0
13DB cD0000     CALL  MUL16  ;MULTIPLY BY ENTRY SIZE
13DE C1         POP     B
13DF 09         DAD     B
13E0 EB         XCHG

MATSCANX:
13E1 2A7103     LHLD —- SCANPTR2
13E4 CDABO3     CALL SCANNXT ;bscan ,
13E7 BF         CMP     A
13E8 C9          RET

MUL16:
13E9 210000     LXI     H,0     ;MULTIPLY BC*DE GIVING HL
13EC 78         MOV     A,B
13ED B1         ORA     c
13EE C8         RZ
13EF 3610       MVI     A, 16

MUL16LP:
13F1 29         DAD     H
13F2 DA4B13     JC      ERRABS
13F5 EB         XCHG
13F6 29         DAD     H
13F7 EB         XCHG
13F8 D20000     INC     MUL 16XT
13FB 09         DAD     B
13FC DA4B13     JC      ERRABS

MUL16XT:
13FF 3D         DCR     A


=== PAGE _083 (PDF page 159) ===
basIC.LST            5-Sep-78 14:29:54                       Page 81
1400 C2F113    JNZ    MUL16LP
1403 C9        RET


=== PAGE _084 (PDF page 160) ===
basIC.LST                      56-Sep-78 14:29:54                                          Page 82
; USER-DEFINED FUNCTION DEFINITION
DEFSTM:
1404 CD0000     CALL    SCANFNN ;DEF STATEMENT
1407 £5         PUSH    H       ;CHECK IF IN DIRECT MODE                       ;
1408 2A7303     LHLD    CURLINE ;Z=DIRECT MODE
140B 23         INX     H
140C 7C         MOV     A,H
140D B5         ORA     L
140E E1         POP     H
140F CAO000 ~©§=«—.az      ERRAID
1412 EB         XCHG            ;SAVE REFERENCE TO DEFINITION
1413 73         MOV     M,E
1414 23         INX     H
1415 72         MOV     M,D
1416 EB         XCHG
1417 7E         MOV     A,M
1418 FE28       CPI     ner     ;CHECK FOR VARLIST
DEFSTML:
141A C2690B     JNZ     DATSTM
141D CDABQ3     CALL    SCANNXT ;bscan ,
1420 CD3212     CALL    VARSCAN ;DEFINE VARIABLES IN LIST
1423 7E         MOV     A.M
1424 FE2C       CPI     e
1426 C31A14     JMP     DEFSTML
; USER-DEFINED FUNCTION EVALUATION
VALFCTD:                                                                               :
1429 CD0000     CALL    SCANFNN        SCAN     ;& EVALUATE USER DEFINED FUNCTION
142C 3A6B03     LDA     TYPEFLG ;SAVE TYPE OF FUNCTION
142F B7         ORA     A
1430 F5         PUSH    PSW
1431 E5         PUSH    H       ;SAVE CALL ARGUMENTS
1432 EB         XCHG
1433 7E         MOV     A.M
1434 23         INX     H
1435 66         MOV     H,M     ;FETCH FUNCTION DEFINITION
1436 6F         MOV     L.A
1437 B4         ORA     H
1438 1EB5       MVI     £ , ERRNUF-ERRN
143A CAF105     JZ      ERRMSG ;MUST BE DEFINED ...


=== PAGE _085 (PDF page 161) ===
basIC.LST            5-Sep-78 14:29:54                       Page 83
143D 7E         MOV     A.M
143E FE28       CPI     ne"     ;PARAMETERS NEEDED?
1440 €20000     JNZ     VALFCTNA        ;APPARENTLY NOT
1443 CDABO3     CALL    SCANNXT ;bscan ,
1446 E3         XTHL
1447 CDA303    CALL   SCANNXTV      ;bscan (val)
144A 28         DB      nc"     ;MUST BE PARAMETERS IN CALL
144B E3         XTHL
144C €30000     JMP     VALFCTDM
; ARGUMENT SCANNING
VALFCTDL:
144F CDA303     CALL    SCANNXTV        ;bscan (val)                               .
1462 2C         DB      ree     ;COMMAS BETWEEN ARGUMENTS
1463 £3         XTHL
1454 CDA303     CALL    SCANNXTV        ;bscan (val)
1457 2C         DB      "vn     ;AND BETWEEN PARAMETERS
VALFCTDM:
1458 0EF04       MVI     C,4     ;VERIFY SPACE ON STACK                                                :
145A CDD804     CALL    SPACESTK
145D 3EAB       MVI     A,SCANPFLD      ;SCAN NEXT PARAMETER
145F 326703     STA     SCANPFLG
1462 CDC310     CALL    VALVAR ;GET CURRENT VALUE OF PARAMETER
1465 226F03     SHLD    SCANPTR1        ;SAVE PARAMETER SCAN
1468 E1         POP     H
1469 227103     SHLD    SCANPTR2        ; SAVE ARGUMENT SCAN
146C CDD903     CALL    TYPECHK
146F CA0000     JZ      VALFCTPS        ;PUSH STRINGS DIFFERENTLY
1472 CD0000     CALL    PUSHAC1 ;PUSH NUMERIC ACCUMULATOR
1475 E5         PUSH    H       ; SAVE VARIABLE"S ADDRESS
1476 C30000     JMP     VALFCTPT
VALFCTPS:
1479 CDA011     CALL    STRGALOV        ;COPY DESCRIPTOR TO TEMPORARY
147C AF         XRA     A       ;ELIMINATE ORIGINAL DESCRIPTOR
147D 1B         DCX     D                                                                              :
147E 18         DCX     D
147F 18         DCX     D       iplus 3
1480 12         STAX    D
1481 2A9303     LHLD    ACCUMLTR        ;GET ADDRESS OF DESCRIPTOR
1484 ES         PUSH    H
1485 D5         PUSH    D       ;PUT IT BACK HERE LATER


=== PAGE _086 (PDF page 162) ===
basIC.LST                      55-Sep-78 14:29:54                                          Page 84
VALFCTPT:
1486 3A6B03     LDA     TYPEFLG ;SAVE TYPE OF PARAMETER
1489 37         STC
148A D1        POP     9)
148B D6         PUSH    D       ;GET COPY OF ADDRESS
148C F5         PUSH    PSW
148D 2A6F03     LHLD    SCANPTR1        ;SAVE PARAMETER SCAN
1490 E5       PUSH   H
1491 2A7103     LHLD    SCANPTR2
1494 CDB10B     CALL    ASSIGNVL        ;UPDATE VALUE OF PARAMETER
1497 7E         MOV     A,M      :
1498 FE29       CPI     "yr
149A C24F14     JNZ     VALFCTDL        :;MORE ARGUMENTS
149D CDABO3    CALL   SCANNXT ;bscan ,
14A0 E3         XTHL
14A1 CDA303     CALL    SCANNXTV        ;bscan (val)
14A4 29         DB      "y"     ;MUST BE END OF PARAMETERS TOO
; EVALUATE EXPRESSION
VALFCTNA:
14A5 CDA303     CALL    SCANNXTV        sbscan (val)
14A8 BS         DB      KEYEQ   ;LOOK FOR EQUALS SIGN
14A9 CD930F     CALL    VALEXPR ;bscan expr     ;EVALUATE FUNCTION
14AC 2B         DCX     H
14AD CDABO3     CALL    SCANNXT ;bscan ,
14B0 C2EF05     JNZ     ERRASN
14B3 E1         POP     H
14B4 226F03     SHLD    SCANPTR1i
14B7 CDD903     CALL    TYPECHK                                                              :
14BA €20000     JNZ     VALFCTRL
14BD CDD60B     CALL    STRGUNIQ                                                                         :
14C0 EB         XCHG
14C1 229303     SHLD    ACCUMLTR


=== PAGE _087 (PDF page 163) ===
basIC.LST                      5-Sep-78 14:29:54                                  :      Page 85
; RESTORE PARAMETERS
VALFCTRL:
1404 Fi         POP     PSW     ;RESTORE VALUES OF PARAMETERS
14C6 020000     JNC     VALFCTCR
14C8 E1         POP     H
14C9 CDDCO3     CALL    TYPECHKA
14CC CA0000     Jz      VALFCTRS
14CF C1         POP     B
14D0 Di         POP     D
14D1 73         MOV     M,E     RESTORE NUMERIC VALUE
14D2 23         INX     H
14D3 72         MOV     M,O
14D4 23         INX     H
14D5 71         MOV     M,C
14D6 23         INX     H
1407 70         MOV     M,B                               .
1408 C3C414     JMP     VALFCTRL
VALFCTRS:
14DB D1         POP     D       ;RESTORE STRING VALUE
14D0C EB         XCHG
14DD 228F03     SHLD    STRGTMPP        ;DEALLOCATE TEMPORARY
14E0 EB         XCHG
14E1 0603       MVI     B,TYPESTRG
14E3 CD0000     CALL    COPYVALL
14E6 C3C414     JMP     VALFCTRL
VALFCTCR:
14E9 2A6F03     LHLD    SCANPTR1        ;COERCE RESULT TO CORRECT TYPE
14EC CDDC03     CALL    TYPECHKA
14EF C2E80B     INZ     COERCEF
14F2 CDFBOB     CALL    CSTRING ;STRING FUNCTION
14F5 £5         PUSH    H
14F6 2A9303     LHLD    ACCUMLTR
14F9 EB         XCHG
14FA CDC711     CALL    STRGRELT
14FD C38011     MP     STRGALOU
ERRAID:
1500 1E1A       MVI     E, ERRNID-ERRN
1602 C3F105     JMP     ERRMSG
SCANFNN:
1505 CDA303     CALL    SCANNXTV        ;bscan (val)
1508 A7         OB      KEYFN
1509 3EAB       MVI     A,SCANPFLD
150B 326703     STA     SCANPFLG
150E 0620       MVI     B, TYPEDEF
1510 €33812     JMP     VARSCNDF


=== PAGE _088 (PDF page 164) ===
basIC.LST            5-Sep-78 14:29:54                       Page 86
; GENERATE A NEW CURRENT STRING
STRNGEN:
1513 CD0000     CALL    STRGALOC        ;GENERATE A NEW STRING,
STRSTCDS:                                             ;
1516 216C03     LXI     H,STRGTMPL      :SET CURRENT STRING DESCRIPTOR
1619 ES       PUSH   H
151A 77         MOV     M,A
151B 23         INX     H
151C 73         MOV     M,E
151D 23         INX     H
151E 72         MOV     M,D
151F E14         PoP     H
1620 C9         RET
; ALLOCATE STORAGE IN STRING SPACE
STRGALOC:
1621 B7         ORA     A       ;ALLOCATE SPACE FOR STRING,
1522 €30000     JMP     STRGALAH        ;SIZE IN A
STRGALAG:
1625 F1         POP     PSW     :ENTER FOR SECOND TRY
STRGALAH:
1526 F5         PUSH    PSW
1527 2A8903     LHLD    STCKBASE
152A EB         XCHG
152B 2A8B03     LHLD    STRGFREE                  :                                                 ;
152E 2F         CMA
152F 4F         MOV     C,A
1530 O6FF       MVI     B,OFFH
1532 09         DAD     B
1533 23         INX     H
1534 CDC104     CALL    CMHLLTDE
1537 DAQ000     Jc      STRGALGC
153A 228B03     SHLD    STRGFREE
153D 23         INX     H
153E EB         XCHG            ;RETURNS: DE=STRING ADDRESS
POPAFRET:
153F Fl         POP     PSW
1540 C9         RET
STRGALGC:
1541 Fi         POP     PSW     ;COLLECT GARBAGE IN STRING SPACE
1642 1£85       MVI     E, ERRNOS-ERRN
1544 CAF105     JZ      ERRMSG
1547 BF         CMP     A
1548 F5         PUSH    PSW
1549 012515     LXI     B, STRGALAG     - ; THEN TRY ALLOCATION
154C C5         PUSH    B


=== PAGE _089 (PDF page 165) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 87
; COLLECT GARBAGE IN STRING SPACE
STRGGBCL:

154D 2A8D03     LHLD    STRGBASE        ;MAKE ALL STRINGS UNSAFE
STRGGBLP:

1650 228B03     SHLD    STRGFREE        FIND HIGHEST UNSAFE STRING

1653 210000     LXI     H,0

1656 E5         PUSH    H

1657 2A8903     LHLD    STCKBASE

165A E5         PUSH    H

155B 2A8D03     LHLD    STRGBASE        ;SCAN TEMPORARIES,

165E 23         INX     H
STRGGBTL:

155F EB         XCHG

1660 2A8F03     LHLD    STRGTMPP

1563 EB         XCHG

1664 CDC104     CALL    CMHLLTDE

1567 015F15     LXI     B,STRGGBTL

156A €20000     JNZ     STRGGBHI

156D 2A8303     LHLD    VARTABLE        SCAN REGULAR VARIABLES,                                       .
STRGGBVR:

1570 EB         XCHG

1571 2A8503     LHLD    MATTABLE

1574 EB         XCHG

1575 CDC104     CALL    CMHLLTDE

1578 CAQ000     JZ      STRGGNAV

157B 7E         MOV     A,M

157C€ 23         INX     H

157D E6OF       ANI     OOFH

157F D603       SUI     TYPESTRG

1581 SF         MOV     E,A

1582 9F         SBB     A

1583 57         MOV     DA

1584 7E         MOV     A.M

1585 23         INX     H

1586 E680       ANI     080H    ;DEFINITIONS ARE STRINGS                                               ;

1588 19         DAD     1)

1589 B3         ORA     E

158A CD0000     CALL    STRGGBHV

168D C37015     JMP     STRGGBVR
STRGGBAL:

1690 C1         POP     B
STRGGNAV:                                           .

1591 EB         XCHG            ;SCAN ARRAY VARIABLES

1692 2A8703     LHLD    FREELIMT

1595 EB         XCHG

1696 CDC104     CALL    CMHLLTDE

1599 CAQ000     Jz      STRGGBMV

169C cDO0000     CALL    LDRGMM

159F 7B         MOV     A,E

15A0 E5         PUSH    H

15A1 09         DAD     B

15A2 E60F       ANI     OOFH


=== PAGE _090 (PDF page 166) ===
basIC.LST            5-Sep-78 14:29:54                   ;   Page 88
15A4 FEO3       CPI     TYPESTRG
15A6 C29015     JNZ     STRGGBAL
15A9 226F03     SHLD    SCANPTR1
15AC E1        POP    H
15AD 4E        MOV    cM
15AE 0600       MVI     B,000H
15B0 09         DAD     B
15B1 09         DAD     B
15B2 23       INX    H
STRGGBAS:
15B3 EB         XCHG            ;LOOK THROUGH ENTIRE ARRAY
15B4 2A6F03     LHLD    SCANPTR1
15B7 EB         XCHG
16B8 CDC104     CALL    CMHLLTDE
15BB CA9115     Jz      STRGGNAV
15BE 018315     LXI     B,STRGGBAS
STRGGBHI;
15C1 C5         PUSH    B       ;COMPARE THIS STRING ADDR TO MAX
15C2 AF         XRA     A
STRGGBHV:
15C3 4E         MOV     C,M     ;LOAD STRING DESCRIPTOR
16C4 23         INX     H
15C5 5E         MOV     EM
15C6 23         INX     H
15C7 56         MOV     DM
16C8 23         INX     H
15C9 CO         RNZ             ;NOT A STRING VARIABLE
15CA 79         MOV     A,C
15CB B7         ORA     A       ;CHECK FOR ZERO LENGTH
15CC C8         RZ
15CD 44         MOV     B,H     ;ALREADY SAFE?
15CE 4D         MOV     Cyt
15CF 2A8B03     LHLD    STRGFREE                                                                          ;
15D2 CDC104     CALL    CMHLLTDE
15D5 60         MOV     H,B
15D6 69         MOV     L,Cc
15D7 D8         RC
15D8 E1         POP     H       ;COMPARE WITH HIGHEST UNSAFE
15D9 E3         XTHL
15DA CDC104     CALL    CMHLLTDE
15DD E3         XTHL
15DE ES         PUSH    H
15DF 60         MOV     H,B
15£0 69         MOV     L,Cc
15E1 DO         RNC
15E2 C1         POP     B       ;SAVE NEW HIGHEST UNSAFE ADDR
15E3 F1         POP     PSW
15E4 Fi         POP     PSW
15E5 E§         PUSH    H
15E6 D5         PUSH    D
1SE7 C5         PUSH    B
15E8 C9         RET


=== PAGE _091 (PDF page 167) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 89
STRGGBMV:

1569 D1         POP     D       ;MAKE HIGHEST UNSAFE SAFE

15EA Et         POP     H

15EB 7D         MOV     AL

15EC B4         ORA     H

15ED C8         RZ              ;ANY UNSAFE?

15EE 2B         DCX     H       ;LOAD DESCRIPTOR

15EF 46         MOV     BLM

15FO 28         DCX     H

15F1 4E         MOV     c,M

15F2 £5         PUSH =H

15F3 2B         DCX     H

15F4 6E         MOV     L.M     ;FIND END OF STRING

15F5 2600       MVI     H,000H

15F7 09         DAD     B

15F8 50         MOV     D,B

15F9 59         MOV     E.C

15FA 2B         DCX     H

15FB 44         MOV     B,H

15FC 4D         MOV     C.L

15FD 2A8B03     LHLD —- STRGFREE        ;COPY IT TO END OF SAFE AREA

1600 CDCA04     CALL * COPYTEXT

1603 E14         POP     H

1604 71         MOV     M,C

1605 23         INX     H

1606 70         MOV     M,B

1607 60         MOV     H,B

1608 69         MOV     Lc

1609 2B         DCX     H

160A C35015     MP     STRGGBLP        ;EXTEND SAFE AREA


=== PAGE _092 (PDF page 168) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 90
; VARIOUS NUMERIC/STRING CONVERSION FUNCTIONS
; FINO LENGTH OF STRING
LENFCT:
160D 01CE0D     LXI     B,FLOATA        ;LEN FUNCTION
1610 C5         PUSH    B
LENFCTC:
1611 CDFBOB     CALL    CSTRING
1614 CDA911i     CALL    STRGRELA
1617 3604       MVI     A, TYPESING   ,
1619 326B03     STA     TYPEFLG
161C 7E         MOV     A.M
161D B7         ORA     A
161E 23         INX     H
161F C9         RET
; CONVERT CHARACTER TO BYTE
ASCFCT:
1620 CD01116     CALL    LENFCTC ;ASC FUNCTION
1623 CA230C     Jz      ERRAFC
1626 4E         MOV     C,M     FETCH ADDRESS
1627 23         INX     H
1628 46         MOV     BLM
1629 OA         LDAX    B       ;THEN THE FIRST CHARACTER
162A C3CECD     JMP     FLOATA
; CONVERT BYTE TO CHARACTER
CHRFCT:
162D 3E01       MVI     A,1     ;CHR$ FUNCTION                                                         :
162F CD1315     CALL    STRNGEN
1632 CD2FOC     CALL    CBYTE
1635 2A6D03     LHLD    STRGTMPA
1638 73         MOV     M,E
VALRETST:
1639 Ci         POP     B       ;STRING FUNCTION, REMOVE CSINGLE
163A C37D11     JMP     STRGALOT


=== PAGE _093 (PDF page 169) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 91
; DECODE NUMBER FROM STRING
VALFCT:
163D €D1116     CALL    LENFCTC ;VAL FUNCTION
1640 CA0000     JZ      ZEROAC
1643 5F         MOV     E,A
1644 1600       MVI     D,0
1646 4E         MOV     C,M
1647 23         INX     H                                                                       ;
1648 46         MOV     BM       .
1649 C5         PUSH    B
164A 60         MOV     H,B
164B 69         MOV     L,C
164C 19         DAD     D
164D 46         MOV     BLM
164E 72         MOV     M,D                              :
164F £3         XTHL
1650 C5         PUSH    B
1651 7E         MOV     A.M
1652 CDO000     CALL    DECODE
1655 C1         POP     B
1666 E1         POP     H
1657 70         MOV     M,B
1658 C9         RET
; ENCODE NUMBER IN STRING
STRFCT:
1659 CDF40B     CALL    CSINGLE ;STR$ FUNCTION
165C CD4911     CALL    VALSTRGN        ;CREATE STRING FROM NUMBER                                       :
165F CDA911     CALL    STRGRELA
1662 013916     LXI     B,VALRETST
1665 C5         PUSH    B
1666 EB         XCHG
STRGSTOR;
1667 EB         XCHG
1668 7E         MOV     A,M     ;STORE STRING INTO STRING SPACE,
1669 E5         PUSH    H       ;LEAVE DESCRIPTOR IN STRGTMP
166A CD2115     CALL    STRGALOC
166D E1         POP     H
166E CD0000     CALL    LDICBMM ;LOAD BUFFER ADDRESS
1671 CD1615     CALL    STRSTCDS
1674 E5         PUSH    H
1675 6F         MOV     L,A
1676 CD1612     CALL    COPYSTRG
POPDERET:
1679 D1         POP     D
167A C9         RET


=== PAGE _094 (PDF page 170) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 92
; CONVERT HEX STRING TO NUMBER
HXVFCT:
167B CD1116     CALL    LENFCTC ;DO INITIAL PROCESSING
167E CA0000     JZ      ZEROAC
1681 5F         MOV     E,A
1682 4E         MOV     C.M
1683 23         INX     H
1684 46         MOV     BLM
1685 210000     LXI     H,0     ;INITIAL OUTPUT TO ZERO
HXVFCTL:
1688 0A         LDAX    B       ;FETCH CHARACTER
1689 03         INX     B
168A FE3A       CPI     mye     ; VERIFY THAT IT"S HEX
168C D40000     CNC     HXVFCTCH
168F 02230C     JNC     ERRAFC ;IF NOT, COMPLAIN
1692 D630       SUI     "og"
1694 DA230C     Jc      ERRAFC ;MUST BE AT LEAST ZERO
1697 29         DAD     H
1698 29         DAD     H       ; INCORPORATE NEW DIGIT
1699 29         DAD     H
169A 29         DAD     H
169B B5        ORA    L
169C 6F         MOV     L,A
169D 1D         DCR     E       ;COUNT DIGITS
169E C28816     JNZ     HXVFCTL
FLOATHL:
16A1 7C         MOV     A,H     ;CONVERT INTEGER IN HL TO FLOAT                                    ;
16A2 45         MOV     B,L
16A3 €30000     JMP     FLOATAB
HXVFCTCH:                               .
16A6 CDBCO3    CALL   ALPHACHA       ;CONVERT ANY ALPHA TO UPPER
16A9 DO         RNC
16AA D607       SUI     "A-'9-1 ; MOVE ALPHA TO AFTER DIGITS
16AC FE40       CPI     '0+16   ;SET FLAGS CORRECTLY
16AE C9       RET


=== PAGE _095 (PDF page 171) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 93
; CONVERT BYTE TO TWO HEX CHARACTERS                 ;
HEXFCT:
16AF 3602       MVI     A,2     ;ALLOCATE OUTPUT STRING
16B1 C€D1315     CALL    STRNGEN
16B4 3A9603     LDA     FLACCEXP
16B7 CD0000     CALL    FIXAC   :GET INPUT BYTE
16BA 213916     LXI     H, VALRETST
16B8D E5         PUSH    H
16BE 2A6D03     LHLD    STRGTMPA
16C1 CDO0000     CALL    HEXFCTL
HEXFCTL:
16C4 7B         MOV     A,E     ;CONVERT ONE DIGIT
16C5 07         RLC                                                                 :
16C6 07         RLC
16C7 07         RLC
16C8 07         RLC
16C9 5F         MOV     E,A
16CA E60F       ANI     OOFH
16CC FEOA       CPI     10                                                                             :
16CE 3F         CMC                     ;CONVERT TO CHARACTER FORM
16CF CE30       ACI     "o"
16D1 27         DAA
16D2 77         MOV     MA
16D3 23         INX     H
16D4 C9         RET
; TRANSLATE STRING TO UPPER CASE
UPRFCT:
16D5 CDFBOB     CALL    CSTRING
16D8 2A9303     LHLD    ACCUMLTR        ;GET LENGTH OF OPERAND
16DB ES         PUSH    H
16DC 7E         MOV     A.M
16DD CD1315     CALL    STRNGEN ;ALLOCATE OUTPUT STRING
16E0 D1         POP     D
16E1 CDAD11     CALL    STRGRELD        ;RELEASE INPUT STRING
16E4 CD0000     CALL    LDDCBMM
16E7 2A6D03     LHLD    STRGTMPA
16EA 14         INR     D
UPRFCTL:
16EB 15         DCR     D       ; TRANSLATE WHILE COPYING
16EC CA3916     Jz      VALRETST        ; DONE
16EF OA         LDAX    B
16FO CDBC03     CALL    ALPHACHA        ;CONVERT LOWER TO UPPER
16F3 77         MOV     M,A
16F4 03         INX     B
16F5 23         INX     H
16F6 C3IEB16     JMP     UPRFCTL


=== PAGE _096 (PDF page 172) ===
basIC.LST                      S-Sep-78 14:29:54      Page 94
; SUBSTRING FUNCTIONS
’
LFTFCT:
16F9 CD0000     CALL    LEFRIGAR        ;LEFT$ FUNCTION
16FC AF         XRA     A       ;LEFT(X,N)=MID(X,1,N)
LEFRIGMR:
16FD E3         XTHL
16FE 4F         MOV     C,A     ;C=START-1, B=LEN
LEFRIGMD:
16FF ES         PUSH    H       ;RESOLVE DESIRED LEN WITH STRING
1700 7E         MOV     A.M
1701 B8         CMP     B
1702 DAO0000     Jc      LEFRIGMC
1705 78         MOV     A,B
1706 C30000     JMP     LEFRIGMB
LEFRIGAR;
1709 EB         XCHG            ; INITIAL COMMON PROCESSING
170A CD280C     CALL    VALBYTE2        ;FOR LEFT$, RIGHT$
170D 43         MOV     B,E
170E CDA303     CALL    SCANNXTV        ;bscan (val)
1711 29         DB      "y"
1712 C9         RET
LEFRIGMC;
1713 0E00       MVI     c,0
LEFRIGMB:
1716 C5         PUSH    B
1716 CD2115     CALL    STRGALOC        ;ALLOCATE ANSWER STRING
1719 C1         POP     B
171A E1         POP     H                                                                                 ;
171B E5         PUSH    H
171C 23         INX     H
171D 46         MOV     BLM     ;COMPUTE ADDRESSES FOR COPY
171E 23         INX     H
171F 66         MOV     H,M
1720 68         MOV     L,8     + (from HL,MB)
1721 0600       MVI     B,0
1723 09         DAD     B
1724 44         MOV     B,H
1725 4D         MOV     C,L
1726 CD1615     CALL    STRSTCDS
1729 6F         MOV     L.A
172A CD1612     CALL    COPYSTRG        : COPY
172D D1         POP     D
172E CDAD11     CALL    STRGRELD
1731 C37D11     JMP     STRGALOT


=== PAGE _097 (PDF page 173) ===
basIC.LST                      68-Sep-78 14:29:54                                         Page 965
RIGFCT:

1734 CD0917     CALL —_LEFRIGAR        ;RIGHT$ FUNCTION

1737 D1         POP     D

1738 D5         PUSH oD

1739 1A         LOAX 0D

173A 90         SUB     B       ;RIGHT(X,N)*MID(X,LEN(X)-N+1,N)

173B C3FD16     OMP     LEFRIGMR
MIDFCT:

173E EB         XCHG            :MID$ FUNCTION

173F CD280C     CALL — VALBYTE2        ;SCAN STARTING POSITION

1742 43         MOV     B,E

1743 B7         ORA     A       ;NON-ZERO STARTING POSITION?

1744 CA230C     Jz      ERRAFC

1747 C5         PUSH —-B

1748 1EFF       MVI     E,OFFH

174A 7E         MOV     ALM

174B FE29       CPI     myn

174D C4280C     CNZ     VALBYTE2        ;SCAN OPTIONAL THIRD ARGUMENT

1750 CDA303     CALL — SCANNXTV        ;bscan (val)

1753 29         DB      myn

1754 F4         POP     PSW     ;COMPUTE STARTING BYTE AND LENGTH

1755 E3          XTHL

1756 O1FF16     LXI     B, LEFRIGMD

1759 C5         PUSH BB

175A 3D         DCR     A

175B BE         CMP     M

175C 0600       MVI     BO     ;START > LENI => LENO=0

175E DO         RNC

175F 4F         MOV     CA

1760 7E         MOV     A.M

1761 91         suB CC

1762 BB         CMP     E

1763 47         MOV     BA

1764 D8         RC              ;LENO = MIN(LENI-START, LENR)

1765 43         MOV     B,E

1766 C9         RET


=== PAGE _098 (PDF page 174) ===
basIC.LST                      5-Sep-78 14:29:54                                         Page 96
; INDEX OF STRING FUNCTION
INSFCT:
1767 EB         XCHG
1768 CDA303     CALL    SCANNXTV         ;bscan (val)
176B 2C         DB      "i"
176C CDAA10     CALL    VALPARN2        ;SCAN SECOND ARGUMENT
176F £3         XTHL            ;SHUFFLE RETURN STACK
1770 017008     LXI     B, POPHLRET
1773 C5         PUSH    B
1774 E56         PUSH    H
1775 CD1116     CALL    LENFCTC ;PROCESS SECOND STRING
1778 E3         XTHL                 :
1779 FS         PUSH    PSW
177A CA0000     JZ      INSFCTXT
177D CDAC11     CALL    STRGRELH        ;WORK ON FIRST STRING
1780 7E         MOV     A.M
1781 C1         PoP     B
1782 D1         POP     D
1783 90         SUB     B       ;COMPARE LENGTHS                                                       .
1784 DA0000     JC      ZEROAC ;TEST IS LONGER, NO MATCHES
1787 3C         INR     A
1788 4F         MOV     C,A     ;SAVE NUMBER OF ATTEMPTS
1789 C5         PUSH    B
178A CD0000     CALL    LOICBMM ;GET ADDRESS OF TARGET
178D EB         XCHG
178E 5E         MOV     E,M     ;GET ADDRESS OF MATCHER
178F 23         INX     H
1790 56         MOV     D,M
1791 EB         XCHG
1792 Di         POP     D       ;RECOVER LENGTH, COUNTER
1793 3601       MVI     A,1
INSFCTSL:
1795 D5         PUSH    D       ;SAVE LENGTH, COUNTER
1796 FS         PUSH    PSW     ;SAVE POSITION
1797 C5         PUSH    B       ;SAVE ADDRESSES                                                        :
1798 E5         PUSH    H
1799 5A         MOV     E,D
179A CD5510     CALL    RELOPRSL        ;COMPARE STRINGS
179D £1         POP     H       RECOVER ADDRESSES
179E C1         POP     B
INSFCTXT:
179F D1         POP     D
17A0 7A         MOV     A,D     ;RECOVER POSITION
17A1 D1         POP     D       ;AND LENGTH, COUNTER
17A2 CACEOD     Jz      FLOATA ;ANSWER FOUND, GIVE IT BACK
17A5 3C         INR     A       ; INCREMENT POSITION
17A6 03         INX     B
17A7 1D         DCR     E       ;COUNT ATTEMPTS
17A8 C29517     JNZ     INSFCTSL        KEEP TRYING
17AB €30000     JMP     ZEROAC ;O0R NOMATCH


=== PAGE _099 (PDF page 175) ===
basIC.LST            §-Sep-78 14:29:64                       Page 97
; FUNCTION RETURNING AMOUNT OF REMAINING FREE SPACE
FREFCT:
17AE 2A8503     LHLD    MATTABLE        ;FRE FUNCTION
17B1 EB         XCHG
17B2 210000    LXI    H,0
17B5 39         DAD     SP
17B6 CDD903     CALL    TYPECHK
17B9 C20000     JNZ     FREFCTNS
17BC CDA911     CALL    STRGRELA |.     ;RETURN BYTES OF FREE STRNG SPACE
17BF CD4D15     CALL    STRGGBCL
17C2 248903    LHLD   STCKBASE
17C5 EB         XCHG
17C6 2A8B03     LHLD    STRGFREE
FREFCTNS:
17€9 7D         MOV     A,L                               .
17CA 93         SUB     E
17CB 47         MOV     B,A
17€C 7C         MOV     A,H
17CD 9A         SBB     D
FLOATAB:
17CE 50         MOV     D,B
17CF 1£00       MVI     E,000H
17D1 216B03     LXI     H, TYPEFLG
17D4 3604       MVI     M,TYPESING
17D6 0690       MVI     B,O90H
17D8 C30000     JMP     FLOATINT
; MEMORY DIDDLING FACILITIES
MEMFCT:
17DB CDD903     CALL    TYPECHK ;MEM FUNCTION
17DE CA0000     Jz      MEMFCTC
17£1 CD100C     CALL    CINTEGER
17E4 1A         LDAX    D
17E5 C3CE0D     JMP     FLOATA
MEMFCTC:
17£8 CD1116     CALL    LENFCTC ;RELEASE ARGUMENT
17EB 2A8103     LHLD    PROGBASE
17EE CAA116     Jz      FLOATHL ;ZERO LENGTH STRING=PROGBASE
17F1 2A9103     LHLD    STRGTLIM
17F4 C3A116     JMP     FLOATHL ;OTHERWISE=UPPER LIMIT
MEMSTM:
17F7 CDABO3     CALL    SCANNXT ;bscan +        ;MEM STATEMENT
17FA CDAG10     CALL    VALPARNS
17FD CD100C     CALL    CINTEGER
1800 D5         PUSH    D
1801 CDA303     CALL    SCANNXTV        ;bscan (val)
1804 Bd         DB      KEYEQ
1806 CD2coc     CALL    VALBYTE
1808 Di         POP     D
1809 12         STAX    D


=== PAGE _100 (PDF page 176) ===
basIC.LST            S-Sep-78 14:29:54                       Page 98
180A C9         RET


=== PAGE _101 (PDF page 177) ===
basIC.LST                      5-Sep-78 14:29:64                                          Page 99
; DIRECT I/O FACILITIES
PORFCT:
180B CD2FOC     CALL CBYTE PORT FUNCTION
180E 16DB       MVI     D,OPCINP
1810 CD0000     CALL ——INOTGEN
1813 CD9B03     CALL —_INOTINS
1816 C3CEOD     JMP     FLOATA
PORSTM:
1819 CDABO3     CALL — SCANNXT ;bscan +        ;PORT STATEMENT
181C CDA610     CALL VALPARNS)
181F CD2FOC     CALL —‘CBYTE
1822 D5         PUSH =D
1823 CDA303     CALL SCANNXTV        ;bscan (val)
1826 BS         DB      KEYEQ
1827 CD2COCc     CALL VALBYTE
182A Dt         POP     D
182B 16D3       MVI     D, OPCOUT                                                                   ;
182D CD0000     CALL —_-INOTGEN
1830 C39B03     MP     INOTINS
WAISTM:
1833 CD2COC     CALL VALBYTE ;WAIT STATEMENT
1836 D5         PUSH D
1837 CD280C     CALL VALBYTE2
183A F5         PUSH — PSW
183B 1600       MVI     E,0
183D C4280C     CNZ     VALBYTE2
1840 C1         POP     B
1841 4B         MOV     C,E
1842 D1         POP     D
1843 16DB       MVI     D,OPCINP
1845 CD0000     CALL — INOTGEN
WAISTMIN:
1848 CD4A00     CALL SYSWAIT ;D0 A SYSTEM WAIT
184B CD9B03     CALL -INOTINS ;THEN CHECK DEVICE
184E AQ         XRA     c
184F AO         ANA     B
1850 CA4818     JZ      WAISTMIN
1853 C9         RET
INOTGEN:
1854 E5         PUSH =H       ;GENERATE INPUT/OUTPUT FOLLOWED
1855 219803     LXI     H, INOTINS       ;BY RETURN
1858 72         MOV     MD
1859 23         INX     H
185A 73         MOV     M,E
185B 23         INX     H
185C 36C9       MVI     M, OPCRET
185E E1         POP     H
185F C9         RET


=== PAGE _102 (PDF page 178) ===
basIC.LST                      5-Sep-78 14:29:64       Page 100
; CSAVE/CLOAD PROCESSORS
:    save filename - save on diskette
:    load filename - get from diskette
; load and save programs from the disk
1860 B400 di4base     equ     0b400h
1860 B000 §=fsprom      equ     0b000h
1860 B39B   bootstart   equ     fsprom+39bh     ;load image files
1860 B8EQ directorylookup     equ     di4base+4e0h    :find filename
1860 B796 opens               equ     di4base+396h    ;open stream
1860 B7DC   puts                equ     d14base+d3dch    ;put char
1860 882D closes              equ     d1i4base+42dh    ;close stream
cldstm:
1860 CD0000     call    setfilename     ;parse filename —
1863 CDEOBB     call    directorylookup
1866 020000     jne     namenotfound
1869 CD9BB3     call    bootstart
186C CpO000     call    checkprogram
186F CDFFO4     call    newload         ;reset program pointers
1872 €31906     jmp     cmndstrt
namenotfound:
1875 1£E1       nvi     e,errnfi-errn   ifile not saved
1877 C3F105     jmp     errmsg
csvstm:
187A CD0000     call    setfilename
187D 0602       mvi     b,2             iwrite enable
187F CD96B7     call    opens           ;open stream (only one in 014)                                  ;
1882 D20000     jnc     cannotopen      ; ~disk full or other bad stuff
1885 CD0000     call    checkprogram
1888 E5         push    h                ;Save end pointer
1889 2A8103     Thid    progbase                 ifirst address
188C 4D         mov     c,]
188D CODCB7     call    puts
1890 4C         mov     c,h
1891 CDDCB7     call    puts
1894 OE00       nvi     c,0             ;Start address = 0 for no start
1896 CDDCB7     call    puts
1899 CDDCB7     call    puts
189C D1         pop     d                :de has end addresst+1i
saveloop:
189D 4E         mov     c,m             ;get char
189E 23         inx     h
189F CDDCB7     call    puts            ;and send to file
18A2 7C         mov     a,h             ;is this the end?
18A3 BA         cmp     d
18A4 C29D18     jnz     saveloop
18A7 7D         mov     a,]
18A8 BB         cmp     e
18A9 C29D18     jnz     saveloop
18AC CD2DB8     call    closes          yes


=== PAGE _103 (PDF page 179) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 101
18AF C31906     jmp     cmndstrt
cannotopen:
18B2 1£09       mvi     e,errnsi-errn
18B4 C3F105     jmp     errmsg
; setfilename
;    returns hl set to a filename string
setfilename:
18B7 110000     1x7     d,filename+1
18BA 0600       mvi     b,0
sfnioop:
18BC 7E         mov     a,m             s;look at char
18BD FE00       cpi     0
18BF CA0000     jz      sfndone                                                      ;       .
18C2 FE20       cpi     ""
18C4 CA0000     iz      sfndone
18C7 04         inr     b               sup count
18C8 23         inx     h
18C9 12         stax    d
18CA 13         inx     d                                                                              .
18CB C38C18     jmp     sfnloop
sfndone:
18CE 210000     xi     h, filename
18D1 AF         xra     a               ;is the name non zero
18D2 BO         ora     b
18D3 CAEFOS     jz      errasn          iyes
18D6 77         mov     mia             ;store count
18D7 C9         ret
;  checkprogram
;    walk over the program looking for the end                                            :
:    return last byte+1 in h}
checkprogram;
18D8 2A8103     Thid    progbase        ;Starts here                                                   ;
cprogloop:
18DB 7E         mov     a,m             ;pick up Tine length
18DC 23         inx     h
18DD B6         ora     m
18DE 23         inx     h
18DF CA0000     jz      cprogok         ;if zero then allt done
18E2 23         inx     h
18E3 23         inx     h               ;skip line number
cprogloope:
18E4 7E         mov     a,m
18E5 B7         ora     a
18E6 23         inx     h
18E7 CADB18     jz      cprogloop       ;zero at the end of the line
18EA C3E418     jmp     cprogloop2
cprogok:
18ED C9         ret
1929 00     filename:   ds      60


=== PAGE _104 (PDF page 180) ===
basIC.LST                      5-Sep-78 14:39:48                                          Page 102
; LOGICAL OPERATORS
ORNOPR;:
192A B7         ORA     A       ;OR OPERATOR
192B €30000     JUMP     LOGOPRIC
ANDOPR:
192E AF         XRA     A       ;AND OPERATOR
LOGOPRIC:
192F FS         PUSH    PSW       .
1930 CDF40B     CALL    CSINGLE
1933 CD100C     CALL    CINTEGER
1936 Fi         POP     PSW
1937 EB         XCHG
1938 Ci         POP     B
1939 E3          XTHL                                         :
193A EB         XCHG
193B CDO000     CALL    LDACRG
193E FS         PUSH    PSW
193F CD100C     CALL    CINTEGER
1942 Fi         POP     PSW
1943 Ci         POP     B
1944 79         MOV     A,C
1945 €20000     JNZ     ORNOPRFN
1948 A3         ANA     E
1949 4F         MOV     C,A
194A 78         MOV     A,B
194B A2         ANA     D
194C €C30000     JMP     LOGOPRXT        ;RETURN FROM AND
ORNOPRFN:                                                                                     :
194F B3         ORA     E
1950 4F         MOV     C,A
1951 78         MOV     A,B
1952 B2         ORA     D
LOGOPRXT:
1963 41         MOV     B,C
1954 C3CE17     JMP     FLOATAB ;RETURN FROM OR
VALUNOT:
1957 165A       MVI     D, PREDNOT       ;EVALUATE UNARY NOT
1959 CD960F     CALL    VALEXPRL
195C CDF40B     CALL    CSINGLE
195F CD100C     CALL    CINTEGER
1962 7B         MOV     A,E
1963 2F         CMA
1964 4F         MOV     C,A
1965 7A         MOV     A,D
1966 2F         CMA
1967 CD5319     CALL    LOGOPRXT
196A C1         POP     B
196B C3A20F     JMP     VALEXPRC


=== PAGE _105 (PDF page 181) ===
basIC.LST                      5~Sep-78 14:39:48                                         Page 103
; MOD, MAXIMUM, MINIMUM OPERATORS
MODOPR:

196E C1         POP     8       ;MODULO FUNCTION

196F D1         POP     D       iX MOD Y =

1970 D5         PUSH    D       iX - INT(X/Y) * Y¥

1971 C5         PUSH    B

1972 2A9303     LHLD    ACCUMLTR

1975 ES         PUSH    H

1976 2A9503     LHLD    FLACCMSB

1979 £5         PUSH    H

197A CD0000     CALL    FLDIV

197D cDo0000     CALL    INTFCT

1980 C1         POP     B

1981 D1         POP     D

1982 CD0000     CALL    FLMUL

1985 C30000     JMP     SUBOPR
MAXOPR:

1988 C1         POP     B

1989 D1         POP     D

198A CD0000     CALL    FLCMP ;COMPARE OPERANDS

198D C8         RZ              iNO DIFFERENCE

198E DAO0CO     Jc      LDACRG ;REGISTERS LARGER

1991 C30000     JMP     LDRGAC ;ACCUMULATOR LARGER
MINOPR:

1994 Ci         POP     B

1995 D1         POP     D

1996 CDO0000     CALL    FLCMP   ;COMPARE OPERANDS

1999 C8         RZ              NO DIFFERENCE          ;

199A D20000     JNC     LDACRG ;REGISTERS SMALLER

199D €30000     JMP     LDRGAC ;ACCUMULATOR SMALLER


=== PAGE _106 (PDF page 182) ===
basI¢.LST                      5-Sep~78 14:39:48                                         Page 104
; FLOATING POINT ADD/SUBTRACT ROUTINES
FLADDHLF:
19A0 210000     LXI     H, FLHALF
FLADOM:
19A3 CDO0000     CALL    LDRGMM
19A6 €30000     JMP     FLADD
FLMMMAC :
19A9 CD0000     CALL    LDRGMM ;COMPUTE MM~AC
19AC C30000     JMP     FLSUB
SUBOPR:
19AF C1         POP     B
19B0 D1         POP     D
FLSUB:
19B1 CD0000     CALL    CMACCS ;SUBTRACT ACC FROM REGISTERS
FLADD:
19B4 78         MOV     A,B     ;ADD ACCUMULATOR TO REGISTERS                                          .
19B5 B7         ORA     A
19B6 C8         RZ
19B7 3A9603     LDA     FLACCEXP
19BA B7         ORA     A
19BB CA0000     Jz      LDACRG
19BE 90         SUB     B
19BF D20000     JNC     FLADOMGC
19C2 2F         CMA                     ;NEEOD LARGER IN AC, INTERCHANGE
19C3 3C         INR     A
19C4 EB         XCHG
19C5 CD0000     CALL    PUSHAC
19C8 EB         XCHG
19C9 CD0000     CALL    LDACRG
19CC C1         POP     B
19CD D1         POP     D
FLADDMGC :
19CE FE19       CPI     019H    ;ARE MAGNITUDES ARE COMMENSURATE?
19D0 DO         RNC
19D1 F5         PUSH    PSW
19D2 CD0000     CALL    SIGNIFY
19D5 67         MOV     H,A
19D6 Fi         POP     PSW
19D7 CD0000     CALL    SHIFTRO
19DA B4         ORA     H                                       .
190B 219303     LXI     H,ACCUMLTR
19DE F20000     JP      FLADDIFF
19E£1 CDO000     CALL    ADDM2CDE
19E4 D20000     JNC     FLROUND
19E7 23         INX     H
19E8 34         INR     M
19E9 CA0000     JZ      ERRAOV
19EC 2E01       MVI     L,001H
19EE CDO000     CALL    SHIFTRLB
19F1 €30000     JMP     FLROUND


=== PAGE _107 (PDF page 183) ===
basIC.LST                       5-Sep-78 14:39:48                                            Page 105
FLADDIFF:
19F4 AF         XRA     A       ;FIND DIFFERENCE
19F5 90         SUB     B
igF6 47         MOV     B,A
19F7 7E         MOV     AM
19F8 9B         SBB     E
19F9 5F         MOV     E,A
19FA 23         INX     H
19FB 7E         MOV     A.M
19FC 9A         SBB     1)
19FD 57         MOV     DLA       .
19FE 23         INX     H
19FF 7E    ;    MOV     A,M
1A00 99         SBB     C
1A01 4F         MOV     C,A
NORMALZI:
1A02 DCOOON     cc      CMREGS                             ,
NORMALIZ:
1A05 68         MOV     L,B     ;NORMALIZE REGISTERS
1A06 63         MOV     H,E
1A07 AF         XRA     A
NORMAL8:
1A08 47         MOV     B,A     ;NORMALIZE BY BYTES
1A09 79         MOV     A,C
1AQA B7         ORA     A
1A0B C20000     JNZ     NORMAL1
1A0E 4A         MOV     C,D
1A0F 54         MOV     D,H
1A10 65         MOV     H,L
1A11 6F         MOV     L,A
1A12 78         MOV     A,B
1A13 D608       SUI     008H                                                                              :
1A15 FEEO       CPI     OEOH
1A17 C2081A     JNZ     NORMAL8
ZEROAC:
1A1A AF         XRA     A       ;ZERO ACCUMULATOR
LDACCE:
1A1B 329603     STA     FLACCEXP
TA1E C9         RET
NORMAL1L:
1A1F 05         DCR     B       ;NORMALIZE BY BITS
1A20 29         DAD     H
1A21 7A         MOV     A,D
1A22 17         RAL
1A23 57         MOV     D,A
1A24 79         MOV     A,C
1A25 8F         ADC     A
1A26 4F         MOV     CA
NORMAL1:
1A27 F21F1iA     JP      NORMAL1L
1A2A 78         MOV     A,B         :
1A2B 5C         MOV     E,H
1A2C 45         MOV     B,L
1A2D B7         ORA     A


=== PAGE _108 (PDF page 184) ===
basIC.LST                      §-Sep-78 14:39:48                                          Page 106
1A2E CA0000     Jz      FLROUND
1A31 219603     LXI     H, FLACCEXP
1A34 86         ADD     M
1A35 77         MOV     MA
1A36 D21A1A     JNC     ZEROAC
1A39 C8         RZ
FLROUND:                                                                ;
1A3A 78         MOV     A,B     ;ROUND RESULT
FLROUNDV:
1A3B 219603     LXI     H, FLACCEXP
1A3E B7         ORA     A
1A3F FCO000     cM      INCCDE
1A42 46         MOV     B,M
1A43 23         INX     H
1A44 7E         MOV     A.M
1A45 E680       ANI     080H
1A47 AQ         XRA     C
1A48 4F         MOV     C.A
1A49 C30000     JMP     LDACRG
INCCDE:
1A4C 1C         INR     E       INCREMENT CDE
1A4D CO         RNZ
1A4E 14         INR     0
1A4F CO         RNZ
1A50 0C         INR     Cc
1A51 CO         RNZ
1A52 0E80       MVI     C,080H
1A54 34         INR     M
1A55 CO         RNZ
ERRAOV:
1A56 1E6D       MVI     E,ERRNOV-ERRN
1A58 C3F105     JMP     ERRMSG
ADDM2CDE:
1A5B 7E         MOV     A,M     ;ADD MEMORY TO CDE
1A5C 83         ADD     E
1A5D 5F         MOV     E,A
1A5E 23         INX     H
1A5F 7E         MOV     A,M
1A60 8A         ADC     D
1A61 57         MOV     D,A
1A62 23         INX     H
1A63 7E         MOV     A,M
1A64 89         ADC     Cc
1A65 4F         MOV     C,A                                                                                  :
1A66 C9         RET


=== PAGE _109 (PDF page 185) ===
basIC.LST                       5-Sep-78 14:39:48                                            Page 107
CMREGS:
1A67 219703     LXI     H, FLACCSSV      ;COMPLEMENT SAVED SIGN, CDEB
1AGA 7E         MOV     A,M
1AGB 2F         CMA
1A6C 77         MOV     MA
1A6D AF         XRA     A
1A6E 6F         MOV     L,A
1AGF 90         SUB     B
1A70 47         MOV     B,A
4A71 70D         MOV     A,L
1A72 9B         SBB     E
1A73 SF         MOV     E,A
1A74 7D         MOV     A,L
1A75 9A         SBB     D
1A76 57         MOV     D,A                                                         :
1A77 70         MOV     AL
1A78 99         SBB     Cc
1A79 4F         MOV     C,A
1A7A C9         RET
SHIFTRO:                                                                                   :
1A7B 0600       MVI     B,Q00H
SHIFTR:
1A7D D608       SUI     008H    ;SHIFT CDEB RIGHT BY A BITS
1A7F DA0000     Jc      SHIFTRB
1A82 43         MOV     B,E
1A83 5A         MOV     E,D
1A84 51         MOV     D.C
1A85 OE00       MVI     C,000H
1A87 C37D1A     JMP     SHIFTR
SHIFTRB:
1A8A C609       ADI     009H
1A8C 6F         MOV     L,A
SHIFTRBL:
1A8D AF         XRA     A
1A8E 20         DCR     L
1A8F C8          RZ                                                                                          :
1A90 79         MOV     A,C
SHIFTRLB:
1A91 1F         RAR
1A92 4F         MOV     C,A
1A93 7A         MOV     A,D
1A94 -1F         RAR
1A95 57         MOV     DA
1A96 7B         MOV     A,E                                    .
1A97 1F         RAR
1A98 SF         MOV     E,A
1A99 78         MOV     A,B
1A9A 1F         RAR
1A9B 47         MOV     B,A
1A9C C38D1A     JMP     SHIFTRBL


=== PAGE _110 (PDF page 186) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 108
; FLOATING POINT MULTIPLY ROUTINE
MULOPR:
AQF C1         POP     B
1AA0 D1         POP     D
FLMUL:
1AA1 CD0000     CALL    SIGNACC ;MULTIPLY REGISTERS BY ACC
1AA4 C8         RZ
1AA5 2E00       MVI     L,000H    .
1AA7 CDO0000     CALL    FLMLDVEX
1AAA 79         MOV     A,C
1AAB 329B03     STA     FLSCRO
1AAE EB         XCHG
1AAF 229C03     SHLD    FLSCR1
1AB2 010000     LXI     B.0                                :
1AB5 50         MOV     D,B
1AB6 59         MOV     E,C
1AB7 21051A     LXI     H, NORMALIZ      ;NORMALIZE ANSWER AFTER
TABA E5         PUSH    H
1ABB 210000     LXI     H, FLMULLP       ; THREE TIMES THROUGH LOOP
1ABE E5&         PUSH    H
1ABF ES         PUSH    H
1ACO 219303     LXI     H, ACCUMLTR
FLMULLP:
1AC3 7E         MOV     A.M
1AC4 23         INX     H
1AC5 B7         ORA     A
1AC6 CA0000     Jz      FLMULXT
1AC9 E5         PUSH    H
1ACA 2E08       MVI     L,008H                                                                            :
FLMULLQ:
1ACC iF         RAR             ;NEXT BIT OF MULTIPLIER
1ACD 67         MOV     H,A
1ACE 79         MOV     A,C
1ACF D20000     JNC     FLMULNA
1AD2 E56         PUSH    H
1AD3 2A9C03     LHLD    FLSCR1 = ;BIT ON, ADD MULTIPLICAND
1AD6 19         DAD     D
1AD7 EB         XCHG
1AD8 E1         POP     H
1AD9 3A9B03     LDA     FLSCRO
1ADC 89         ADC     Cc
FLMULNA:
1ADD 1F         RAR             ;SHIFT CDEB RIGHT ONE BIT
1ADE 4F         MOV     C,A
1ADF 7A         MOV     A,D
1AE0 1F         RAR
1AE1 57         MOV     D,A
1AE2 7B         MOV     A,E
1AE3 1F         RAR
1AE4 SF         MOV     E,A
1AE5 78         MOV     A,B
1AE6 1F         RAR


=== PAGE _111 (PDF page 187) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 109
1AE7 47         MOV     B,A
1AE8 2D         DCR     L
1AE9 7C         MOV     A,H
1AEA C2CC1A     JNZ     FLMULLQ
1AED Ei         POP     i
1AEE C9         RET
FLMULXT:
1AEF 43         MOV     B,E
1AFO 5A         MOV     E,0
1AF1i 51         MOV     DC
1AF2 4F         MOV     C,A
1AF3 C9         RET
FLMLDVEX:
1AF4 78         MOV     A,B     ;COMPUTE EXP FOR MULTIPLY/DIVIDE
1AF5 B7         ORA     A
1AF6 CA0000     JZ      FLMLDVEZ
1AF9 7D         MOV     A,L
1AFA 219603     LXI     H, FLACCEXP
1AFD AE         XRA     M
1AFE 80         ADD     B
1AFF 47         MOV     B,A
1B00 1F         RAR
1B01 A8         XRA     B
1B02 78         MOV     A,B
1B03 F20000     JP      FLMLDVEY
1B06 C680       ADI     080H
1B08 77         MOV     M,A
1B09 CA7008     JZ      POPHLRET                  ;                                                 ;
1B0C CD0000     CALL    SIGNIFY
1BOF 77         MOV     M,A
1B10 2B         DCX     H
1B11 C9         RET                                      .
EXPRNEXC:
1812 CDO0000     CALL    SIGNACC ;RANGE EXECEEDED FOR EXP FUNCTION
1B165 2F         CMA                     ;RESULT DETERMINED BY SGN(X)
1B16 E1         POP     H
FLMLDVEY:
1B17 B7         ORA     A
FLMLDVEZ:
1B18 £1         POP     H
1B19 F21A1A     JP      ZEROAC
1B1C C3561A     JMP     ERRAOV


=== PAGE _112 (PDF page 188) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 110
; FLOATING POINT DIVIDE ROUTINE
FLDIVB10:
1B1F CD0000     CALL    PUSHAC = ;COMPUTE AC/10
1822 012084     LXI     B,08420H
1B25 110000     LXI     D,00000H
1B28 CDO000     CALL    LDACRG
DIVOPR:
1B2B C1         POP     B
1B2C D1         POP     D
FLDIV:
1B2D CD0000     CALL    SIGNACC ;DIVIDE REGISTERS BY ACCUMULATOR
1B30 CA0000     JZ      ERRADO                                                      :
1B33 2EFF       MVI     L,OFFH
1B35 CDF41A     CALL    FLMLDVEX
1838 34         INR     M
1B39 34         INR     M       splus 2
183A 2B         DCX     H
1B3B 7E         MOV     A.M                                                                            .
1B3C 2F         CMA
1B3D 329D03     STA     FLSCR2
1B40 2B         DCX     H
1B41 7E         MOV     A.M
1B42 2F         CMA
1B43 329C03     STA     FLSCR1
1B46 2B         DCX     H
1B47 7E         MOV     A.M
1B48 2F         CMA
1B49 329B03     STA     FLSCRO
1B4C 41         MOV     B,C
1B4D EB         XCHG
1B4E AF         XRA     A
1B4F 4F         MOV     C,A
1850 57         MOV     D,A
1B51 SF         MOV     E,A
1B52 329E03     STA     FLSCR3
FLDIVLP;
1B55 E56         PUSH    H
1B56 C5         PUSH    B
1B57 37         STC
1B58 3A9B03     LDA     FLSCRO
1B5B 8D         ADC     L
1B5C 6F         MOV     L,A                                     .
1B5D 3A9C03     LDA     FLSCR1
1B60 8C         ADC     H
1B61 67         MOV     H,A
1B62 3A9D03     LDA     FLSCR2
1B65 88         ADC     B
1B66 47         MOV     B,A
1B67 3A9E03     LDA     FLSCR3
1B6A CEFF       ACI     OFFH
1B6C D20000     JNC     FLDIVSF
1B6F 329E03     STA     FLSCR3


=== PAGE _113 (PDF page 189) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 111
1B72 Fl         POP     PSW     i; TRIAL SUBTRACT SUCCEEDED,
1B73 F1         POP     PSW     ; THROW AWAY SAVED DIVIDEND
1B74 37         STC
1B75 C30000     JMP     FLDIVSS
FLDIVSF:
1B78 C1         POP     B       ;TRIAL SUBTRACT FAILED, RESTORE
1B79 E14         POP     H
FLDIVSS:
1B7A 79         MOV     A,C
1B7B 3C         INR     A
1B7C 3D         DCR     A
1B7D 1F         RAR               .
1B7E FA3B1A     JM      FLROUNDV
1B81 17         RAL
1B82 7B         MOV     ALE
1B83 17         RAL
1B84 5F         MOV     E,A
1B85 7A         MOV     A.D                               :
1B86 17         RAL
1B87 57         MOV     D,A
1B88 79         MOV     A,C
1889 17         RAL
1B8A 4F         MOV     C,A
1B8B 29         DAD     H
1B8C 78         MOV     A,B
1B8D 17         RAL
1B8E 47         MOV     B,A
1B8F 3A9E03     LDA     FLSCR3
1B92 17         RAL
1B93 329E03     STA     FLSCR3
1B96 79         MOV     A,C
1B97 B2         ORA     D
1B98 B3         ORA     E                                                                                 :
1899 C2551B     JNZ     FLDIVLP
1B9C E5         PUSH    H
1B9D 219603     LXI     H, FLACCEXP
1BA0 35         DCR     M
1BA1 E1         POP     H
1BA2 C2551B     JNZ     FLDIVLP
1BA5 C3561A     JMP     ERRAOV
ERRADO:
1BA8 1£21       MVI     E,ERRNDO-ERRN
1BAA C3F105     JMP     ERRMSG


=== PAGE _114 (PDF page 190) ===
basIC.LST                      55-Sep-78 14:39:48                                          Page 112
; MISCELLANEOUS AUXILIARY ROUTINES
; COPY ACCUMULATOR TO STACK
PUSHAC:
1BAD EB         XCHG            ;PUSH ACCUMULATOR ONTO STACK
PUSHAC1:
1BAE 2A9303     LHLD    ACCUMLTR
1BB1 £3         XTHL
1BB2 £5         PUSH    H
1BB83 2A9503     LHLD    FLACCMSB
1BB6 E3         XTHL
1BB7 E5         PUSH    H
1BB8 EB         XCHG
1BB9 C9         RET
; LOAD ACCUMULATOR
LDRGACMM:
1BBA CD0000     CALL    LDRGMM ;LOAD FLOATING ACC AND REGISTERS
LDACRG:
1BBD EB         XCHG            ;LOAD ACCUMULATOR FROM REGISTERS
IBBE 229303     SHLD    ACCUMLTR
1BC1 60         MOV     H,B
1BC2 69         MOV     L,C¢                       ;                                                 .
1BC3 229503     SHLD    FLACCMSB
1BC6 EB         XCHG
1BC7 C9         RET
; LOAD REGISTERS
LORGAC:
1BC8& 219303     LXI     H,ACCUMLTR      ;LOAD REGISTERS FROM ACCUMULATOR
LORGMM:
1BCB 5E         MOV     E,M     ;LOAD REGISTERS FROM FLOAT NUMBER
1BCC 23         INX     H
LODCBMM:
1BCD 56         MOV     DM     ;LOAD REGISTERS FROM STRING
LDICBMM:
1BCE 23         INX     H
1BCF 4£         MOV     c,M
1BD0 23         INX     H
1BD1 46         MOV     B,M
INCHLRET:
1BD2 23         INX     H             i.
1BD3 C9         RET


=== PAGE _115 (PDF page 191) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 113
; STORE ACCUMULATOR / COPY A VALUE
LDMMAC ;

1BD4 119303     LXI     D,ACCUMLTR      ;LOAD MEMORY FROM ACCUMULATOR
COPYVAL:

1BD7 3A6B03     LDA     TYPEFLG ;COPY VALUE FROM (DE) TO (HL)

1BDA 47         MOV     B,A
COPYVALL:

1BDB 1A         LDAX    D

1BDC 77         MOV     M,A

1BDD 13         INX     D

1BDE 23         INX     H

1BDF 05         DCR     B

1BEQ C2DB1B     JNZ     COPYVALL

1BE3 C9         RET
; TURN ON HIGH ORDER MANTISSA BITS OF ACCUMULATOR/REGISTERS
SIGNIFY:                                                                                        .

1BE4 219503     LXI     H, FLACCMSB      ;SET ON HIGH-ORDER MANTISSA BITS,

1BE7 7E         MOV     A,M     ;AND SAVE SIGN IN FLACCSSV

1BE8 07         RLC

1BE9 37         STC

1BEA 1F         RAR

1BEB 77         MOV     MA     ;FIRST ACCUMULATOR,

1BEC 3F         cmc

1BED 1F         RAR

1BEE 23         INX     H

1BEF 23         INX     H

1BFO 77         MOV     M,A

1BF1 79         MOV     A,C

1BF2 07         RLC

1BF3 37         STC

1BF4 1F         RAR

1BF5 4F         MOV     C,A     ; THEN REGISTERS                                                        ;

1BF6 1F         RAR

1BF7 AE         XRA     M

1BF8 C9         RET


=== PAGE _116 (PDF page 192) ===
basIC.LST                §-Sep-78 14:39:48                              Page 114
; FLOATING POINT COMPARISON: REGISTERS VS ACCUMULATOR
FLCMP:

iBF9 78         MOV     A,B     ;FLOATING COMPARE REGS TO ACC

1BFA B7         ORA     A

1BFB CA0000     JZ      SIGNACC

1BFE 210000     LXI     H, FLCMPXT

1€01 E65         PUSH    H

1c02 ¢Cp0000     CALL    SIGNACC

1C05 79         MOV     A,C       .

1006 C8        RZ

1C07 219503     LXI     H, FLACCMSB

1COA AE         XRA     M

1COB 79         MOV     A,C

1C0C F8         RM

1cC0D cb0000     CALL    FLCMPM

1010 1F         RAR

1€11 AQ         XRA     c

1€12 C9         RET
FLCMPM:

1€13 23         INX     H       ;COMPARE MANTISSAS

1014 78         MOV     A,B

1C15 BE         CMP     M

1cC16 CO         RNZ

1C17 2B         DCX     H

1€18 79         MOV     A,C

1€19 BE         CMP     M

1C1A CO         RNZ

1C1B 28         DCX     H

1C1C 7A         MOV     A,D                                                                               ;

1C1D BE         CMP     M

1C1E CO         RNZ

1C1F 28         DCX     H

1020 7B         MOV     A,E

1C21 96         SUB     M

1€22 Co         RNZ

1€23 E1         POP     H

1024 E1         POP     H

1€25 C9         RET


=== PAGE _117 (PDF page 193) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 115
; COMPUTE INTEGER PART OF ACCUMULATOR
FIXAC:
1C26 47         MOV     BA     ;LOAD REGS WITH FIX(AC)
1027 4F         MOV     C\A
1028 57         MOV     DA
1€29 5F         MOV     E,A
1C2A B7         ORA     A
1C2B C8         RZ
1C2C ES         PUSH =H
1C2D CDC81B     CALL —_LDRGAC
1€30 CDE41B     CALL SIGNIFY
1C33 AE         XRA     M
1€34 67         MOV     HA
1€35 FC0000     cM      DECCDE
1C38 3E98       MVI     A,098H
1C3A 90         SUB     B
1C3B CD7B1A     CALL — SHIFTRO
1C3E 7C         MOV     A,H
1C3F 17         RAL
1C40 DC4C1A     cc      INCCDE
1C43 0600       MVI     B,000H
1C45 DC671A     cc      CMREGS
1C48 E1         POP     H
1¢49 C9         RET
DECCDE:
1C4A 1B         DCX     D       ;DECREMENT CDE
1C4B 7A         MOV     A,D
1C4C A3         ANA     E
1C4D 3C         INR =A
1C4E CO         RNZ
1C4F OD         DCR     c
1€50 C9         RET
FLMULB10:
1€51 CDC81B     CALL LDRGAC ;MULTIPLY CONTENTS OF AC BY 10
1€54 78         MOV     A,B                                                .
1C55 B7         ORA     A
1€56 C8         RZ
1C57 C602       ADI     002H
1C59 DAS61A     JC      ERRAOV
1C5C 47         MoV     B.A
1C5D CDB419     CALL  FLADD ;AC=AC+4*AC
1€60 219603     LXI     H, FLACCEXP
1C63 34         INR     M       ;AC=2*AC
1€64 CO         RNZ
1C65 C3561A     JMP     ERRAOV
SIGNACC:
1C68 3A9603     LDA     FLACCEXP        ;FIND SIGN OF ACCUMULATOR
1C6B B7         ORA     A
1C6C CB         RZ
1C6D 3A9503     LDA     FLACCMSB


=== PAGE _118 (PDF page 194) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 116
1€70 C30000     JMP     SIGNXTND
FLCMPXT:
1C73 2F         CMA
SIGNXTND:
1074 17         RAL
CMPXT:
1C75 9F         SBB     A
1C76 CO         RNZ
1€77 3C         INR     A
1078 C9         RET
CMANSWR:
1€79 210000     LXI     H,CMACCS        3F(X)=-F(0)
ic7C E3         XTHL
1C7D E9         PCHL
SGNFCT:
1C7E CD681C     CALL  SIGNACC
FLOATBYT:
1C81 0688       MVI     B,088H
1C83 110000     LXI     D,0
FLOATINT:
1C86 219603     LXI     H, FLACCEXP      ;CONVERT INTEGER IN ADE TO FLOAT,
1C89 4F         MOV     C.A
1C8A 70         MOV     M,B     ;EXPONENT ASSUMED IN B
1C8B 0600       MVI     B, 000H
1C8D 23         INX     H
1C8E 3680       MVI     M,080H
1¢90 17         RAL
1€91 C3021A     JMP     NORMALZI
; COMPUTE ABSOLUTE VALUE OF ACCUMULATOR
ABSFCT:
1€94 CD681C     CALL  SIGNACC ;ABS FUNCTION
1€97 FO         RP
CMACCS:
4€98 219503     LXI     H, FLACCMSB      ;CHANGE SIGN OF ACCUMULATOR
1C9B 7E         MOV     A.M
1C9C EE80       XRI     080H
1C9E 77            MOV       M,A
1C9F C9         RET
INTFCT:
1CAOQ 219603     LXI     H, FLACCEXP      ;INT FUNCTION
1CA3 7E         MOV     A.M
1CA4 FEQS       CPI     098H
1CA6 3A9303     LDA     ACCUMLTR
1CA9 DO         RNC
1CAA 7E         MOV     A.M
1CAB CD261C     CALL — FIXAC
1CAE 3698       MVI     M, 098H
1CB0 7B         MOV     A,E
1CB1 FS         PUSH —- PSW
1CB2 79         MOV     A,C


=== PAGE _119 (PDF page 195) ===
basIC.LST                5-Sep-78 14:39:48                              Page 117
1CB3 17       RAL

1CB4 CDO21A     CALL    NORMALZI

1CB7 Fi       POP    PSW

1CB8 C9        RET


=== PAGE _120 (PDF page 196) ===
basIC.LST                      §-Sep-78 14:39:48                                         Page 118
; FLOATING POINT DECODE ROUTINE
DECODE:
1CB9 FE2D       CPI     nan     ;DECODE EXTERNAL FORM OF NUMBER                 :
1CBB FS         PUSH    PSW
1cBc CA0000     JZ      DECODEIN
1CBF FE2B       CPI     "4"
1€C1 CA0000     Jz      DECODEIN
1CC4 2B         DCX     H
DECODEIN:
1CC5 CD1A1A     CALL    ZEROAC
1€C8 47         MOV     B.A
1cc9 57         MOV     O,A
1CCA 5F         MOV     E,A
1CCB 2F         CMA
1CCC 4F         MOV     C,A
DECODELP:
1CCD CDABO3     CALL    SCANNXT ;bscan ,
1CDO0 DA0O00     Jc      DECDIGIT
1CD3 FE2E       CPI     "vn
1CD5 CA0000     JZ      DECODEPT
1CD8 FE45       CPI     "Ee"     ;UPPER CASE E
1CDA CA0000     JZ      DECODEXP
1CDD FE65       CPI     "e"     ;LOWER CASE E
1CDF €20000     INZ     DECODVAL
DECODEXP:
1CE2 CDABO3     CALL    SCANNXT ;bscan ,          ,                                                 ;
1CE5 £5         PUSH    H
1CE6 210000     LXI     H, DECODEXL
1CE9 E3         XTHL
1CEA 15         DCR     D                                .
1CEB FEAB       CPI     KEYSUB
1CED C8         RZ
1CEE FE2D       CPI     —"
1CFO C8         RZ
1CF1 14         INR     D
1CF2 FE2B       CPI     m+n
1CF4 C8         RZ
1CF5 FEAA       CPI     KEYADD
1CF7 C8         RZ
1CF8 Fi         POP     PSW
1CF9 2B         DCX     H
DECODEXL:                                                                                    :
1CFA CDABO3     CALL    SCANNXT ;bscan ,        ;SCAN EXPONENT
1CFD D20000     JNC     DECODEXQ
1D00 7B         MOV     AE     ;DECODE EXPONENT DIGIT
1D01 07         RLC             ;E=10*E+VAL(M)
1D02 07         RLC                   .
1D03 83         ADD     E
1D04 07         RLC
1D05 86         ADD     M
1D06 D630       SUI     "or"
1D08 5F         MOV     E,A


=== PAGE _121 (PDF page 197) ===
basIc.LsT                      56-Sep-78 14:39:48                                         Page 119
1009 C3FA1C     JMP     DECODEXL
DECODEXQ:
ipoc 14         INR     D
1D0D C20000     JNZ     DECODVAL
1D10 AF         XRA     A
1D11 93         SUB     E
1D12 5F         MOV     E,A
1D13 0C         INR     Cc
DECODEPT:
1D14 0C         INR     Cc       ;DECODE DECIMAL POINT
1D16 CACD1IC     Jz      DECODELP
DECODVAL:
1018 ES         PUSH    H
1D19 7B         MOV     A,E
1D1A 90         SUB     B
DECDEXPA:
1D1B F40000     cP      DECMULUP        ;COMBINE MANTISSA, EXPONENT
1D1E F20000     JP      DECDEXAL
1D21 F5         PUSH    PSW
1D22 CD1F1B     CALL    FLDIVB10
1025 Fi         POP     PSW
1D26 3C         INR     A                                                                              .
DECDEXAL:
1D27 C21B1D     JNZ     DECDEXPA
1D2A D1         POP     D
1D2B Fi         POP     PSW
1D2C CC981iC     CZ      CMACCS
1D2F EB         XCHG
1D30 C9         RET


=== PAGE _122 (PDF page 198) ===
basIC. LST                5-Sep-78 14:39:48                              Page 120
DECMULUP;:

1031 C8         RZ
FLMLB10C:

1032 F&       PUSH   PSW

1D33 CD511C     CALL    FLMULB10

1036 Fi         POP     PSW

1D37 3D         DCR     A

1038 C9        RET                                  .
DECDIGIT:

1039 D5         PUSH    D       ;DECODE DIGIT OF NUMBER

1D3A 57         MOV     D,A

1D3B 78         MOV     A,B

1D3C 89         ADC     Cc

1D3D 47         MOV     B,A

1D3E C5         PUSH    B

1D3F E6         PUSH    H

1D40 DS         PUSH    D

1D41 CD511C     CALL    FLMULB10

1044 F1         POP     PSW

1D45 D630       SUI     "oO"

1047 CD0000     CALL    DECDGADD

1D4A E1         POP     H

1D4B C1         POP     B

1D4C D1         POP     D

1D4D C3cD1Cc     JMP     DECODELP
DECDGADD:

1D50 CDAD1B     CALL    PUSHAC

1D53 CD811C     CALL    FLOATBYT
ADDOPR:

1D56 C1         POP     B                                                                                 ;

1D57 D1         POP     9)

1058 C3B419     JMP     FLADD


=== PAGE _123 (PDF page 199) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 121
; FLOATING POINT ENCODE ROUTINE
ERRMSGIN:
1D5B £5         PUSH    H       ;PRINT CUR LINE NUMBER IN ERROR
1D5C 210505     LXI     H,MSGIN
1D5F CDACOD     CALL    PRNTMSG
1D62 E1         POP     H
PRINTINT:
1063 £5         PUSH    H       PRINT AN INTEGER
1D64 21AB0D     LXI     H,PRNTNUMS
1D67 £3         XTHL
ENCODEHL:
1D68 EB         XCHG            sENCODE AN INTEGER
1D69 AF         XRA     A
1D6A 0698       MVI     B,098H
1D6C CD861C     CALL    FLOATINT
ENCODE:
1D6F 11F3FF     LXI     0,-13   s;ENCODE AC IN EXTERNAL FORM
1D72 2A8103     LHLD    PROGBASE
1D75 19         DAD     D       ;CREATE POINTER TO ENCODE BUFFER
1D76 E5         PUSH    H
1D77 CD681C     CALL    SIGNACC
1D7A 3620       MVI     mM," "
107C F20000     JP      ENCODFRS
1D7F 362D       MVI     M,"-"
ENCODFRS:
1D81 23         INX     H
1D82 3630       MVI     M,"0"                     :                                                 ;
1D84 CA0000     JZ      ENCODZXT
1D87 E5         PUSH    H
1D88 FC981C     CM      CMACCS
1D8B AF         XRA     A
1D8C F5         PUSH    PSW
1D8D CDO0000     CALL    ENCODCMP
ENCODUPL:
1090 014391     LXT     B,09143H        ;FORCE NUMBER TO RANGE
1D93 11F84F     LXI     D,O4FF8H        ;10**5 <= AC BY MULTIPLICATION
1D96 CDF91B     CALL    FLCMP
1D99 3D         OCR     A
1D9A F20000     JP      ENCODRND
1D9D Fi         POP     PSW
1D9E CD321D     CALL    FLMLB10C
1DA1 F5         PUSH    PSW
1DA2 €3901D     JMP     ENCODUPL                                                                             :
ENCODDNL:
1DA5 CD1F1B     CALL    FLDIVB10        ;FORCE NUMBER TO RANGE
1DA8 F1         POP     PSW     :AC < 10**6 BY DIVISION
1DA9 3C         INR     A             .
1DAA F5         PUSH    PSW
1DAB CDQ000     CALL    ENCODCMP
ENCODRND:
1DAE CDA019     CALL    FLADDHLF        ;ROUND UP RESULT
1DB1 3C         INR     A


=== PAGE _124 (PDF page 200) ===
basIC.tST                      5-Sep-78 14:39:48                                         Page 122
1DB2 CD261C     CALL    FIXAC
1DB5 CDBD1B     CALL    LDACRG
1DB8 010602     LXI     B,00206H        ;D.DDDDD
1DBB Fi         PoP     PSW
iDBC 81         ADD     c
1DBD FA0000     JM      ENCDEXPS
4DCO FEO?       CPI     007H
1pC2 020000     JNC     ENCDEXPS
1DC5 3C         INR     A
1DC6 47         MOV     B,A
1DC7 3601       MVI     A,001H
ENCDEXPS:
1DC9 3D         DCR     A
1DCA E1         POP     H
1DCB F5         PUSH    PSW
apce 110000     LXI     D,ENCDCOEF
ENCODDGL:
1DCF 05         DCR     B
1DD0 362E       MVI     M,"."
1DD2 CCD21B     CZ      INCHLRET
1DD5 C5         PUSH    B
1DD6 E5         PUSH    H                                                                              .
1DD7 D5         PUSH    D
1DD8 CDC81B     CALL    LDRGAC
1DDB E1         POP     H
1DDC 062F       MVI     B,‘0-1 ;GENERATE NEXT DIGIT
ENCODSBL:
1DDE 04         INR     B
1DDF 7B         MOV     A,E
1DE0O 96         SUB     M
1DE1 5F         MOV     E,A
1DE2 23         INX     H
1DE3 7A         MOV     A,D
1DE4 QE         SBB     M
1DE5 57         MOV     D,A
1DE6 23         INX     H
1DE7 79         MOV     A,C
1DE8 QE         SBB     M
1DE9 4F          MOV     C,A                                                                                 ,
1DEA 2B         DCX     H
1DEB 2B         DCX     H
1DEC D2DE1D     JNC     ENCODSBL
1DEF CD5B1A     CALL    ADDM2CDE
1DF2 23         INX     H
1DF3 CDBD1B     CALL    LDACRG
1DF6 EB         XCHG                                            .
1DF7 E1         POP     H
1DF8 70         MOV     M,B
1DFQ9 23         INX     H
IDFA C1         POP     B
1DFB OD         DCR     Cc
1DFC C2CF1iD     ONZ     ENCODDGL
1DFF 05         DCR     B
1E00 CA0000     Jz      ENCODEXP
ENCDRTZR:
1£03 28         DCX     H       ;REMOVE TRAILING ZEROES


=== PAGE _125 (PDF page 201) ===
basIC.LST                      5-Sep-78 14:39:48                                  ;      Page 123
1E04 7E         MOV     A.M
1E05 FE30       cPI     "gr
1E07 CA031E     JZ      ENCDRTZR
1E0A FE2E       CPI     "we     ;REMOVE TRAILING DECIMAL POINT
TEOC C4D21B     CNZ     INCHLRET
ENCODEXP:
1EOF Fi         POP     PSW     ;ENCODE EXPONENT
1E10 CA0000     aZ      ENCODEXT
1E13 3645       MVI     M,"E"
1£15 23         INX     H
1E16 362B       MVI     M,"+"
1£18 F20000     uP      ENCDEXPP
1E1B 362D       MVI     M,"-"
1E1D 2F         CMA
1E1E 3C         INR     A
ENCDEXPP:
1E1F 062F       MVI     B, ‘0-1
ENCDEXPL:                                        .
1E21 04         INR     B
1E22 D60A       SUI     10
1624 02211E     JNC     ENCDEXPL
1E27 C63A       ADI     'Q+4
1E29 23         INX     H
1E2A 70         MOV     M,B
ENCODZXT:
1E2B 23         INX ©   H
1E2C 77         MOV     MA
1E2D 23         INX     H
ENCODEXT:
1E2E 71         MOV     M,C
1E2F E1         POP     H
1E30 C9         RET
ENCODCMP:
1E31 017494     LXI     B,09474H        ;10**6
1634 11F723     LXI     D,023F7H
1E37 CDOF91B     CALL    FLCMP
1E3A E1         POP     H
1E3B 3D         DCR     A
1E3C F2A51D     JP      ENCODDNL
1E3F EQ         PCHL
FLHALF :
1£40 000000     DB      000h, OOGh, 000h, O80h 51/2
1E43 80
ENCDCOEF:
1644 A08601     db      Oa0h, 086h, O01h        310**5
1E£47 102700     db      010h, O027h, O000h        ;10**4
1E4A £80300     db      Qe8h, 003h, 000h        ;10**3
1£4D 640000     db      064h, 000h, O000h        310**2
1E50 0A0000     db      OO0ah, 000h, 000h        ;10%*1
1E53 010000     db      O01h, 000h, 000h        ;10*%*0


=== PAGE _126 (PDF page 202) ===
basIC.LST                      68-Sep-78 14:39:48                                         Page 124
; FLOATING POINT LOGARITHM ROUTINE
LOGCOEF:
1E56 03         DB      3
1E57 AAS619     db      Qaah, 056h, 019h, 080h
1E5A 80
1E5B F12276     db      Ofih, 022h, 076h, 080h
1E5E 80
1E5F 45AA38     db      045h, Oaah, 038h, 082h
1E62 82
FLONE:
1E63 000000     db      000h, 000h, O00h, 08th ;1.0
1E66 81
LOGFCT:
1E67 CD681C     CALL  SIGNACC ;LOG FUNCTION
1E6A 3D         DCR     A
1E6B FA230C     JM      ERRAFC
1E6E 219603     LXI     H, FLACCEXP
1E71 7E         MOV     A.M
1E72 013580     LXE     B,08035H
1E75 11F304     LXI     D,004F3H
1E78 90         SUB     B
1E79 FS         PUSH —- PSW
1E7A 70         MOV     MB
1E7B 05         PUSH =D
1E7C C5         PUSH —B
1E7D CDB419     CALL —- FLADD
1E80 C1         POP     B
1£81 D1         POP     D
1E82 04         INR     B
1E83 CD2D1B     CALL —- FLDIV
1E86 21631     LXI     H, FLONE
1E89 CDA919     CALL FLMMMAC
1E8C 21561E     LXI     H, LOGCOEF
1E8F Cp0000     CALL —-FCTPOLY2
1E92 018080     LXI     B, 08080H
1E95 110000     LXI     D,00000H
1E98 CDB419     CALL —- FLADD
1E9B F1         POP     PSW
1E9C CD501D     CALL  DECDGADD
FLMULLN2:
1EQF 013180     LXI     B,08031H        ;LN(2)=0,6931472
1EA2 111872     LXI     D,07218H
1EA5 C3A11A     JMP     FLMUL


=== PAGE _127 (PDF page 203) ===
basIC.LST                      5~Sep-78 14:39:48                                         Page 125
; FLOATING POINT SQUARE ROOT/EXPONENTIATION ROUTINE
SQRFCT:

1EA8 CDAD1B     CALL    PUSHAC ;SQR FUNCTION

1EAB 21401E     LXI     H, FLHALF        sSQR(X)aX**1/2

1EAE CDBA1B     CALL    LDRGACMM
EXPOPR:

1EB1 C1         POP     B       sX**YmEXP(LOG(X)*Y)

1EB2 Di         POP     D

1EB3 CD681C     CALL    SIGNACC

1EB6 CA0000     JZ      EXPFCT

1EB9 78         MOV     A,B

1EBA B7         ORA     A

1EBB CA1B1A     Jz      LDACCE

TEBE D5         PUSH    D

1EBF C5         PUSH    B

1ECO 79         MOV     A,C

1EC1 F67F       ORT     O7FH

1EC3 CDC81B     CALL    LDRGAC                                                                         .

1EC6 F20000     JP      EXPEXPOS

1ECQ DS         PUSH    i)

1ECA C5         PUSH    B

1ECB CDAO1C     CALL    INTFCT

1ECE C1         POP     B

1ECF D1         POP     D

1E00 F5         PUSH    PSW

1ED1 CDF918     CALL    FLCMP

1ED4 Et         POP     H

1ED5 7C         MOV     A,H

1ED6 1F         RAR
EXPEXPOS:

1E07 Et         PoP     H

1ED8 229503     SHLD    FLACCMSB

1EDB E1         POP     H

1EDC 229303     SHLD    ACCUMLTR

1EDF DC791C     cc      CMANSWR

1EE2 CC981C     CZ      CMACCS

1EE5 D5         PUSH    D

1EE6 C5         PUSH    B

1EE7 CD671E     CALL    LOGFCT

1EEA C1         POP     B

1EEB D1         POP     D

1EEC CDA11A     CALL    FLMUL                                   .


=== PAGE _128 (PDF page 204) ===
basIC.LST                      68-Sep-78 14:39:48                                  ;      Page 126
; EXPONENTIAL FUNCTION ROUTINE
EXPFCT:

1EEF CDAD1B     CALL    PUSHAC ;EXP FUNCTION

1EF2 013881     LXI     B,08138H        ;LOG(2)E91.442695

1EF5 113BAA     LXI     D, OAA3BH

1EF8 CDA11A     CALL    FLMUL

1EFB 3A9603     LDA     FLACCEXP

1EFE FE88       CPI     088H      .

1F00 02121B     JNC     EXPRNEXC

1F03 CDA01C     CALL    INTFCT

1F06 C680       ADI     Q80H

1F08 C602       ADI     002H

1FOA DA121B     Jc      EXPRNEXC

1FOD F5         PUSH    PSW                                .

1FOE 21631E     LXI     H,FLONE

1Fi1 CDA319     CALL    FLADDM

1F14 CDOF1E     CALL    FLMULLN2

1F17 Fi         POP     PSW

1F18 Ci         POP     B

1F19 D1         POP     D

1F1iA F5         PUSH    PSW

1F1B CDB119     CALL    FLSUB

1F1E CD9B1C     CALL    CMACCS

1F21 210000     LXI     H, EXPCOEF

1F24 CD0000     CALL    FCTPOLY1

1F27 110000     LXI     D,0

1F2A C1         POP     B

1F2B 4A         MOV     c,d

1F2C C3A11A     JMP     FLMUL                                                                             :
EXPCOEF:

1F2F 08         DB      8

1F30 402E94     db      040h, O2eh, 094h, 074h

1F33 74

1F34 704F2E     db      O70h, 04fh, O2eh, 077h

1F37 77

1F38 6E£0288     db      O6eh, 002h, 088h, O7ah

1F3B 7A

1F3C E6A02A     db      Oe6h, Oa0h, O2ah, O7ch

1F3F 7C

1F40 SOAAAA     db      050h, Oaah, Oaah, O7eh

1F43 7E

1F44 FFFF7F     db      Offh, Offh, O7fh, O7fh

1F47 7F

1F48 000080     db      O00h, 000h, O80h, 081th

1F4B 81

1F4C 000000     db      000h, 000h, O00h, O8th

1F4F 81


=== PAGE _129 (PDF page 205) ===
basIC.LST                      5-Sep-78 14:39:48                                         Page 127
; FLOATING POINT POLYNOMINAL EVALUATORS
FCTPOLY2:                                                           ;
1F50 COAD1B     CALL    PUSHAC ;POLYNOMIAL EVALUATOR                           ;
1F53 119F1A     LXI     D,MULOPR        ;EVALUATE P(X**2)*X
1F56 D5         PUSH    D
1F67 E5         PUSH    H
1F58 CDC81B     CALL    LDRGAC
1F5B CDAL1A     CALL    FLMUL
1F5E E1         PoP     H
FCTPOLY1:
1F5F CDAD1B     CALL    PUSHAC ;EVALUATE P(X)
1F62 7E         MOV     A.M
1F63 23         INX     H
1F64 CDBA1B     CALL    LDRGACMM
FCTPOLYL:
1F67 C1         POP     B
1F68 D1        POP    D
1F69 3D         DCR     A
1F6A C8         RZ
1F6B D5        PUSH    D
1F6C C5         PUSH    B
1F6D F5        PUSH   PSW
1F6E ES         PUSH    H
1F6F CDA11A     CALL    FLMUL
1F72 £1         PoP     H
1F73 CDCB1B     CALL    LDRGMM                                                 ;
1F76 ES         PUSH    H
1F77 CDB419    CALL   FLADD
1F7A El         POP     H
1F7B F1       POP    PSW                       .
1F7C C3671F     JMP     FCTPOLYL


=== PAGE _130 (PDF page 206) ===
basIC.LST                      §-Sep-78 14:39:48                                         Page 128
; RANDOM NUMBER GENERATOR
RNDFCT:
1F7F CD681C     CALL    SIGNACC ;RND FUNCTION
1F82 FA0000     JM   RNDFCTUS        3<0 - INITIALIZE SEED
1F85 219F03     LXI     H,RNDFCTSD
1F88 CDBA1B     CALL    LDRGACMM
1F8B C8         RZ              "0 - PREVIOUS VALUE
1F8C 013598     LXI     B,09835H
1F8F 117A44     LXI     D,0447AH
1F92 CDA11A     CALL    FLMUL   720 - NEXT VALUE
1F95 012868     LXI     B,06828H
1F98 1146B1     LXI     D,0B8146H
1F9B CDB419     CALL    FLADD
RNDFCTUS:
1F9E CDC81B     CALL    LDRGAC ;CHANGE SEED
1FA1 7B         MOV     A,E
1FA2 59         MOV     E,C
1FA3 4F         MOV     C,A                                                                            .
1FA4 3680       MVI     M,080H
1FA6 2B         DCX     H
1FA7 46         MOV     B,M
1FA8 3680       MVI     M,080H
1FAA CDO51A     CALL    NORMALIZ
1FAD 219F03     LXI     H,RNDFCTSD
1FBO C3D41B     JMP     LDMMAC


=== PAGE _131 (PDF page 207) ===
basIC.LST                      §-Sep-78 14:39:48                                   :       Page 129
+; FLOATING POINT SINE/COSINE ROUTINES
COSFCT:
1FB3 210000     LXI     H, PIOVER2       ;COS FUNCTION
1FB6 CDA319     CALL    FLADDM
SINFCT:
1FB9 CDAD1B     CALL    PUSHAC ;SIN FUNCTION
1FBC 014983     LXI     B,08349H        +YaX*2"Pl
1FBF 110B0F     LXI     D,OOFDBH
1FC2 CDBD1B     CALL    LDACRG
1FC5 C1         POP     B
1FC6 D1         POP     D
1FC7 CD2D1B     CALL    FLDIV
1FCA CDAD1B     CALL    PUSHAC ;Y=#Y MOD 1
1FCD CDA01C     CALL    INTFCT
1FDO C1         POP     B
1FD1 D1         POP     D
1FD2 CDB119     CALL    FLSUB
1FD5 210000     LXI     H, FLQUART
1FD8 CDA91i9     CALL    FLMMMAC
1FDB CD681C     CALL    SIGNACC
1FDE 37         STC
1FDF F20000     JP      SINFCTC
1FE2 CDA0i9     CALL    FLADDHLF
1FE5 CD68iC     CALL    SIGNACC
1FE8 B7         ORA     A
SINFCTC:
1FEQ F5         PUSH    PSW
1FEA F4981C     CP      CMACCS
1FED 210000     LXI     H, FLQUART                                                                         .
1FFO CDA319     CALL    FLADDM
1FF3 F4         POP     PSW
1FF4 D4981C     CNC     CMACCS
1FF7 210000     LXI     H, COSCOEF
1FFA C3501F     JMP     FCTPOLY2
PIOVER2:
1FFD DBOF49     db      Odbh, O0fh, 049h, O081h = ;PI/2
2000 81
FLQUART:        ;
2001 000000     db      000h, 000h, O00h, O7fh 3174
2004 7F
COSCOEF:
2005 05         DB      §
2006 BAD71E     db      Obah, Od7h, Oleh, O086h
2009 86
200A 642699     db      064h, 026h, O099h, 087h
200D 87
200E 583423     db      058h, 034h, 023h, O87h
2011 87
2012 E0S5DAS     db      OeOh, OSdh, OabSh, O86h
2015 86


=== PAGE _132 (PDF page 208) ===
basIC.LST                56-Sep-78 14:39:48                              Page 130
2016 DAOF49    db    Odah, OOfh, 049h, O83h
2019 83


=== PAGE _133 (PDF page 209) ===
basIC.LsT                5-Sep-78 14:39:48                              Page 131
; FLOATING POINT TANGENT/ARCTANGENT ROUTINES
’
TANFCT:
201A CDAD18     CALL    PUSHAC ;TAN FUNCTION
201D CDB91F     CALL    SINFCT
2020 C1       POP    B     ;TAN(X) = SIN(X)/COS(X)
2021 E1         POP     H
2022 CDAD1B     CALL    PUSHAC
2025 EB         XCHG
2026 CDBD1B     CALL    LDACRG
2029 CDB31F     CALL    COSFCT
202C C32B1B     JMP     DIVOPR      :
ATNFCT:
202F CD681C     CALL    SIGNACC
2032 FC791C     CM      CMANSWR
2035 FC981C     CM      CMACCS
2038 3A9603     LDA     FLACCEXP
203B FE81       CPI     081H                                                                           .
203D DA0000     Jc      ATNFCTC
2040 010081     LXI     B,08100H
2043 51         MOV     D,C
2044 59         MOV     E,C
2045 CD2D1B     CALL    FLDIV
2048 21A919     LXI     H, FLMMMAC
204B E§         PUSH    H
ATNFCTC:
204C 210000     LXI     H, ATNCOEF
204F CD501F     CALL    FCTPOLY2
2052 21FD1F     LXI     H, PIOVER2
2055 C9         RET
ATNCOEF:
2056 09         DB      9
2057 4AD73B     db      O4ah, Od7h, O3bh, 078h
205A 78
205B 026E84     db      002h, O6eh, 084h, O7bh
205E 7B
205F FEC12F     db      Ofeh, Octh, O2fh, O7ch
2062 7C
2063 74319A     db      074h, O31h, O9ah, O7dh
2066 7D
2067 843D5A     db      084h, O3dh, O5ah, O7dh
206A 7D
206B C87F91     db      Oc8h, O7fh, O91h, O7eh
206E 7E
206F E4BB4C     db      Oe4h, Obbh, O4ch, O7eh
2072 7E
2073 6CAAAA     db      O6ch, Oaah, Oaah, O7fh
2076 7F
2077 000000     db      000h, 000h, 00h, 081h
207A 81


=== PAGE _134 (PDF page 210) ===
basIC.LST                      5-Sep~-78 14:39:48                                          Page 132

VERSNDAT:
207B 30322F     DB      "02/03/78" ,0
207E 30332F
2081 373800

ENOINTRP:
2084 00         DB      0       ;END OF INTERPRETER

|


